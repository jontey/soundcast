var dd=Object.create;var Ti=Object.defineProperty;var pd=Object.getOwnPropertyDescriptor;var ld=Object.getOwnPropertyNames;var ud=Object.getPrototypeOf,hd=Object.prototype.hasOwnProperty;var Sa=r=>{throw TypeError(r)};var md=(r,n,e)=>n in r?Ti(r,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[n]=e;var C=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports);var fd=(r,n,e,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of ld(n))!hd.call(r,s)&&s!==e&&Ti(r,s,{get:()=>n[s],enumerable:!(t=pd(n,s))||t.enumerable});return r};var gd=(r,n,e)=>(e=r!=null?dd(ud(r)):{},fd(n||!r||!r.__esModule?Ti(e,"default",{value:r,enumerable:!0}):e,r));var h=(r,n,e)=>md(r,typeof n!="symbol"?n+"":n,e),ba=(r,n,e)=>n.has(r)||Sa("Cannot "+e);var N=(r,n,e)=>(ba(r,n,"read from private field"),e?e.call(r):n.get(r)),ce=(r,n,e)=>n.has(r)?Sa("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(r):n.set(r,e),Z=(r,n,e,t)=>(ba(r,n,"write to private field"),t?t.call(r,e):n.set(r,e),e);var Ra=C((tm,ya)=>{var zt=1e3,Ht=zt*60,Kt=Ht*60,yt=Kt*24,_d=yt*7,wd=yt*365.25;ya.exports=function(r,n){n=n||{};var e=typeof r;if(e==="string"&&r.length>0)return vd(r);if(e==="number"&&isFinite(r))return n.long?bd(r):Sd(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function vd(r){if(r=String(r),!(r.length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(n){var e=parseFloat(n[1]),t=(n[2]||"ms").toLowerCase();switch(t){case"years":case"year":case"yrs":case"yr":case"y":return e*wd;case"weeks":case"week":case"w":return e*_d;case"days":case"day":case"d":return e*yt;case"hours":case"hour":case"hrs":case"hr":case"h":return e*Kt;case"minutes":case"minute":case"mins":case"min":case"m":return e*Ht;case"seconds":case"second":case"secs":case"sec":case"s":return e*zt;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:return}}}}function Sd(r){var n=Math.abs(r);return n>=yt?Math.round(r/yt)+"d":n>=Kt?Math.round(r/Kt)+"h":n>=Ht?Math.round(r/Ht)+"m":n>=zt?Math.round(r/zt)+"s":r+"ms"}function bd(r){var n=Math.abs(r);return n>=yt?os(r,n,yt,"day"):n>=Kt?os(r,n,Kt,"hour"):n>=Ht?os(r,n,Ht,"minute"):n>=zt?os(r,n,zt,"second"):r+" ms"}function os(r,n,e,t){var s=n>=e*1.5;return Math.round(r/e)+" "+t+(s?"s":"")}});var Ta=C((rm,Ca)=>{function yd(r){e.debug=e,e.default=e,e.coerce=d,e.disable=a,e.enable=s,e.enabled=o,e.humanize=Ra(),e.destroy=p,Object.keys(r).forEach(l=>{e[l]=r[l]}),e.names=[],e.skips=[],e.formatters={};function n(l){let c=0;for(let u=0;u<l.length;u++)c=(c<<5)-c+l.charCodeAt(u),c|=0;return e.colors[Math.abs(c)%e.colors.length]}e.selectColor=n;function e(l){let c,u=null,m,_;function b(...v){if(!b.enabled)return;let f=b,g=Number(new Date),w=g-(c||g);f.diff=w,f.prev=c,f.curr=g,c=g,v[0]=e.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let y=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(Ee,S)=>{if(Ee==="%%")return"%";y++;let Le=e.formatters[S];if(typeof Le=="function"){let A=v[y];Ee=Le.call(f,A),v.splice(y,1),y--}return Ee}),e.formatArgs.call(f,v),(f.log||e.log).apply(f,v)}return b.namespace=l,b.useColors=e.useColors(),b.color=e.selectColor(l),b.extend=t,b.destroy=e.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(m!==e.namespaces&&(m=e.namespaces,_=e.enabled(l)),_),set:v=>{u=v}}),typeof e.init=="function"&&e.init(b),b}function t(l,c){let u=e(this.namespace+(typeof c>"u"?":":c)+l);return u.log=this.log,u}function s(l){e.save(l),e.namespaces=l,e.names=[],e.skips=[];let c=(typeof l=="string"?l:"").trim().replace(" ",",").split(",").filter(Boolean);for(let u of c)u[0]==="-"?e.skips.push(u.slice(1)):e.names.push(u)}function i(l,c){let u=0,m=0,_=-1,b=0;for(;u<l.length;)if(m<c.length&&(c[m]===l[u]||c[m]==="*"))c[m]==="*"?(_=m,b=u,m++):(u++,m++);else if(_!==-1)m=_+1,b++,u=b;else return!1;for(;m<c.length&&c[m]==="*";)m++;return m===c.length}function a(){let l=[...e.names,...e.skips.map(c=>"-"+c)].join(",");return e.enable(""),l}function o(l){for(let c of e.skips)if(i(l,c))return!1;for(let c of e.names)if(i(l,c))return!0;return!1}function d(l){return l instanceof Error?l.stack||l.message:l}function p(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}Ca.exports=yd});var Or=C((Te,cs)=>{Te.formatArgs=Cd;Te.save=Td;Te.load=Dd;Te.useColors=Rd;Te.storage=Pd();Te.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Te.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Rd(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let r;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(r=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(r[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Cd(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+cs.exports.humanize(this.diff),!this.useColors)return;let n="color: "+this.color;r.splice(1,0,n,"color: inherit");let e=0,t=0;r[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(e++,s==="%c"&&(t=e))}),r.splice(t,0,n)}Te.log=console.debug||console.log||(()=>{});function Td(r){try{r?Te.storage.setItem("debug",r):Te.storage.removeItem("debug")}catch{}}function Dd(){let r;try{r=Te.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function Pd(){try{return localStorage}catch{}}cs.exports=Ta()(Te);var{formatters:kd}=cs.exports;kd.j=function(r){try{return JSON.stringify(r)}catch(n){return"[UnexpectedJSONParseError]: "+n.message}}});var Da=C((jr,ds)=>{(function(r,n){"use strict";var e="2.0.3",t=500,s="user-agent",i="",a="?",o="function",d="undefined",p="object",l="string",c="browser",u="cpu",m="device",_="engine",b="os",v="result",f="name",g="type",w="vendor",y="version",ae="architecture",Ee="major",S="model",Le="console",A="mobile",B="tablet",W="smarttv",Ae="wearable",ai="xr",Rr="embedded",Cr="inapp",oi="brands",St="formFactors",ci="fullVersionList",Nt="platform",di="platformVersion",Zr="bitness",at="sec-ch-ua",Xc=at+"-full-version-list",Jc=at+"-arch",Zc=at+"-"+Zr,ed=at+"-form-factors",td=at+"-"+A,rd=at+"-"+S,ra=at+"-"+Nt,sd=ra+"-version",sa=[oi,ci,A,S,Nt,di,ae,St,Zr],es="Amazon",Ft="Apple",ia="ASUS",na="BlackBerry",bt="Google",aa="Huawei",oa="Lenovo",ca="Honor",ts="LG",pi="Microsoft",li="Motorola",ui="Nvidia",da="OnePlus",hi="OPPO",Tr="Samsung",pa="Sharp",Dr="Sony",mi="Xiaomi",fi="Zebra",la="Chrome",ua="Chromium",ot="Chromecast",id="Edge",Pr="Firefox",kr="Opera",gi="Facebook",ha="Sogou",qt="Mobile ",xr=" Browser",_i="Windows",wi=typeof r!==d,ye=wi&&r.navigator?r.navigator:n,ct=ye&&ye.userAgentData?ye.userAgentData:n,nd=function(R,T){var D={},K=T;if(!ss(T)){K={};for(var M in T)for(var X in T[M])K[X]=T[M][X].concat(K[X]?K[X]:[])}for(var k in R)D[k]=K[k]&&K[k].length%2===0?K[k].concat(R[k]):R[k];return D},rs=function(R){for(var T={},D=0;D<R.length;D++)T[R[D].toUpperCase()]=R[D];return T},vi=function(R,T){if(typeof R===p&&R.length>0){for(var D in R)if(Ye(R[D])==Ye(T))return!0;return!1}return Ut(R)?Ye(T).indexOf(Ye(R))!==-1:!1},ss=function(R,T){for(var D in R)return/^(browser|cpu|device|engine|os)$/.test(D)||(T?ss(R[D]):!1)},Ut=function(R){return typeof R===l},Si=function(R){if(!R)return n;for(var T=[],D=Bt(/\\?\"/g,R).split(","),K=0;K<D.length;K++)if(D[K].indexOf(";")>-1){var M=Lr(D[K]).split(";v=");T[K]={brand:M[0],version:M[1]}}else T[K]=Lr(D[K]);return T},Ye=function(R){return Ut(R)?R.toLowerCase():R},bi=function(R){return Ut(R)?Bt(/[^\d\.]/g,R).split(".")[0]:n},Xe=function(R){for(var T in R){var D=R[T];typeof D==p&&D.length==2?this[D[0]]=D[1]:this[D]=n}return this},Bt=function(R,T){return Ut(T)?T.replace(R,i):T},Er=function(R){return Bt(/\\?\"/g,R)},Lr=function(R,T){if(Ut(R))return R=Bt(/^\s\s*/,R),typeof T===d?R:R.substring(0,t)},yi=function(R,T){if(!(!R||!T))for(var D=0,K,M,X,k,Q,q;D<T.length&&!Q;){var re=T[D],Je=T[D+1];for(K=M=0;K<re.length&&!Q&&re[K];)if(Q=re[K++].exec(R),Q)for(X=0;X<Je.length;X++)q=Q[++M],k=Je[X],typeof k===p&&k.length>0?k.length===2?typeof k[1]==o?this[k[0]]=k[1].call(this,q):this[k[0]]=k[1]:k.length===3?typeof k[1]===o&&!(k[1].exec&&k[1].test)?this[k[0]]=q?k[1].call(this,q,k[2]):n:this[k[0]]=q?q.replace(k[1],k[2]):n:k.length===4&&(this[k[0]]=q?k[3].call(this,q.replace(k[1],k[2])):n):this[k]=q||n;D+=2}},dt=function(R,T){for(var D in T)if(typeof T[D]===p&&T[D].length>0){for(var K=0;K<T[D].length;K++)if(vi(T[D][K],R))return D===a?n:D}else if(vi(T[D],R))return D===a?n:D;return T.hasOwnProperty("*")?T["*"]:R},ma={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},fa={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":n},ga={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[f,qt+"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,y],[/opios[\/ ]+([\w\.]+)/i],[y,[f,kr+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[y,[f,kr+" GX"]],[/\bopr\/([\w\.]+)/i],[y,[f,kr]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[y,[f,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[y,[f,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon|otter|dooble|(?:lg |qute)browser)\/([-\w\.]+)/i,/(heytap|ovi|115|surf)browser\/([\d\.]+)/i,/(ecosia|weibo)(?:__| \w+@)([\d\.]+)/i],[f,y],[/quark(?:pc)?\/([-\w\.]+)/i],[y,[f,"Quark"]],[/\bddg\/([\w\.]+)/i],[y,[f,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[f,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[y,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[f,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[y,[f,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[y,[f,"Smart "+oa+xr]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure"+xr],y],[/\bfocus\/([\w\.]+)/i],[y,[f,Pr+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[f,kr+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[f,kr+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[f,"MIUI"+xr]],[/fxios\/([\w\.-]+)/i],[y,[f,qt+Pr]],[/\bqihoobrowser\/?([\w\.]*)/i],[y,[f,"360"]],[/\b(qq)\/([\w\.]+)/i],[[f,/(.+)/,"$1Browser"],y],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1"+xr],y],[/samsungbrowser\/([\w\.]+)/i],[y,[f,Tr+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[y,[f,ha+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[f,ha+" Mobile"],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[f,y],[/(lbbrowser|rekonq)/i],[f],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[y,f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,gi],y,[g,Cr]],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat)[\/ ]([-\w\.]+)/i],[f,y,[g,Cr]],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[f,"GSA"],[g,Cr]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[y,[f,"TikTok"],[g,Cr]],[/\[(linkedin)app\]/i],[f,[g,Cr]],[/(chromium)[\/ ]([-\w\.]+)/i],[f,y],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[f,la+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,la+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[f,"Android"+xr]],[/chrome\/([\w\.]+) mobile/i],[y,[f,qt+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,y],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[y,[f,qt+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[f,qt+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[y,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[y,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[f,y],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[f,qt+Pr],y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],y],[/(wolvic|librewolf)\/([\w\.]+)/i],[f,y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[f,Pr+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[f,[y,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[f,[y,/[^\d\.]+./,i]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[ae,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[ae,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[ae,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[ae,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[ae,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[ae,/ower/,i,Ye]],[/ sun4\w[;\)]/i],[[ae,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[ae,Ye]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[S,[w,Tr],[g,B]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[S,[w,Tr],[g,A]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[S,[w,Ft],[g,A]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[S,[w,Ft],[g,B]],[/(macintosh);/i],[S,[w,Ft]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[S,[w,pa],[g,A]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[S,[w,ca],[g,B]],[/honor([-\w ]+)[;\)]/i],[S,[w,ca],[g,A]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[S,[w,aa],[g,B]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[S,[w,aa],[g,A]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[S,/_/g," "],[w,mi],[g,B]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[S,/_/g," "],[w,mi],[g,A]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[S,[w,hi],[g,A]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[S,[w,dt,{OnePlus:["304","403","203"],"*":hi}],[g,B]],[/(vivo (5r?|6|8l?|go|one|s|x[il]?[2-4]?)[\w\+ ]*)(?: bui|\))/i],[S,[w,"BLU"],[g,A]],[/; vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[S,[w,"Vivo"],[g,A]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[S,[w,"Realme"],[g,A]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[S,[w,li],[g,A]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[S,[w,li],[g,B]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[S,[w,ts],[g,B]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+(?!.*(?:browser|netcast|android tv|watch))(\w+)/i,/\blg-?([\d\w]+) bui/i],[S,[w,ts],[g,A]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[S,[w,oa],[g,B]],[/(nokia) (t[12][01])/i],[w,S,[g,B]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[S,/_/g," "],[g,A],[w,"Nokia"]],[/(pixel (c|tablet))\b/i],[S,[w,bt],[g,B]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[S,[w,bt],[g,A]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[S,[w,Dr],[g,A]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[S,"Xperia Tablet"],[w,Dr],[g,B]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[S,[w,da],[g,A]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[S,[w,es],[g,B]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[S,/(.+)/g,"Fire Phone $1"],[w,es],[g,A]],[/(playbook);[-\w\),; ]+(rim)/i],[S,w,[g,B]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[S,[w,na],[g,A]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[S,[w,ia],[g,B]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[S,[w,ia],[g,A]],[/(nexus 9)/i],[S,[w,"HTC"],[g,B]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[w,[S,/_/g," "],[g,A]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[S,[w,"TCL"],[g,B]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[S,[w,"TCL"],[g,A]],[/(itel) ((\w+))/i],[[w,Ye],S,[g,dt,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[S,[w,"Acer"],[g,B]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[S,[w,"Meizu"],[g,A]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[S,[w,"Ulefone"],[g,A]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[S,[w,"Energizer"],[g,A]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[S,[w,"Cat"],[g,A]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[S,[w,"Smartfren"],[g,A]],[/droid.+; (a(?:015|06[35]|142p?))/i],[S,[w,"Nothing"],[g,A]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[S,[w,"Archos"],[g,B]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[S,[w,"Archos"],[g,A]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[w,S,[g,B]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (blu|hmd|imo|tcl)[_ ]([\w\+ ]+?)(?: bui|\)|; r)/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[w,S,[g,A]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[w,S,[g,B]],[/(surface duo)/i],[S,[w,pi],[g,B]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[S,[w,"Fairphone"],[g,A]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[S,[w,ui],[g,B]],[/(sprint) (\w+)/i],[w,S,[g,A]],[/(kin\.[onetw]{3})/i],[[S,/\./g," "],[w,pi],[g,A]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[S,[w,fi],[g,B]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[S,[w,fi],[g,A]],[/smart-tv.+(samsung)/i],[w,[g,W]],[/hbbtv.+maple;(\d+)/i],[[S,/^/,"SmartTV"],[w,Tr],[g,W]],[/tcast.+(lg)e?. ([-\w]+)/i],[w,S,[g,W]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[w,ts],[g,W]],[/(apple) ?tv/i],[w,[S,Ft+" TV"],[g,W]],[/crkey.*devicetype\/chromecast/i],[[S,ot+" Third Generation"],[w,bt],[g,W]],[/crkey.*devicetype\/([^/]*)/i],[[S,/^/,"Chromecast "],[w,bt],[g,W]],[/fuchsia.*crkey/i],[[S,ot+" Nest Hub"],[w,bt],[g,W]],[/crkey/i],[[S,ot],[w,bt],[g,W]],[/(portaltv)/i],[S,[w,gi],[g,W]],[/droid.+aft(\w+)( bui|\))/i],[S,[w,es],[g,W]],[/(shield \w+ tv)/i],[S,[w,ui],[g,W]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[S,[w,pa],[g,W]],[/(bravia[\w ]+)( bui|\))/i],[S,[w,Dr],[g,W]],[/(mi(tv|box)-?\w+) bui/i],[S,[w,mi],[g,W]],[/Hbbtv.*(technisat) (.*);/i],[w,S,[g,W]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[w,Lr],[S,Lr],[g,W]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[S,[g,W]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,W]],[/(ouya)/i,/(nintendo) (\w+)/i],[w,S,[g,Le]],[/droid.+; (shield)( bui|\))/i],[S,[w,ui],[g,Le]],[/(playstation \w+)/i],[S,[w,Dr],[g,Le]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[S,[w,pi],[g,Le]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[S,[w,Tr],[g,Ae]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[w,S,[g,Ae]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[S,[w,hi],[g,Ae]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[S,[w,Ft],[g,Ae]],[/(opwwe\d{3})/i],[S,[w,da],[g,Ae]],[/(moto 360)/i],[S,[w,li],[g,Ae]],[/(smartwatch 3)/i],[S,[w,Dr],[g,Ae]],[/(g watch r)/i],[S,[w,ts],[g,Ae]],[/droid.+; (wt63?0{2,3})\)/i],[S,[w,fi],[g,Ae]],[/droid.+; (glass) \d/i],[S,[w,bt],[g,ai]],[/(pico) (4|neo3(?: link|pro)?)/i],[w,S,[g,ai]],[/(quest( \d| pro)?s?).+vr/i],[S,[w,gi],[g,ai]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[w,[g,Rr]],[/(aeobc)\b/i],[S,[w,es],[g,Rr]],[/(homepod).+mac os/i],[S,[w,Ft],[g,Rr]],[/windows iot/i],[[g,Rr]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+?(mobile|vr|\d) safari/i],[S,[g,dt,{mobile:"Mobile",xr:"VR","*":B}]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,B]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[g,A]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[S,[w,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[f,id+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[f,y],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[f,y],[/ladybird\//i],[[f,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,y],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[f,[y,dt,ma]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,dt,ma],[f,_i]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,"macOS"],[y,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[y,[f,ot+" Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[y,[f,ot+" Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[y,[f,ot+" SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[y,[f,ot+" Linux"]],[/crkey\/([\d\.]+)/i],[y,[f,ot]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,f],[/(ubuntu) ([\w\.]+) like android/i],[[f,/(.+)/,"$1 Touch"],y],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/\.; ]?([\d\.]*)/i],[f,y],[/\(bb(10);/i],[y,[f,na]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[y,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[f,Pr+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[f,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,"Chrome OS"],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,y],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[f,y]]},is=function(){var R={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}};return Xe.call(R.init,[[c,[f,y,Ee,g]],[u,[ae]],[m,[g,S,w]],[_,[f,y]],[b,[f,y]]]),Xe.call(R.isIgnore,[[c,[y,Ee]],[_,[y]],[b,[y]]]),Xe.call(R.isIgnoreRgx,[[c,/ ?browser$/i],[b,/ ?os$/i]]),Xe.call(R.toString,[[c,[f,y]],[u,[ae]],[m,[w,S]],[_,[f,y]],[b,[f,y]]]),R}(),ad=function(R,T){var D=is.init[T],K=is.isIgnore[T]||0,M=is.isIgnoreRgx[T]||0,X=is.toString[T]||0;function k(){Xe.call(this,D)}return k.prototype.getItem=function(){return R},k.prototype.withClientHints=function(){return ct?ct.getHighEntropyValues(sa).then(function(Q){return R.setCH(new _a(Q,!1)).parseCH().get()}):R.parseCH().get()},k.prototype.withFeatureCheck=function(){return R.detectFeature().get()},T!=v&&(k.prototype.is=function(Q){var q=!1;for(var re in this)if(this.hasOwnProperty(re)&&!vi(K,re)&&Ye(M?Bt(M,this[re]):this[re])==Ye(M?Bt(M,Q):Q)){if(q=!0,Q!=d)break}else if(Q==d&&q){q=!q;break}return q},k.prototype.toString=function(){var Q=i;for(var q in X)typeof this[X[q]]!==d&&(Q+=(Q?" ":i)+this[X[q]]);return Q||d}),ct||(k.prototype.then=function(Q){var q=this,re=function(){for(var pt in q)q.hasOwnProperty(pt)&&(this[pt]=q[pt])};re.prototype={is:k.prototype.is,toString:k.prototype.toString};var Je=new re;return Q(Je),Je}),new k};function _a(R,T){if(R=R||{},Xe.call(this,sa),T)Xe.call(this,[[oi,Si(R[at])],[ci,Si(R[Xc])],[A,/\?1/.test(R[td])],[S,Er(R[rd])],[Nt,Er(R[ra])],[di,Er(R[sd])],[ae,Er(R[Jc])],[St,Si(R[ed])],[Zr,Er(R[Zc])]]);else for(var D in R)this.hasOwnProperty(D)&&typeof R[D]!==d&&(this[D]=R[D])}function wa(R,T,D,K){return this.get=function(M){return M?this.data.hasOwnProperty(M)?this.data[M]:n:this.data},this.set=function(M,X){return this.data[M]=X,this},this.setCH=function(M){return this.uaCH=M,this},this.detectFeature=function(){if(ye&&ye.userAgent==this.ua)switch(this.itemType){case c:ye.brave&&typeof ye.brave.isBrave==o&&this.set(f,"Brave");break;case m:!this.get(g)&&ct&&ct[A]&&this.set(g,A),this.get(S)=="Macintosh"&&ye&&typeof ye.standalone!==d&&ye.maxTouchPoints&&ye.maxTouchPoints>2&&this.set(S,"iPad").set(g,B);break;case b:!this.get(f)&&ct&&ct[Nt]&&this.set(f,ct[Nt]);break;case v:var M=this.data,X=function(k){return M[k].getItem().detectFeature().get()};this.set(c,X(c)).set(u,X(u)).set(m,X(m)).set(_,X(_)).set(b,X(b))}return this},this.parseUA=function(){return this.itemType!=v&&yi.call(this.data,this.ua,this.rgxMap),this.itemType==c&&this.set(Ee,bi(this.get(y))),this},this.parseCH=function(){var M=this.uaCH,X=this.rgxMap;switch(this.itemType){case c:case _:var k=M[ci]||M[oi],Q;if(k)for(var q in k){var re=k[q].brand||k[q],Je=k[q].version;this.itemType==c&&!/not.a.brand/i.test(re)&&(!Q||/chrom/i.test(Q)&&re!=ua)&&(re=dt(re,{Chrome:"Google Chrome",Edge:"Microsoft Edge","Chrome WebView":"Android WebView","Chrome Headless":"HeadlessChrome","Huawei Browser":"HuaweiBrowser","MIUI Browser":"Miui Browser","Opera Mobi":"OperaMobile",Yandex:"YaBrowser"}),this.set(f,re).set(y,Je).set(Ee,bi(Je)),Q=re),this.itemType==_&&re==ua&&this.set(y,Je)}break;case u:var pt=M[ae];pt&&(pt&&M[Zr]=="64"&&(pt+="64"),yi.call(this.data,pt+";",X));break;case m:if(M[A]&&this.set(g,A),M[S]&&(this.set(S,M[S]),!this.get(g)||!this.get(w))){var Ir={};yi.call(Ir,"droid 9; "+M[S]+")",X),!this.get(g)&&Ir.type&&this.set(g,Ir.type),!this.get(w)&&Ir.vendor&&this.set(w,Ir.vendor)}if(M[St]){var as;if(typeof M[St]!="string")for(var va=0;!as&&va<M[St].length;)as=dt(M[St][va++],fa);else as=dt(M[St],fa);this.set(g,as)}break;case b:var Ri=M[Nt];if(Ri){var Ci=M[di];Ri==_i&&(Ci=parseInt(bi(Ci),10)>=13?"11":"10"),this.set(f,Ri).set(y,Ci)}this.get(f)==_i&&M[S]=="Xbox"&&this.set(f,"Xbox").set(y,n);break;case v:var od=this.data,Mr=function(cd){return od[cd].getItem().setCH(M).parseCH().get()};this.set(c,Mr(c)).set(u,Mr(u)).set(m,Mr(m)).set(_,Mr(_)).set(b,Mr(b))}return this},Xe.call(this,[["itemType",R],["ua",T],["uaCH",K],["rgxMap",D],["data",ad(this,R)]]),this}function Ce(R,T,D){if(typeof R===p?(ss(R,!0)?(typeof T===p&&(D=T),T=R):(D=R,T=n),R=n):typeof R===l&&!ss(T,!0)&&(D=T,T=n),D&&typeof D.append===o){var K={};D.forEach(function(q,re){K[re]=q}),D=K}if(!(this instanceof Ce))return new Ce(R,T,D).getResult();var M=typeof R===l?R:D&&D[s]?D[s]:ye&&ye.userAgent?ye.userAgent:i,X=new _a(D,!0),k=T?nd(ga,T):ga,Q=function(q){return q==v?function(){return new wa(q,M,k,X).set("ua",M).set(c,this.getBrowser()).set(u,this.getCPU()).set(m,this.getDevice()).set(_,this.getEngine()).set(b,this.getOS()).get()}:function(){return new wa(q,M,k[q],X).parseUA().get()}};return Xe.call(this,[["getBrowser",Q(c)],["getCPU",Q(u)],["getDevice",Q(m)],["getEngine",Q(_)],["getOS",Q(b)],["getResult",Q(v)],["getUA",function(){return M}],["setUA",function(q){return Ut(q)&&(M=q.length>t?Lr(q,t):q),this}]]).setUA(M),this}Ce.VERSION=e,Ce.BROWSER=rs([f,y,Ee,g]),Ce.CPU=rs([ae]),Ce.DEVICE=rs([S,w,g,Le,A,W,B,Ae,Rr]),Ce.ENGINE=Ce.OS=rs([f,y]),typeof jr!==d?(typeof ds!==d&&ds.exports&&(jr=ds.exports=Ce),jr.UAParser=Ce):typeof define===o&&define.amd?define(function(){return Ce}):wi&&(r.UAParser=Ce);var $t=wi&&(r.jQuery||r.Zepto);if($t&&!$t.ua){var ns=new Ce;$t.ua=ns.getResult(),$t.ua.get=function(){return ns.getUA()},$t.ua.set=function(R){ns.setUA(R);var T=ns.getResult();for(var D in T)$t.ua[D]=T[D]}}})(typeof window=="object"?window:jr)});var ee=C(ps=>{"use strict";Object.defineProperty(ps,"__esModule",{value:!0});ps.Logger=void 0;var Vt=Or(),Gt="mediasoup-client",Di=class{constructor(n){h(this,"_debug");h(this,"_warn");h(this,"_error");n?(this._debug=(0,Vt.default)(`${Gt}:${n}`),this._warn=(0,Vt.default)(`${Gt}:WARN:${n}`),this._error=(0,Vt.default)(`${Gt}:ERROR:${n}`)):(this._debug=(0,Vt.default)(Gt),this._warn=(0,Vt.default)(`${Gt}:WARN`),this._error=(0,Vt.default)(`${Gt}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};ps.Logger=Di});var Na=C((nm,Pi)=>{"use strict";var Qt=typeof Reflect=="object"?Reflect:null,Pa=Qt&&typeof Qt.apply=="function"?Qt.apply:function(n,e,t){return Function.prototype.apply.call(n,e,t)},ls;Qt&&typeof Qt.ownKeys=="function"?ls=Qt.ownKeys:Object.getOwnPropertySymbols?ls=function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:ls=function(n){return Object.getOwnPropertyNames(n)};function xd(r){console&&console.warn&&console.warn(r)}var xa=Number.isNaN||function(n){return n!==n};function Y(){Y.init.call(this)}Pi.exports=Y;Pi.exports.once=Md;Y.EventEmitter=Y;Y.prototype._events=void 0;Y.prototype._eventsCount=0;Y.prototype._maxListeners=void 0;var ka=10;function us(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(Y,"defaultMaxListeners",{enumerable:!0,get:function(){return ka},set:function(r){if(typeof r!="number"||r<0||xa(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");ka=r}});Y.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Y.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||xa(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this};function Ea(r){return r._maxListeners===void 0?Y.defaultMaxListeners:r._maxListeners}Y.prototype.getMaxListeners=function(){return Ea(this)};Y.prototype.emit=function(n){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);var s=n==="error",i=this._events;if(i!==void 0)s=s&&i.error===void 0;else if(!s)return!1;if(s){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var d=i[n];if(d===void 0)return!1;if(typeof d=="function")Pa(d,this,e);else for(var p=d.length,l=ja(d,p),t=0;t<p;++t)Pa(l[t],this,e);return!0};function La(r,n,e,t){var s,i,a;if(us(e),i=r._events,i===void 0?(i=r._events=Object.create(null),r._eventsCount=0):(i.newListener!==void 0&&(r.emit("newListener",n,e.listener?e.listener:e),i=r._events),a=i[n]),a===void 0)a=i[n]=e,++r._eventsCount;else if(typeof a=="function"?a=i[n]=t?[e,a]:[a,e]:t?a.unshift(e):a.push(e),s=Ea(r),s>0&&a.length>s&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=r,o.type=n,o.count=a.length,xd(o)}return r}Y.prototype.addListener=function(n,e){return La(this,n,e,!1)};Y.prototype.on=Y.prototype.addListener;Y.prototype.prependListener=function(n,e){return La(this,n,e,!0)};function Ed(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ia(r,n,e){var t={fired:!1,wrapFn:void 0,target:r,type:n,listener:e},s=Ed.bind(t);return s.listener=e,t.wrapFn=s,s}Y.prototype.once=function(n,e){return us(e),this.on(n,Ia(this,n,e)),this};Y.prototype.prependOnceListener=function(n,e){return us(e),this.prependListener(n,Ia(this,n,e)),this};Y.prototype.removeListener=function(n,e){var t,s,i,a,o;if(us(e),s=this._events,s===void 0)return this;if(t=s[n],t===void 0)return this;if(t===e||t.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete s[n],s.removeListener&&this.emit("removeListener",n,t.listener||e));else if(typeof t!="function"){for(i=-1,a=t.length-1;a>=0;a--)if(t[a]===e||t[a].listener===e){o=t[a].listener,i=a;break}if(i<0)return this;i===0?t.shift():Ld(t,i),t.length===1&&(s[n]=t[0]),s.removeListener!==void 0&&this.emit("removeListener",n,o||e)}return this};Y.prototype.off=Y.prototype.removeListener;Y.prototype.removeAllListeners=function(n){var e,t,s;if(t=this._events,t===void 0)return this;if(t.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):t[n]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete t[n]),this;if(arguments.length===0){var i=Object.keys(t),a;for(s=0;s<i.length;++s)a=i[s],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=t[n],typeof e=="function")this.removeListener(n,e);else if(e!==void 0)for(s=e.length-1;s>=0;s--)this.removeListener(n,e[s]);return this};function Ma(r,n,e){var t=r._events;if(t===void 0)return[];var s=t[n];return s===void 0?[]:typeof s=="function"?e?[s.listener||s]:[s]:e?Id(s):ja(s,s.length)}Y.prototype.listeners=function(n){return Ma(this,n,!0)};Y.prototype.rawListeners=function(n){return Ma(this,n,!1)};Y.listenerCount=function(r,n){return typeof r.listenerCount=="function"?r.listenerCount(n):Oa.call(r,n)};Y.prototype.listenerCount=Oa;function Oa(r){var n=this._events;if(n!==void 0){var e=n[r];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}Y.prototype.eventNames=function(){return this._eventsCount>0?ls(this._events):[]};function ja(r,n){for(var e=new Array(n),t=0;t<n;++t)e[t]=r[t];return e}function Ld(r,n){for(;n+1<r.length;n++)r[n]=r[n+1];r.pop()}function Id(r){for(var n=new Array(r.length),e=0;e<n.length;++e)n[e]=r[e].listener||r[e];return n}function Md(r,n){return new Promise(function(e,t){function s(a){r.removeListener(n,i),t(a)}function i(){typeof r.removeListener=="function"&&r.removeListener("error",s),e([].slice.call(arguments))}Aa(r,n,i,{once:!0}),n!=="error"&&Od(r,s,{once:!0})})}function Od(r,n,e){typeof r.on=="function"&&Aa(r,"error",n,e)}function Aa(r,n,e,t){if(typeof r.on=="function")t.once?r.once(n,e):r.on(n,e);else if(typeof r.addEventListener=="function")r.addEventListener(n,function s(i){t.once&&r.removeEventListener(n,s),e(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});var Ze=C(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});hs.EnhancedEventEmitter=void 0;var jd=Na(),Ad=ee(),Nd=new Ad.Logger("EnhancedEventEmitter"),ki=class extends jd.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(n,...e){return super.emit(n,...e)}safeEmit(n,...e){try{return super.emit(n,...e)}catch(t){Nd.error("safeEmit() | event listener threw an error [eventName:%s]:%o",n,t);try{super.emit("listenererror",n,t)}catch{}return!!super.listenerCount(n)}}on(n,e){return super.on(n,e),this}off(n,e){return super.off(n,e),this}addListener(n,e){return super.on(n,e),this}prependListener(n,e){return super.prependListener(n,e),this}once(n,e){return super.once(n,e),this}prependOnceListener(n,e){return super.prependOnceListener(n,e),this}removeListener(n,e){return super.off(n,e),this}removeAllListeners(n){return super.removeAllListeners(n),this}listenerCount(n){return super.listenerCount(n)}listeners(n){return super.listeners(n)}rawListeners(n){return super.rawListeners(n)}};hs.EnhancedEventEmitter=ki});var de=C(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.InvalidStateError=Wt.UnsupportedError=void 0;var xi=class r extends Error{constructor(n){super(n),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,r):this.stack=new Error(n).stack}};Wt.UnsupportedError=xi;var Ei=class r extends Error{constructor(n){super(n),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,r):this.stack=new Error(n).stack}};Wt.InvalidStateError=Ei});var ie=C(Ar=>{"use strict";Object.defineProperty(Ar,"__esModule",{value:!0});Ar.clone=Fd;Ar.generateRandomNumber=qd;Ar.deepFreeze=Fa;function Fd(r){if(r!==void 0)return Number.isNaN(r)?NaN:typeof structuredClone=="function"?structuredClone(r):JSON.parse(JSON.stringify(r))}function qd(){return Math.round(Math.random()*1e7)}function Fa(r){let n=Reflect.ownKeys(r);for(let e of n){let t=r[e];(t&&typeof t=="object"||typeof t=="function")&&Fa(t)}return Object.freeze(r)}});var qa=C(Jt=>{"use strict";var Ud=Jt&&Jt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Jt,"__esModule",{value:!0});Jt.Logger=void 0;var Yt=Ud(Or()),Xt="h264-profile-level-id",Li=class{constructor(n){n?(this._debug=(0,Yt.default)(`${Xt}:${n}`),this._warn=(0,Yt.default)(`${Xt}:WARN:${n}`),this._error=(0,Yt.default)(`${Xt}:ERROR:${n}`)):(this._debug=(0,Yt.default)(Xt),this._warn=(0,Yt.default)(`${Xt}:WARN`),this._error=(0,Yt.default)(`${Xt}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};Jt.Logger=Li});var Ka=C(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.ProfileLevelId=pe.Level=pe.Profile=void 0;pe.parseProfileLevelId=za;pe.profileLevelIdToString=Ha;pe.profileToString=Hd;pe.levelToString=Kd;pe.parseSdpProfileLevelId=Rt;pe.isSameProfile=Vd;pe.isSameProfileAndLevel=Gd;pe.generateProfileLevelIdStringForAnswer=Qd;pe.supportedLevel=Wd;var Bd=qa(),Oe=new Bd.Logger,J;(function(r){r[r.ConstrainedBaseline=1]="ConstrainedBaseline",r[r.Baseline=2]="Baseline",r[r.Main=3]="Main",r[r.ConstrainedHigh=4]="ConstrainedHigh",r[r.High=5]="High",r[r.PredictiveHigh444=6]="PredictiveHigh444"})(J||(pe.Profile=J={}));var P;(function(r){r[r.L1_b=0]="L1_b",r[r.L1=10]="L1",r[r.L1_1=11]="L1_1",r[r.L1_2=12]="L1_2",r[r.L1_3=13]="L1_3",r[r.L2=20]="L2",r[r.L2_1=21]="L2_1",r[r.L2_2=22]="L2_2",r[r.L3=30]="L3",r[r.L3_1=31]="L3_1",r[r.L3_2=32]="L3_2",r[r.L4=40]="L4",r[r.L4_1=41]="L4_1",r[r.L4_2=42]="L4_2",r[r.L5=50]="L5",r[r.L5_1=51]="L5_1",r[r.L5_2=52]="L5_2"})(P||(pe.Level=P={}));var Zt=class{constructor(n,e){this.profile=n,this.level=e}};pe.ProfileLevelId=Zt;var $d=new Zt(J.ConstrainedBaseline,P.L3_1),Ie=class{constructor(n){this.mask=~Ba("x",n),this.masked_value=Ba("1",n)}isMatch(n){return this.masked_value===(n&this.mask)}},Me=class{constructor(n,e,t){this.profile_idc=n,this.profile_iop=e,this.profile=t}},zd=[new Me(66,new Ie("x1xx0000"),J.ConstrainedBaseline),new Me(77,new Ie("1xxx0000"),J.ConstrainedBaseline),new Me(88,new Ie("11xx0000"),J.ConstrainedBaseline),new Me(66,new Ie("x0xx0000"),J.Baseline),new Me(88,new Ie("10xx0000"),J.Baseline),new Me(77,new Ie("0x0x0000"),J.Main),new Me(100,new Ie("00000000"),J.High),new Me(100,new Ie("00001100"),J.ConstrainedHigh),new Me(244,new Ie("00000000"),J.PredictiveHigh444)],Ua=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:P.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:P.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:P.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:P.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:P.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:P.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:P.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:P.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:P.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:P.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:P.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:P.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:P.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:P.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:P.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:P.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:P.L5_2}];function za(r){if(typeof r!="string"||r.length!==6)return;let e=parseInt(r,16);if(e===0)return;let t=e&255,s=e>>8&255,i=e>>16&255,a;switch(t){case P.L1_1:{a=(s&16)!==0?P.L1_b:P.L1_1;break}case P.L1:case P.L1_2:case P.L1_3:case P.L2:case P.L2_1:case P.L2_2:case P.L3:case P.L3_1:case P.L3_2:case P.L4:case P.L4_1:case P.L4_2:case P.L5:case P.L5_1:case P.L5_2:{a=t;break}default:{Oe.warn(`parseProfileLevelId() | unrecognized level_idc [str:${r}, level_idc:${t}]`);return}}for(let o of zd)if(i===o.profile_idc&&o.profile_iop.isMatch(s))return Oe.debug(`parseProfileLevelId() | result [str:${r}, profile:${o.profile}, level:${a}]`),new Zt(o.profile,a);Oe.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${r}, profile_idc:${i}, profile_iop:${s}]`)}function Ha(r){if(r.level==P.L1_b)switch(r.profile){case J.ConstrainedBaseline:return"42f00b";case J.Baseline:return"42100b";case J.Main:return"4d100b";default:{Oe.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${r.profile}`);return}}let n;switch(r.profile){case J.ConstrainedBaseline:{n="42e0";break}case J.Baseline:{n="4200";break}case J.Main:{n="4d00";break}case J.ConstrainedHigh:{n="640c";break}case J.High:{n="6400";break}case J.PredictiveHigh444:{n="f400";break}default:{Oe.warn(`profileLevelIdToString() | unrecognized profile ${r.profile}`);return}}let e=r.level.toString(16);return e.length===1&&(e=`0${e}`),`${n}${e}`}function Hd(r){switch(r){case J.ConstrainedBaseline:return"ConstrainedBaseline";case J.Baseline:return"Baseline";case J.Main:return"Main";case J.ConstrainedHigh:return"ConstrainedHigh";case J.High:return"High";case J.PredictiveHigh444:return"PredictiveHigh444";default:{Oe.warn(`profileToString() | unrecognized profile ${r}`);return}}}function Kd(r){switch(r){case P.L1_b:return"1b";case P.L1:return"1";case P.L1_1:return"1.1";case P.L1_2:return"1.2";case P.L1_3:return"1.3";case P.L2:return"2";case P.L2_1:return"2.1";case P.L2_2:return"2.2";case P.L3:return"3";case P.L3_1:return"3.1";case P.L3_2:return"3.2";case P.L4:return"4";case P.L4_1:return"4.1";case P.L4_2:return"4.2";case P.L5:return"5";case P.L5_1:return"5.1";case P.L5_2:return"5.2";default:{Oe.warn(`levelToString() | unrecognized level ${r}`);return}}}function Rt(r={}){let n=r["profile-level-id"];return n?za(n):$d}function Vd(r={},n={}){let e=Rt(r),t=Rt(n);return!!(e&&t&&e.profile===t.profile)}function Gd(r={},n={}){let e=Rt(r),t=Rt(n);return!!(e&&t&&e.profile===t.profile&&e.level==t.level)}function Qd(r={},n={}){if(!r["profile-level-id"]&&!n["profile-level-id"]){Oe.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}let e=Rt(r),t=Rt(n);if(!e)throw new TypeError("invalid local_profile_level_id");if(!t)throw new TypeError("invalid remote_profile_level_id");if(e.profile!==t.profile)throw new TypeError("H264 Profile mismatch");let s=$a(r)&&$a(n),i=e.level,a=t.level,o=Xd(i,a),d=s?i:o;return Oe.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${e.profile}, level:${d}]`),Ha(new Zt(e.profile,d))}function Wd(r,n){for(let t=Ua.length-1;t>=0;--t){let s=Ua[t];if(s.max_macroblock_frame_size*256<=r&&s.max_macroblocks_per_second<=n*s.max_macroblock_frame_size)return Oe.debug(`supportedLevel() | result [max_frame_pixel_count:${r}, max_fps:${n}, level:${s.level}]`),s.level}Oe.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${r}, max_fps:${n}]`)}function Ba(r,n){return+(n[0]===r)<<7|+(n[1]===r)<<6|+(n[2]===r)<<5|+(n[3]===r)<<4|+(n[4]===r)<<3|+(n[5]===r)<<2|+(n[6]===r)<<1|+(n[7]===r)<<0}function Yd(r,n){return r===P.L1_b?n!==P.L1&&n!==P.L1_b:n===P.L1_b?r!==P.L1:r<n}function Xd(r,n){return Yd(r,n)?r:n}function $a(r={}){let n=r["level-asymmetry-allowed"];return n===!0||n===1||n==="1"}});var le=C(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});Re.validateRtpCapabilities=rp;Re.validateRtpParameters=Ii;Re.validateSctpStreamParameters=sp;Re.validateSctpCapabilities=ip;Re.getExtendedRtpCapabilities=np;Re.getRecvRtpCapabilities=ap;Re.getSendingRtpParameters=op;Re.getSendingRemoteRtpParameters=cp;Re.reduceCodecs=dp;Re.generateProbatorRtpParameters=pp;Re.canSend=lp;Re.canReceive=up;var Va=Ka(),Jd=ie(),Zd="probator",ep=1234,tp=127;function rp(r){if(typeof r!="object")throw new TypeError("caps is not an object");if(r.codecs&&!Array.isArray(r.codecs))throw new TypeError("caps.codecs is not an array");r.codecs||(r.codecs=[]);for(let n of r.codecs)hp(n);if(r.headerExtensions&&!Array.isArray(r.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");r.headerExtensions||(r.headerExtensions=[]);for(let n of r.headerExtensions)mp(n)}function Ii(r){if(typeof r!="object")throw new TypeError("params is not an object");if(r.mid&&typeof r.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(r.codecs))throw new TypeError("missing params.codecs");for(let n of r.codecs)fp(n);if(r.headerExtensions&&!Array.isArray(r.headerExtensions))throw new TypeError("params.headerExtensions is not an array");r.headerExtensions||(r.headerExtensions=[]);for(let n of r.headerExtensions)gp(n);if(r.encodings&&!Array.isArray(r.encodings))throw new TypeError("params.encodings is not an array");r.encodings||(r.encodings=[]);for(let n of r.encodings)_p(n);if(r.rtcp&&typeof r.rtcp!="object")throw new TypeError("params.rtcp is not an object");r.rtcp||(r.rtcp={}),wp(r.rtcp)}function sp(r){if(typeof r!="object")throw new TypeError("params is not an object");if(typeof r.streamId!="number")throw new TypeError("missing params.streamId");let n=!1;if(typeof r.ordered=="boolean"?n=!0:r.ordered=!0,r.maxPacketLifeTime&&typeof r.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(r.maxRetransmits&&typeof r.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(r.maxPacketLifeTime&&r.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(n&&r.ordered&&(r.maxPacketLifeTime||r.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!n&&(r.maxPacketLifeTime||r.maxRetransmits)&&(r.ordered=!1),r.label&&typeof r.label!="string")throw new TypeError("invalid params.label");if(r.protocol&&typeof r.protocol!="string")throw new TypeError("invalid params.protocol")}function ip(r){if(typeof r!="object")throw new TypeError("caps is not an object");if(!r.numStreams||typeof r.numStreams!="object")throw new TypeError("missing caps.numStreams");vp(r.numStreams)}function np(r,n){let e={codecs:[],headerExtensions:[]};for(let t of n.codecs??[]){if(Nr(t))continue;let s=(r.codecs??[]).find(a=>Qa(a,t,{strict:!0,modify:!0}));if(!s)continue;let i={mimeType:s.mimeType,kind:s.kind,clockRate:s.clockRate,channels:s.channels,localPayloadType:s.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:t.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:s.parameters,remoteParameters:t.parameters,rtcpFeedback:bp(s,t)};e.codecs.push(i)}for(let t of e.codecs){let s=r.codecs.find(a=>Nr(a)&&a.parameters.apt===t.localPayloadType),i=n.codecs.find(a=>Nr(a)&&a.parameters.apt===t.remotePayloadType);s&&i&&(t.localRtxPayloadType=s.preferredPayloadType,t.remoteRtxPayloadType=i.preferredPayloadType)}for(let t of n.headerExtensions){let s=r.headerExtensions.find(a=>Sp(a,t));if(!s)continue;let i={kind:t.kind,uri:t.uri,sendId:s.preferredId,recvId:t.preferredId,encrypt:s.preferredEncrypt,direction:"sendrecv"};switch(t.direction){case"sendrecv":{i.direction="sendrecv";break}case"recvonly":{i.direction="sendonly";break}case"sendonly":{i.direction="recvonly";break}case"inactive":{i.direction="inactive";break}}e.headerExtensions.push(i)}return e}function ap(r){let n={codecs:[],headerExtensions:[]};for(let e of r.codecs){let t={mimeType:e.mimeType,kind:e.kind,preferredPayloadType:e.remotePayloadType,clockRate:e.clockRate,channels:e.channels,parameters:e.localParameters,rtcpFeedback:e.rtcpFeedback};if(n.codecs.push(t),!e.remoteRtxPayloadType)continue;let s={mimeType:`${e.kind}/rtx`,kind:e.kind,preferredPayloadType:e.remoteRtxPayloadType,clockRate:e.clockRate,parameters:{apt:e.remotePayloadType},rtcpFeedback:[]};n.codecs.push(s)}for(let e of r.headerExtensions){if(e.direction!=="sendrecv"&&e.direction!=="recvonly")continue;let t={kind:e.kind,uri:e.uri,preferredId:e.recvId,preferredEncrypt:e.encrypt,direction:e.direction};n.headerExtensions.push(t)}return n}function op(r,n){let e={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(let t of n.codecs){if(t.kind!==r)continue;let s={mimeType:t.mimeType,payloadType:t.localPayloadType,clockRate:t.clockRate,channels:t.channels,parameters:t.localParameters,rtcpFeedback:t.rtcpFeedback};if(e.codecs.push(s),t.localRtxPayloadType){let i={mimeType:`${t.kind}/rtx`,payloadType:t.localRtxPayloadType,clockRate:t.clockRate,parameters:{apt:t.localPayloadType},rtcpFeedback:[]};e.codecs.push(i)}}for(let t of n.headerExtensions){if(t.kind&&t.kind!==r||t.direction!=="sendrecv"&&t.direction!=="sendonly")continue;let s={uri:t.uri,id:t.sendId,encrypt:t.encrypt,parameters:{}};e.headerExtensions.push(s)}return e}function cp(r,n){let e={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(let t of n.codecs){if(t.kind!==r)continue;let s={mimeType:t.mimeType,payloadType:t.localPayloadType,clockRate:t.clockRate,channels:t.channels,parameters:t.remoteParameters,rtcpFeedback:t.rtcpFeedback};if(e.codecs.push(s),t.localRtxPayloadType){let i={mimeType:`${t.kind}/rtx`,payloadType:t.localRtxPayloadType,clockRate:t.clockRate,parameters:{apt:t.localPayloadType},rtcpFeedback:[]};e.codecs.push(i)}}for(let t of n.headerExtensions){if(t.kind&&t.kind!==r||t.direction!=="sendrecv"&&t.direction!=="sendonly")continue;let s={uri:t.uri,id:t.sendId,encrypt:t.encrypt,parameters:{}};e.headerExtensions.push(s)}if(e.headerExtensions.some(t=>t.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(let t of e.codecs)t.rtcpFeedback=(t.rtcpFeedback??[]).filter(s=>s.type!=="goog-remb");else if(e.headerExtensions.some(t=>t.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(let t of e.codecs)t.rtcpFeedback=(t.rtcpFeedback??[]).filter(s=>s.type!=="transport-cc");else for(let t of e.codecs)t.rtcpFeedback=(t.rtcpFeedback??[]).filter(s=>s.type!=="transport-cc"&&s.type!=="goog-remb");return e}function dp(r,n){let e=[];if(!n)e.push(r[0]),Nr(r[1])&&e.push(r[1]);else{for(let t=0;t<r.length;++t)if(Qa(r[t],n,{strict:!0})){e.push(r[t]),Nr(r[t+1])&&e.push(r[t+1]);break}if(e.length===0)throw new TypeError("no matching codec found")}return e}function pp(r){r=Jd.clone(r),Ii(r);let n={mid:Zd,codecs:[],headerExtensions:[],encodings:[{ssrc:ep}],rtcp:{cname:"probator"}};return n.codecs.push(r.codecs[0]),n.codecs[0].payloadType=tp,n.headerExtensions=r.headerExtensions,n}function lp(r,n){return n.codecs.some(e=>e.kind===r)}function up(r,n){if(Ii(r),r.codecs.length===0)return!1;let e=r.codecs[0];return n.codecs.some(t=>t.remotePayloadType===e.payloadType)}function hp(r){let n=new RegExp("^(audio|video)/(.+)","i");if(typeof r!="object")throw new TypeError("codec is not an object");if(!r.mimeType||typeof r.mimeType!="string")throw new TypeError("missing codec.mimeType");let e=n.exec(r.mimeType);if(!e)throw new TypeError("invalid codec.mimeType");if(r.kind=e[1].toLowerCase(),r.preferredPayloadType&&typeof r.preferredPayloadType!="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof r.clockRate!="number")throw new TypeError("missing codec.clockRate");r.kind==="audio"?typeof r.channels!="number"&&(r.channels=1):delete r.channels,(!r.parameters||typeof r.parameters!="object")&&(r.parameters={});for(let t of Object.keys(r.parameters)){let s=r.parameters[t];if(s===void 0&&(r.parameters[t]="",s=""),typeof s!="string"&&typeof s!="number")throw new TypeError(`invalid codec parameter [key:${t}s, value:${s}]`);if(t==="apt"&&typeof s!="number")throw new TypeError("invalid codec apt parameter")}(!r.rtcpFeedback||!Array.isArray(r.rtcpFeedback))&&(r.rtcpFeedback=[]);for(let t of r.rtcpFeedback)Ga(t)}function Ga(r){if(typeof r!="object")throw new TypeError("fb is not an object");if(!r.type||typeof r.type!="string")throw new TypeError("missing fb.type");(!r.parameter||typeof r.parameter!="string")&&(r.parameter="")}function mp(r){if(typeof r!="object")throw new TypeError("ext is not an object");if(r.kind!=="audio"&&r.kind!=="video")throw new TypeError("invalid ext.kind");if(!r.uri||typeof r.uri!="string")throw new TypeError("missing ext.uri");if(typeof r.preferredId!="number")throw new TypeError("missing ext.preferredId");if(r.preferredEncrypt&&typeof r.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(r.preferredEncrypt||(r.preferredEncrypt=!1),r.direction&&typeof r.direction!="string")throw new TypeError("invalid ext.direction");r.direction||(r.direction="sendrecv")}function fp(r){let n=new RegExp("^(audio|video)/(.+)","i");if(typeof r!="object")throw new TypeError("codec is not an object");if(!r.mimeType||typeof r.mimeType!="string")throw new TypeError("missing codec.mimeType");let e=n.exec(r.mimeType);if(!e)throw new TypeError("invalid codec.mimeType");if(typeof r.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof r.clockRate!="number")throw new TypeError("missing codec.clockRate");e[1].toLowerCase()==="audio"?typeof r.channels!="number"&&(r.channels=1):delete r.channels,(!r.parameters||typeof r.parameters!="object")&&(r.parameters={});for(let s of Object.keys(r.parameters)){let i=r.parameters[s];if(i===void 0&&(r.parameters[s]="",i=""),typeof i!="string"&&typeof i!="number")throw new TypeError(`invalid codec parameter [key:${s}s, value:${i}]`);if(s==="apt"&&typeof i!="number")throw new TypeError("invalid codec apt parameter")}(!r.rtcpFeedback||!Array.isArray(r.rtcpFeedback))&&(r.rtcpFeedback=[]);for(let s of r.rtcpFeedback)Ga(s)}function gp(r){if(typeof r!="object")throw new TypeError("ext is not an object");if(!r.uri||typeof r.uri!="string")throw new TypeError("missing ext.uri");if(typeof r.id!="number")throw new TypeError("missing ext.id");if(r.encrypt&&typeof r.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");r.encrypt||(r.encrypt=!1),(!r.parameters||typeof r.parameters!="object")&&(r.parameters={});for(let n of Object.keys(r.parameters)){let e=r.parameters[n];if(e===void 0&&(r.parameters[n]="",e=""),typeof e!="string"&&typeof e!="number")throw new TypeError("invalid header extension parameter")}}function _p(r){if(typeof r!="object")throw new TypeError("encoding is not an object");if(r.ssrc&&typeof r.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(r.rid&&typeof r.rid!="string")throw new TypeError("invalid encoding.rid");if(r.rtx&&typeof r.rtx!="object")throw new TypeError("invalid encoding.rtx");if(r.rtx&&typeof r.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!r.dtx||typeof r.dtx!="boolean")&&(r.dtx=!1),r.scalabilityMode&&typeof r.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function wp(r){if(typeof r!="object")throw new TypeError("rtcp is not an object");if(r.cname&&typeof r.cname!="string")throw new TypeError("invalid rtcp.cname");(!r.reducedSize||typeof r.reducedSize!="boolean")&&(r.reducedSize=!0)}function vp(r){if(typeof r!="object")throw new TypeError("numStreams is not an object");if(typeof r.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof r.MIS!="number")throw new TypeError("missing numStreams.MIS")}function Nr(r){return r?/.+\/rtx$/i.test(r.mimeType):!1}function Qa(r,n,{strict:e=!1,modify:t=!1}={}){let s=r.mimeType.toLowerCase(),i=n.mimeType.toLowerCase();if(s!==i||r.clockRate!==n.clockRate||r.channels!==n.channels)return!1;switch(s){case"video/h264":{if(e){let a=r.parameters["packetization-mode"]??0,o=n.parameters["packetization-mode"]??0;if(a!==o||!Va.isSameProfile(r.parameters,n.parameters))return!1;let d;try{d=Va.generateProfileLevelIdStringForAnswer(r.parameters,n.parameters)}catch{return!1}t&&(d?(r.parameters["profile-level-id"]=d,n.parameters["profile-level-id"]=d):(delete r.parameters["profile-level-id"],delete n.parameters["profile-level-id"]))}break}case"video/vp9":{if(e){let a=r.parameters["profile-id"]??0,o=n.parameters["profile-id"]??0;if(a!==o)return!1}break}}return!0}function Sp(r,n){return!(r.kind&&n.kind&&r.kind!==n.kind||r.uri!==n.uri)}function bp(r,n){let e=[];for(let t of r.rtcpFeedback??[]){let s=(n.rtcpFeedback??[]).find(i=>i.type===t.type&&(i.parameter===t.parameter||!i.parameter&&!t.parameter));s&&e.push(s)}return e}});var Wa=C(ms=>{"use strict";Object.defineProperty(ms,"__esModule",{value:!0});ms.Logger=void 0;var er=Or(),tr="awaitqueue",Mi=class{constructor(n){h(this,"_debug");h(this,"_warn");h(this,"_error");n?(this._debug=er(`${tr}:${n}`),this._warn=er(`${tr}:WARN:${n}`),this._error=er(`${tr}:ERROR:${n}`)):(this._debug=er(tr),this._warn=er(`${tr}:WARN`),this._error=er(`${tr}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};ms.Logger=Mi});var Ai=C(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});rr.AwaitQueueRemovedTaskError=rr.AwaitQueueStoppedError=void 0;var Oi=class r extends Error{constructor(n){super(n??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}};rr.AwaitQueueStoppedError=Oi;var ji=class r extends Error{constructor(n){super(n??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}};rr.AwaitQueueRemovedTaskError=ji});var Xa=C(fs=>{"use strict";Object.defineProperty(fs,"__esModule",{value:!0});fs.AwaitQueue=void 0;var yp=Wa(),Ya=Ai(),et=new yp.Logger("AwaitQueue"),Ni=class{constructor(){h(this,"pendingTasks",new Map);h(this,"nextTaskId",0);h(this,"stopping",!1);et.debug("constructor()")}get size(){return this.pendingTasks.size}async push(n,e){if(e=e??n.name,et.debug(`push() [name:${e}]`),typeof n!="function")throw new TypeError("given task is not a function");if(e)try{Object.defineProperty(n,"name",{value:e})}catch{}return new Promise((t,s)=>{let i={id:this.nextTaskId++,task:n,name:e,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:a=>{if(i.completed)return;i.completed=!0,this.pendingTasks.delete(i.id),et.debug(`resolving task [name:${i.name}]`),t(a);let[o]=this.pendingTasks.values();o&&!o.executedAt&&this.execute(o)},reject:a=>{if(!i.completed&&(i.completed=!0,this.pendingTasks.delete(i.id),et.debug(`rejecting task [name:${i.name}]: %s`,String(a)),s(a),!this.stopping)){let[o]=this.pendingTasks.values();o&&!o.executedAt&&this.execute(o)}}};this.pendingTasks.set(i.id,i),this.pendingTasks.size===1&&this.execute(i)})}stop(){et.debug("stop()"),this.stopping=!0;for(let n of this.pendingTasks.values())et.debug(`stop() | stopping task [name:${n.name}]`),n.reject(new Ya.AwaitQueueStoppedError);this.stopping=!1}remove(n){et.debug(`remove() [taskIdx:${n}]`);let e=Array.from(this.pendingTasks.values())[n];if(!e){et.debug(`stop() | no task with given idx [taskIdx:${n}]`);return}e.reject(new Ya.AwaitQueueRemovedTaskError)}dump(){let n=Date.now(),e=0;return Array.from(this.pendingTasks.values()).map(t=>({idx:e++,task:t.task,name:t.name,enqueuedTime:t.executedAt?t.executedAt-t.enqueuedAt:n-t.enqueuedAt,executionTime:t.executedAt?n-t.executedAt:0}))}async execute(n){if(et.debug(`execute() [name:${n.name}]`),n.executedAt)throw new Error("task already being executed");n.executedAt=Date.now();try{let e=await n.task();n.resolve(e)}catch(e){n.reject(e)}}};fs.AwaitQueue=Ni});var Za=C(lt=>{"use strict";Object.defineProperty(lt,"__esModule",{value:!0});lt.AwaitQueueRemovedTaskError=lt.AwaitQueueStoppedError=lt.AwaitQueue=void 0;var Rp=Xa();Object.defineProperty(lt,"AwaitQueue",{enumerable:!0,get:function(){return Rp.AwaitQueue}});var Ja=Ai();Object.defineProperty(lt,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return Ja.AwaitQueueStoppedError}});Object.defineProperty(lt,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return Ja.AwaitQueueRemovedTaskError}})});var qi=C(gs=>{"use strict";Object.defineProperty(gs,"__esModule",{value:!0});gs.Producer=void 0;var Cp=ee(),eo=Ze(),sr=de(),Ne=new Cp.Logger("Producer"),Fi=class extends eo.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:s,track:i,rtpParameters:a,stopTracks:o,disableTrackOnPause:d,zeroRtpOnPause:p,appData:l}){super();h(this,"_id");h(this,"_localId");h(this,"_closed",!1);h(this,"_rtpSender");h(this,"_track");h(this,"_kind");h(this,"_rtpParameters");h(this,"_paused");h(this,"_maxSpatialLayer");h(this,"_stopTracks");h(this,"_disableTrackOnPause");h(this,"_zeroRtpOnPause");h(this,"_appData");h(this,"_observer",new eo.EnhancedEventEmitter);Ne.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=s,this._track=i,this._kind=i.kind,this._rtpParameters=a,this._paused=d?!i.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=o,this._disableTrackOnPause=d,this._zeroRtpOnPause=p,this._appData=l??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(Ne.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(Ne.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new sr.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){if(Ne.debug("pause()"),this._closed){Ne.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@pause",e,t)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(Ne.debug("resume()"),this._closed){Ne.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@resume",e,t)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:e}){if(Ne.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch{}throw new sr.InvalidStateError("closed")}else if(e&&e.readyState==="ended")throw new sr.InvalidStateError("track ended");if(e===this._track){Ne.debug("replaceTrack() | same track, ignored");return}await new Promise((t,s)=>{this.safeEmit("@replacetrack",e,t,s)}),this.destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(e){if(this._closed)throw new sr.InvalidStateError("closed");if(this._kind!=="video")throw new sr.UnsupportedError("not a video Producer");if(typeof e!="number")throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await new Promise((t,s)=>{this.safeEmit("@setmaxspatiallayer",e,t,s)}).catch(()=>{}),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new sr.InvalidStateError("closed");if(typeof e!="object")throw new TypeError("invalid params");await new Promise((t,s)=>{this.safeEmit("@setrtpencodingparameters",e,t,s)})}onTrackEnded(){Ne.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}};gs.Producer=Fi});var Bi=C(_s=>{"use strict";Object.defineProperty(_s,"__esModule",{value:!0});_s.Consumer=void 0;var Tp=ee(),to=Ze(),Dp=de(),Fe=new Tp.Logger("Consumer"),Ui=class extends to.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:s,rtpReceiver:i,track:a,rtpParameters:o,appData:d}){super();h(this,"_id");h(this,"_localId");h(this,"_producerId");h(this,"_closed",!1);h(this,"_rtpReceiver");h(this,"_track");h(this,"_rtpParameters");h(this,"_paused");h(this,"_appData");h(this,"_observer",new to.EnhancedEventEmitter);Fe.debug("constructor()"),this._id=e,this._localId=t,this._producerId=s,this._rtpReceiver=i,this._track=a,this._rtpParameters=o,this._paused=!a.enabled,this._appData=d??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(Fe.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(Fe.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new Dp.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){if(Fe.debug("pause()"),this._closed){Fe.error("pause() | Consumer closed");return}if(this._paused){Fe.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(Fe.debug("resume()"),this._closed){Fe.error("resume() | Consumer closed");return}if(!this._paused){Fe.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){Fe.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}};_s.Consumer=Ui});var zi=C(ws=>{"use strict";Object.defineProperty(ws,"__esModule",{value:!0});ws.DataProducer=void 0;var Pp=ee(),ro=Ze(),kp=de(),tt=new Pp.Logger("DataProducer"),$i=class extends ro.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:s,appData:i}){super();h(this,"_id");h(this,"_dataChannel");h(this,"_closed",!1);h(this,"_sctpStreamParameters");h(this,"_appData");h(this,"_observer",new ro.EnhancedEventEmitter);tt.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=s,this._appData=i??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(tt.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(tt.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(tt.debug("send()"),this._closed)throw new kp.InvalidStateError("closed");this._dataChannel.send(e)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(tt.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),t.errorDetail==="sctp-failure"?tt.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):tt.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(tt.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||tt.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}};ws.DataProducer=$i});var Ki=C(vs=>{"use strict";Object.defineProperty(vs,"__esModule",{value:!0});vs.DataConsumer=void 0;var xp=ee(),so=Ze(),Ct=new xp.Logger("DataConsumer"),Hi=class extends so.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:s,sctpStreamParameters:i,appData:a}){super();h(this,"_id");h(this,"_dataProducerId");h(this,"_dataChannel");h(this,"_closed",!1);h(this,"_sctpStreamParameters");h(this,"_appData");h(this,"_observer",new so.EnhancedEventEmitter);Ct.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=s,this._sctpStreamParameters=i,this._appData=a??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(Ct.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(Ct.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(Ct.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),t.errorDetail==="sctp-failure"?Ct.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):Ct.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(Ct.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",e=>{this._closed||this.safeEmit("message",e.data)})}};vs.DataConsumer=Hi});var Wi=C(Ss=>{"use strict";Object.defineProperty(Ss,"__esModule",{value:!0});Ss.Transport=void 0;var Ep=Za(),Lp=ee(),io=Ze(),oe=de(),Vi=ie(),Fr=le(),Ip=qi(),Mp=Bi(),Op=zi(),jp=Ki(),se=new Lp.Logger("Transport"),Gi=class{constructor(n){h(this,"consumerOptions");h(this,"promise");h(this,"resolve");h(this,"reject");this.consumerOptions=n,this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}},Qi=class extends io.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:s,iceCandidates:i,dtlsParameters:a,sctpParameters:o,iceServers:d,iceTransportPolicy:p,additionalSettings:l,proprietaryConstraints:c,appData:u,handlerFactory:m,extendedRtpCapabilities:_,canProduceByKind:b}){super();h(this,"_id");h(this,"_closed",!1);h(this,"_direction");h(this,"_extendedRtpCapabilities");h(this,"_canProduceByKind");h(this,"_maxSctpMessageSize");h(this,"_handler");h(this,"_iceGatheringState","new");h(this,"_connectionState","new");h(this,"_appData");h(this,"_producers",new Map);h(this,"_consumers",new Map);h(this,"_dataProducers",new Map);h(this,"_dataConsumers",new Map);h(this,"_probatorConsumerCreated",!1);h(this,"_awaitQueue",new Ep.AwaitQueue);h(this,"_pendingConsumerTasks",[]);h(this,"_consumerCreationInProgress",!1);h(this,"_pendingPauseConsumers",new Map);h(this,"_consumerPauseInProgress",!1);h(this,"_pendingResumeConsumers",new Map);h(this,"_consumerResumeInProgress",!1);h(this,"_pendingCloseConsumers",new Map);h(this,"_consumerCloseInProgress",!1);h(this,"_observer",new io.EnhancedEventEmitter);se.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=_,this._canProduceByKind=b,this._maxSctpMessageSize=o?o.maxMessageSize:null;let v=Vi.clone(l)??{};delete v.iceServers,delete v.iceTransportPolicy,delete v.bundlePolicy,delete v.rtcpMuxPolicy,delete v.sdpSemantics,this._handler=m(),this._handler.run({direction:e,iceParameters:s,iceCandidates:i,dtlsParameters:a,sctpParameters:o,iceServers:d,iceTransportPolicy:p,additionalSettings:v,proprietaryConstraints:c,extendedRtpCapabilities:_}),this._appData=u??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){if(!this._closed){se.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(let e of this._producers.values())e.transportClosed();this._producers.clear();for(let e of this._consumers.values())e.transportClosed();this._consumers.clear();for(let e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(let e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new oe.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(se.debug("restartIce()"),this._closed)throw new oe.InvalidStateError("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(e),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(se.debug("updateIceServers()"),this._closed)throw new oe.InvalidStateError("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(e),"transport.updateIceServers()")}async produce({track:e,encodings:t,codecOptions:s,codec:i,stopTracks:a=!0,disableTrackOnPause:o=!0,zeroRtpOnPause:d=!1,onRtpSender:p,appData:l={}}={}){if(se.debug("produce() [track:%o]",e),this._closed)throw new oe.InvalidStateError("closed");if(e){if(this._direction!=="send")throw new oe.UnsupportedError("not a sending Transport");if(this._canProduceByKind[e.kind]){if(e.readyState==="ended")throw new oe.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(l&&typeof l!="object")throw new TypeError("if given, appData must be an object")}else throw new oe.UnsupportedError(`cannot produce ${e.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let c;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");t&&t.length===0?c=void 0:t&&(c=t.map(b=>{let v={active:!0};return b.active===!1&&(v.active=!1),typeof b.dtx=="boolean"&&(v.dtx=b.dtx),typeof b.scalabilityMode=="string"&&(v.scalabilityMode=b.scalabilityMode),typeof b.scaleResolutionDownBy=="number"&&(v.scaleResolutionDownBy=b.scaleResolutionDownBy),typeof b.maxBitrate=="number"&&(v.maxBitrate=b.maxBitrate),typeof b.maxFramerate=="number"&&(v.maxFramerate=b.maxFramerate),typeof b.adaptivePtime=="boolean"&&(v.adaptivePtime=b.adaptivePtime),typeof b.priority=="string"&&(v.priority=b.priority),typeof b.networkPriority=="string"&&(v.networkPriority=b.networkPriority),v}));let{localId:u,rtpParameters:m,rtpSender:_}=await this._handler.send({track:e,encodings:c,codecOptions:s,codec:i,onRtpSender:p});try{Fr.validateRtpParameters(m);let{id:b}=await new Promise((f,g)=>{this.safeEmit("produce",{kind:e.kind,rtpParameters:m,appData:l},f,g)}),v=new Ip.Producer({id:b,localId:u,rtpSender:_,track:e,rtpParameters:m,stopTracks:a,disableTrackOnPause:o,zeroRtpOnPause:d,appData:l});return this._producers.set(v.id,v),this.handleProducer(v),this._observer.safeEmit("newproducer",v),v}catch(b){throw this._handler.stopSending(u).catch(()=>{}),b}},"transport.produce()").catch(c=>{if(a)try{e.stop()}catch{}throw c})}async consume({id:e,producerId:t,kind:s,rtpParameters:i,streamId:a,onRtpReceiver:o,appData:d={}}){if(se.debug("consume()"),this._closed)throw new oe.InvalidStateError("closed");if(this._direction!=="recv")throw new oe.UnsupportedError("not a receiving Transport");if(typeof e!="string")throw new TypeError("missing id");if(typeof t!="string")throw new TypeError("missing producerId");if(s!=="audio"&&s!=="video")throw new TypeError(`invalid kind '${s}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(d&&typeof d!="object")throw new TypeError("if given, appData must be an object");let p=Vi.clone(i);if(!Fr.canReceive(p,this._extendedRtpCapabilities))throw new oe.UnsupportedError("cannot consume this Producer");let c=new Gi({id:e,producerId:t,kind:s,rtpParameters:p,streamId:a,onRtpReceiver:o,appData:d});return this._pendingConsumerTasks.push(c),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),c.promise}async produceData({ordered:e=!0,maxPacketLifeTime:t,maxRetransmits:s,label:i="",protocol:a="",appData:o={}}={}){if(se.debug("produceData()"),this._closed)throw new oe.InvalidStateError("closed");if(this._direction!=="send")throw new oe.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(o&&typeof o!="object")throw new TypeError("if given, appData must be an object")}else throw new oe.UnsupportedError("SCTP not enabled by remote Transport");return(t||s)&&(e=!1),this._awaitQueue.push(async()=>{let{dataChannel:d,sctpStreamParameters:p}=await this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:a});Fr.validateSctpStreamParameters(p);let{id:l}=await new Promise((u,m)=>{this.safeEmit("producedata",{sctpStreamParameters:p,label:i,protocol:a,appData:o},u,m)}),c=new Op.DataProducer({id:l,dataChannel:d,sctpStreamParameters:p,appData:o});return this._dataProducers.set(c.id,c),this.handleDataProducer(c),this._observer.safeEmit("newdataproducer",c),c},"transport.produceData()")}async consumeData({id:e,dataProducerId:t,sctpStreamParameters:s,label:i="",protocol:a="",appData:o={}}){if(se.debug("consumeData()"),this._closed)throw new oe.InvalidStateError("closed");if(this._direction!=="recv")throw new oe.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof e!="string")throw new TypeError("missing id");if(typeof t!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(o&&typeof o!="object")throw new TypeError("if given, appData must be an object")}else throw new oe.UnsupportedError("SCTP not enabled by remote Transport");let d=Vi.clone(s);return Fr.validateSctpStreamParameters(d),this._awaitQueue.push(async()=>{let{dataChannel:p}=await this._handler.receiveDataChannel({sctpStreamParameters:d,label:i,protocol:a}),l=new jp.DataConsumer({id:e,dataProducerId:t,dataChannel:p,sctpStreamParameters:d,appData:o});return this._dataConsumers.set(l.id,l),this.handleDataConsumer(l),this._observer.safeEmit("newdataconsumer",l),l},"transport.consumeData()")}createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){se.debug("createPendingConsumers() | there is no Consumer to be created");return}let e=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let t,s=[];for(let i of e){let{id:a,kind:o,rtpParameters:d,streamId:p,onRtpReceiver:l}=i.consumerOptions;s.push({trackId:a,kind:o,rtpParameters:d,streamId:p,onRtpReceiver:l})}try{let i=await this._handler.receive(s);for(let a=0;a<i.length;++a){let o=e[a],d=i[a],{id:p,producerId:l,kind:c,rtpParameters:u,appData:m}=o.consumerOptions,{localId:_,rtpReceiver:b,track:v}=d,f=new Mp.Consumer({id:p,localId:_,producerId:l,rtpReceiver:b,track:v,rtpParameters:u,appData:m});this._consumers.set(f.id,f),this.handleConsumer(f),!this._probatorConsumerCreated&&!t&&c==="video"&&(t=f),this._observer.safeEmit("newconsumer",f),o.resolve(f)}}catch(i){for(let a of e)a.reject(i)}if(t)try{let i=Fr.generateProbatorRtpParameters(t.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:i}]),se.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(i){se.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",i)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){se.debug("pausePendingConsumers() | there is no Consumer to be paused");return}let e=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{let t=e.map(s=>s.localId);await this._handler.pauseReceiving(t)}catch(t){se.error("pausePendingConsumers() | failed to pause Consumers:",t)}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){se.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}let e=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{let t=e.map(s=>s.localId);await this._handler.resumeReceiving(t)}catch(t){se.error("resumePendingConsumers() | failed to resume Consumers:",t)}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){se.debug("closePendingConsumers() | there is no Consumer to be closed");return}let e=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(e.map(t=>t.localId))}catch(t){se.error("closePendingConsumers() | failed to close Consumers:",t)}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){let e=this._handler;e.on("@connect",({dtlsParameters:t},s,i)=>{if(this._closed){i(new oe.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:t},s,i)}),e.on("@icegatheringstatechange",t=>{t!==this._iceGatheringState&&(se.debug("ICE gathering state changed to %s",t),this._iceGatheringState=t,this._closed||this.safeEmit("icegatheringstatechange",t))}),e.on("@icecandidateerror",t=>{se.warn(`ICE candidate error [url:${t.url}, localAddress:${t.address}, localPort:${t.port}]: ${t.errorCode} "${t.errorText}"`),this.safeEmit("icecandidateerror",t)}),e.on("@connectionstatechange",t=>{t!==this._connectionState&&(se.debug("connection state changed to %s",t),this._connectionState=t,this._closed||this.safeEmit("connectionstatechange",t))})}handleProducer(e){e.on("@close",()=>{this._producers.delete(e.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(e.localId),"producer @close event").catch(t=>se.warn("producer.close() failed:%o",t))}),e.on("@pause",(t,s)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(e.localId),"producer @pause event").then(t).catch(s)}),e.on("@resume",(t,s)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(e.localId),"producer @resume event").then(t).catch(s)}),e.on("@replacetrack",(t,s,i)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(e.localId,t),"producer @replacetrack event").then(s).catch(i)}),e.on("@setmaxspatiallayer",(t,s,i)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(e.localId,t),"producer @setmaxspatiallayer event").then(s).catch(i)}),e.on("@setrtpencodingparameters",(t,s,i)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(e.localId,t),"producer @setrtpencodingparameters event").then(s).catch(i)}),e.on("@getstats",(t,s)=>{if(this._closed)return s(new oe.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(s)})}handleConsumer(e){e.on("@close",()=>{this._consumers.delete(e.id),this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.delete(e.id),!this._closed&&(this._pendingCloseConsumers.set(e.id,e),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),e.on("@pause",()=>{this._pendingResumeConsumers.has(e.id)&&this._pendingResumeConsumers.delete(e.id),this._pendingPauseConsumers.set(e.id,e),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),e.on("@resume",()=>{this._pendingPauseConsumers.has(e.id)&&this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.set(e.id,e),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),e.on("@getstats",(t,s)=>{if(this._closed)return s(new oe.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(s)})}handleDataProducer(e){e.on("@close",()=>{this._dataProducers.delete(e.id)})}handleDataConsumer(e){e.on("@close",()=>{this._dataConsumers.delete(e.id)})}};Ss.Transport=Qi});var bs=C((km,ao)=>{var no=ao.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(r){return r.encoding?"rtpmap:%d %s/%s/%s":r.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(r){return r.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(r){return r.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(r){return"extmap:%d"+(r.direction?"/%s":"%v")+(r["encrypt-uri"]?" %s":"%v")+" %s"+(r.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(r){return r.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(r){var n="candidate:%s %d %s %d %s %d typ %s";return n+=r.raddr!=null?" raddr %s rport %d":"%v%v",n+=r.tcptype!=null?" tcptype %s":"%v",r.generation!=null&&(n+=" generation %d"),n+=r["network-id"]!=null?" network-id %d":"%v",n+=r["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(r){var n="ssrc:%d";return r.attribute!=null&&(n+=" %s",r.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(r){return r.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(r){return r.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(r){return"imageattr:%s %s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(r){return"simulcast:%s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(r){return"ts-refclk:%s"+(r.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(r){var n="mediaclk:";return n+=r.id!=null?"id=%s %s":"%v%s",n+=r.mediaClockValue!=null?"=%s":"",n+=r.rateNumerator!=null?" rate=%s":"",n+=r.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(no).forEach(function(r){var n=no[r];n.forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})});var po=C(rt=>{var ir=function(r){return String(Number(r))===r?Number(r):r},Ap=function(r,n,e,t){if(t&&!e)n[t]=ir(r[1]);else for(var s=0;s<e.length;s+=1)r[s+1]!=null&&(n[e[s]]=ir(r[s+1]))},Np=function(r,n,e){var t=r.name&&r.names;r.push&&!n[r.push]?n[r.push]=[]:t&&!n[r.name]&&(n[r.name]={});var s=r.push?{}:t?n[r.name]:n;Ap(e.match(r.reg),s,r.names,r.name),r.push&&n[r.push].push(s)},oo=bs(),Fp=RegExp.prototype.test.bind(/^([a-z])=(.*)/);rt.parse=function(r){var n={},e=[],t=n;return r.split(/(\r\n|\r|\n)/).filter(Fp).forEach(function(s){var i=s[0],a=s.slice(2);i==="m"&&(e.push({rtp:[],fmtp:[]}),t=e[e.length-1]);for(var o=0;o<(oo[i]||[]).length;o+=1){var d=oo[i][o];if(d.reg.test(a))return Np(d,t,a)}}),n.media=e,n};var co=function(r,n){var e=n.split(/=(.+)/,2);return e.length===2?r[e[0]]=ir(e[1]):e.length===1&&n.length>1&&(r[e[0]]=void 0),r};rt.parseParams=function(r){return r.split(/;\s?/).reduce(co,{})};rt.parseFmtpConfig=rt.parseParams;rt.parsePayloads=function(r){return r.toString().split(" ").map(Number)};rt.parseRemoteCandidates=function(r){for(var n=[],e=r.split(" ").map(ir),t=0;t<e.length;t+=3)n.push({component:e[t],ip:e[t+1],port:e[t+2]});return n};rt.parseImageAttributes=function(r){return r.split(" ").map(function(n){return n.substring(1,n.length-1).split(",").reduce(co,{})})};rt.parseSimulcastStreamList=function(r){return r.split(";").map(function(n){return n.split(",").map(function(e){var t,s=!1;return e[0]!=="~"?t=ir(e):(t=ir(e.substring(1,e.length)),s=!0),{scid:t,paused:s}})})}});var uo=C((Em,lo)=>{var Yi=bs(),qp=/%[sdv%]/g,Up=function(r){var n=1,e=arguments,t=e.length;return r.replace(qp,function(s){if(n>=t)return s;var i=e[n];switch(n+=1,s){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})},qr=function(r,n,e){var t=n.format instanceof Function?n.format(n.push?e:e[n.name]):n.format,s=[r+"="+t];if(n.names)for(var i=0;i<n.names.length;i+=1){var a=n.names[i];n.name?s.push(e[n.name][a]):s.push(e[n.names[i]])}else s.push(e[n.name]);return Up.apply(null,s)},Bp=["v","o","s","i","u","e","p","c","b","t","r","z","a"],$p=["i","c","b","a"];lo.exports=function(r,n){n=n||{},r.version==null&&(r.version=0),r.name==null&&(r.name=" "),r.media.forEach(function(i){i.payloads==null&&(i.payloads="")});var e=n.outerOrder||Bp,t=n.innerOrder||$p,s=[];return e.forEach(function(i){Yi[i].forEach(function(a){a.name in r&&r[a.name]!=null?s.push(qr(i,a,r)):a.push in r&&r[a.push]!=null&&r[a.push].forEach(function(o){s.push(qr(i,a,o))})})}),r.media.forEach(function(i){s.push(qr("m",Yi.m[0],i)),t.forEach(function(a){Yi[a].forEach(function(o){o.name in i&&i[o.name]!=null?s.push(qr(a,o,i)):o.push in i&&i[o.push]!=null&&i[o.push].forEach(function(d){s.push(qr(a,o,d))})})})}),s.join(`\r
`)+`\r
`}});var Se=C(qe=>{var Tt=po(),zp=uo(),Hp=bs();qe.grammar=Hp;qe.write=zp;qe.parse=Tt.parse;qe.parseParams=Tt.parseParams;qe.parseFmtpConfig=Tt.parseFmtpConfig;qe.parsePayloads=Tt.parsePayloads;qe.parseRemoteCandidates=Tt.parseRemoteCandidates;qe.parseImageAttributes=Tt.parseImageAttributes;qe.parseSimulcastStreamList=Tt.parseSimulcastStreamList});var Pe=C(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.extractRtpCapabilities=Kp;nr.extractDtlsParameters=Vp;nr.getCname=Gp;nr.applyCodecParameters=Qp;var ho=Se();function Kp({sdpObject:r}){let n=new Map,e=[],t=!1,s=!1;for(let a of r.media){let o=a.type;switch(o){case"audio":{if(t)continue;t=!0;break}case"video":{if(s)continue;s=!0;break}default:continue}for(let d of a.rtp){let p={kind:o,mimeType:`${o}/${d.codec}`,preferredPayloadType:d.payload,clockRate:d.rate,channels:d.encoding,parameters:{},rtcpFeedback:[]};n.set(p.preferredPayloadType,p)}for(let d of a.fmtp??[]){let p=ho.parseParams(d.config),l=n.get(d.payload);l&&(p?.hasOwnProperty("profile-level-id")&&(p["profile-level-id"]=String(p["profile-level-id"])),l.parameters=p)}for(let d of a.rtcpFb??[]){let p={type:d.type,parameter:d.subtype};if(p.parameter||delete p.parameter,d.payload!=="*"){let l=n.get(d.payload);if(!l)continue;l.rtcpFeedback.push(p)}else for(let l of n.values())l.kind===o&&!/.+\/rtx$/i.test(l.mimeType)&&l.rtcpFeedback.push(p)}for(let d of a.ext??[]){if(d["encrypt-uri"])continue;let p={kind:o,uri:d.uri,preferredId:d.value};e.push(p)}}return{codecs:Array.from(n.values()),headerExtensions:e}}function Vp({sdpObject:r}){let n=r.setup,e=r.fingerprint;if(!n||!e){let i=(r.media??[]).find(a=>a.port!==0);i&&(n??(n=i.setup),e??(e=i.fingerprint))}if(n){if(!e)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let t;switch(n){case"active":{t="client";break}case"passive":{t="server";break}case"actpass":{t="auto";break}}return{role:t,fingerprints:[{algorithm:e.type,value:e.hash}]}}function Gp({offerMediaObject:r}){let n=(r.ssrcs??[]).find(e=>e.attribute==="cname");return n?n.value:""}function Qp({offerRtpParameters:r,answerMediaObject:n}){for(let e of r.codecs){let t=e.mimeType.toLowerCase();if(t!=="audio/opus"||!(n.rtp??[]).find(o=>o.payload===e.payloadType))continue;n.fmtp=n.fmtp??[];let i=n.fmtp.find(o=>o.payload===e.payloadType);i||(i={payload:e.payloadType,config:""},n.fmtp.push(i));let a=ho.parseParams(i.config);switch(t){case"audio/opus":{let o=e.parameters["sprop-stereo"];o!==void 0&&(a.stereo=Number(o)?1:0);break}}i.config="";for(let o of Object.keys(a))i.config&&(i.config+=";"),i.config+=`${o}=${a[o]}`}}});var ut=C(ys=>{"use strict";Object.defineProperty(ys,"__esModule",{value:!0});ys.getRtpEncodings=Wp;ys.addLegacySimulcast=Yp;function Wp({offerMediaObject:r}){let n=new Set;for(let s of r.ssrcs??[]){let i=s.id;n.add(i)}if(n.size===0)throw new Error("no a=ssrc lines found");let e=new Map;for(let s of r.ssrcGroups??[]){if(s.semantics!=="FID")continue;let[i,a]=s.ssrcs.split(/\s+/);i=Number(i),a=Number(a),n.has(i)&&(n.delete(i),n.delete(a),e.set(i,a))}for(let s of n)e.set(s,null);let t=[];for(let[s,i]of e){let a={ssrc:s};i&&(a.rtx={ssrc:i}),t.push(a)}return t}function Yp({offerMediaObject:r,numStreams:n}){if(n<=1)throw new TypeError("numStreams must be greater than 1");let e=(r.ssrcs??[]).find(c=>c.attribute==="msid");if(!e)throw new Error("a=ssrc line with msid information not found");let[t,s]=e.value.split(" "),i=Number(e.id),a;(r.ssrcGroups??[]).some(c=>{if(c.semantics!=="FID")return!1;let u=c.ssrcs.split(/\s+/);return Number(u[0])===i?(a=Number(u[1]),!0):!1});let o=r.ssrcs.find(c=>c.attribute==="cname");if(!o)throw new Error("a=ssrc line with cname information not found");let d=o.value,p=[],l=[];for(let c=0;c<n;++c)p.push(i+c),a&&l.push(a+c);r.ssrcGroups=[],r.ssrcs=[],r.ssrcGroups.push({semantics:"SIM",ssrcs:p.join(" ")});for(let c of p)r.ssrcs.push({id:c,attribute:"cname",value:d}),r.ssrcs.push({id:c,attribute:"msid",value:`${t} ${s}`});for(let c=0;c<l.length;++c){let u=p[c],m=l[c];r.ssrcs.push({id:m,attribute:"cname",value:d}),r.ssrcs.push({id:m,attribute:"msid",value:`${t} ${s}`}),r.ssrcGroups.push({semantics:"FID",ssrcs:`${u} ${m}`})}}});var Ur=C(Xi=>{"use strict";Object.defineProperty(Xi,"__esModule",{value:!0});Xi.addNackSupportForOpus=Xp;function Xp(r){for(let n of r.codecs??[])(n.mimeType.toLowerCase()==="audio/opus"||n.mimeType.toLowerCase()==="audio/multiopus")&&!n.rtcpFeedback?.some(e=>e.type==="nack"&&!e.parameter)&&(n.rtcpFeedback||(n.rtcpFeedback=[]),n.rtcpFeedback.push({type:"nack"}))}});var be=C(Rs=>{"use strict";Object.defineProperty(Rs,"__esModule",{value:!0});Rs.HandlerInterface=void 0;var Jp=Ze(),Ji=class extends Jp.EnhancedEventEmitter{constructor(){super()}};Rs.HandlerInterface=Ji});var fo=C(ht=>{"use strict";Object.defineProperty(ht,"__esModule",{value:!0});ht.OfferMediaSection=ht.AnswerMediaSection=ht.MediaSection=void 0;var Zp=Se(),mo=ie(),Br=class{constructor({iceParameters:n,iceCandidates:e,dtlsParameters:t,planB:s=!1}){h(this,"_mediaObject");h(this,"_planB");if(this._mediaObject={},this._planB=s,n&&this.setIceParameters(n),e){this._mediaObject.candidates=[];for(let i of e){let a={};a.component=1,a.foundation=i.foundation,a.ip=i.address??i.ip,a.port=i.port,a.priority=i.priority,a.transport=i.protocol,a.type=i.type,i.tcpType&&(a.tcptype=i.tcpType),this._mediaObject.candidates.push(a)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}t&&this.setDtlsRole(t.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(n){this._mediaObject.iceUfrag=n.usernameFragment,this._mediaObject.icePwd=n.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}};ht.MediaSection=Br;var Zi=class extends Br{constructor({iceParameters:n,iceCandidates:e,dtlsParameters:t,sctpParameters:s,plainRtpParameters:i,planB:a=!1,offerMediaObject:o,offerRtpParameters:d,answerRtpParameters:p,codecOptions:l}){switch(super({iceParameters:n,iceCandidates:e,dtlsParameters:t,planB:a}),this._mediaObject.mid=String(o.mid),this._mediaObject.type=o.type,this._mediaObject.protocol=o.protocol,i?(this._mediaObject.connection={ip:i.ip,version:i.ipVersion},this._mediaObject.port=i.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),o.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(let c of p.codecs){let u={payload:c.payloadType,codec:tn(c),rate:c.clockRate};c.channels>1&&(u.encoding=c.channels),this._mediaObject.rtp.push(u);let m=mo.clone(c.parameters)??{},_=mo.clone(c.rtcpFeedback)??[];if(l){let{opusStereo:v,opusFec:f,opusDtx:g,opusMaxPlaybackRate:w,opusMaxAverageBitrate:y,opusPtime:ae,opusNack:Ee,videoGoogleStartBitrate:S,videoGoogleMaxBitrate:Le,videoGoogleMinBitrate:A}=l,B=d.codecs.find(W=>W.payloadType===c.payloadType);switch(c.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{v!==void 0&&(B.parameters["sprop-stereo"]=v?1:0,m.stereo=v?1:0),f!==void 0&&(B.parameters.useinbandfec=f?1:0,m.useinbandfec=f?1:0),g!==void 0&&(B.parameters.usedtx=g?1:0,m.usedtx=g?1:0),w!==void 0&&(m.maxplaybackrate=w),y!==void 0&&(m.maxaveragebitrate=y),ae!==void 0&&(B.parameters.ptime=ae,m.ptime=ae),Ee||(B.rtcpFeedback=B.rtcpFeedback.filter(W=>W.type!=="nack"||W.parameter),_=_.filter(W=>W.type!=="nack"||W.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":{S!==void 0&&(m["x-google-start-bitrate"]=S),Le!==void 0&&(m["x-google-max-bitrate"]=Le),A!==void 0&&(m["x-google-min-bitrate"]=A);break}}}let b={payload:c.payloadType,config:""};for(let v of Object.keys(m))b.config&&(b.config+=";"),b.config+=`${v}=${m[v]}`;b.config&&this._mediaObject.fmtp.push(b);for(let v of _)this._mediaObject.rtcpFb.push({payload:c.payloadType,type:v.type,subtype:v.parameter})}this._mediaObject.payloads=p.codecs.map(c=>c.payloadType).join(" "),this._mediaObject.ext=[];for(let c of p.headerExtensions)(o.ext??[]).some(m=>m.uri===c.uri)&&this._mediaObject.ext.push({uri:c.uri,value:c.id});if(o.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),o.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:o.simulcast.list1},this._mediaObject.rids=[];for(let c of o.rids??[])c.direction==="send"&&this._mediaObject.rids.push({id:c.id,direction:"recv"})}else if(o.simulcast_03){this._mediaObject.simulcast_03={value:o.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(let c of o.rids??[])c.direction==="send"&&this._mediaObject.rids.push({id:c.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&this._mediaObject.type==="video"&&(this._mediaObject.xGoogleFlag="conference");break}case"application":{typeof o.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=s.port,this._mediaObject.maxMessageSize=s.maxMessageSize):o.sctpmap&&(this._mediaObject.payloads=s.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:s.port,maxMessageSize:s.maxMessageSize});break}}}setDtlsRole(n){switch(n){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(n){if(!this._mediaObject.simulcast?.list1)return;let e={};for(let i of n)i.rid&&(e[i.rid]=i);let t=this._mediaObject.simulcast.list1,s=Zp.parseSimulcastStreamList(t);for(let i of s)for(let a of i)a.paused=!e[a.scid]?.active;this._mediaObject.simulcast.list1=s.map(i=>i.map(a=>`${a.paused?"~":""}${a.scid}`).join(",")).join(";")}};ht.AnswerMediaSection=Zi;var en=class extends Br{constructor({iceParameters:n,iceCandidates:e,dtlsParameters:t,sctpParameters:s,plainRtpParameters:i,planB:a=!1,mid:o,kind:d,offerRtpParameters:p,streamId:l,trackId:c,oldDataChannelSpec:u=!1}){switch(super({iceParameters:n,iceCandidates:e,dtlsParameters:t,planB:a}),this._mediaObject.mid=String(o),this._mediaObject.type=d,i?(this._mediaObject.connection={ip:i.ip,version:i.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=i.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},s?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),this._mediaObject.extmapAllowMixed="extmap-allow-mixed",d){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${l??"-"} ${c}`);for(let v of p.codecs){let f={payload:v.payloadType,codec:tn(v),rate:v.clockRate};v.channels>1&&(f.encoding=v.channels),this._mediaObject.rtp.push(f);let g={payload:v.payloadType,config:""};for(let w of Object.keys(v.parameters))g.config&&(g.config+=";"),g.config+=`${w}=${v.parameters[w]}`;g.config&&this._mediaObject.fmtp.push(g);for(let w of v.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:v.payloadType,type:w.type,subtype:w.parameter})}this._mediaObject.payloads=p.codecs.map(v=>v.payloadType).join(" "),this._mediaObject.ext=[];for(let v of p.headerExtensions)this._mediaObject.ext.push({uri:v.uri,value:v.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";let m=p.encodings[0],_=m.ssrc,b=m.rtx?.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],p.rtcp.cname&&this._mediaObject.ssrcs.push({id:_,attribute:"cname",value:p.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:_,attribute:"msid",value:`${l??"-"} ${c}`}),b&&(p.rtcp.cname&&this._mediaObject.ssrcs.push({id:b,attribute:"cname",value:p.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:b,attribute:"msid",value:`${l??"-"} ${c}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${_} ${b}`}));break}case"application":{u?(this._mediaObject.payloads=s.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:s.port,maxMessageSize:s.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=s.port,this._mediaObject.maxMessageSize=s.maxMessageSize);break}}}setDtlsRole(n){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:n,streamId:e,trackId:t}){let s=n.encodings[0],i=s.ssrc,a=s.rtx?.ssrc,o=this._mediaObject.payloads.split(" ");for(let d of n.codecs){if(o.includes(String(d.payloadType)))continue;let p={payload:d.payloadType,codec:tn(d),rate:d.clockRate};d.channels>1&&(p.encoding=d.channels),this._mediaObject.rtp.push(p);let l={payload:d.payloadType,config:""};for(let c of Object.keys(d.parameters))l.config&&(l.config+=";"),l.config+=`${c}=${d.parameters[c]}`;l.config&&this._mediaObject.fmtp.push(l);for(let c of d.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:d.payloadType,type:c.type,subtype:c.parameter})}this._mediaObject.payloads+=` ${n.codecs.filter(d=>!this._mediaObject.payloads.includes(d.payloadType)).map(d=>d.payloadType).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),n.rtcp.cname&&this._mediaObject.ssrcs.push({id:i,attribute:"cname",value:n.rtcp.cname}),this._mediaObject.ssrcs.push({id:i,attribute:"msid",value:`${e??"-"} ${t}`}),a&&(n.rtcp.cname&&this._mediaObject.ssrcs.push({id:a,attribute:"cname",value:n.rtcp.cname}),this._mediaObject.ssrcs.push({id:a,attribute:"msid",value:`${e??"-"} ${t}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${i} ${a}`}))}planBStopReceiving({offerRtpParameters:n}){let e=n.encodings[0],t=e.ssrc,s=e.rtx?.ssrc;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(i=>i.id!==t&&i.id!==s),s&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(i=>i.ssrcs!==`${t} ${s}`))}};ht.OfferMediaSection=en;function tn(r){let e=new RegExp("^(audio|video)/(.+)","i").exec(r.mimeType);if(!e)throw new TypeError("invalid codec.mimeType");return e[2]}});var ke=C(Ds=>{"use strict";Object.defineProperty(Ds,"__esModule",{value:!0});Ds.RemoteSdp=void 0;var el=Se(),tl=ee(),Cs=fo(),Ts=new tl.Logger("RemoteSdp"),rn=class{constructor({iceParameters:n,iceCandidates:e,dtlsParameters:t,sctpParameters:s,plainRtpParameters:i,planB:a=!1}){h(this,"_iceParameters");h(this,"_iceCandidates");h(this,"_dtlsParameters");h(this,"_sctpParameters");h(this,"_plainRtpParameters");h(this,"_planB");h(this,"_mediaSections",[]);h(this,"_midToIndex",new Map);h(this,"_firstMid");h(this,"_sdpObject");if(this._iceParameters=n,this._iceCandidates=e,this._dtlsParameters=t,this._sctpParameters=s,this._plainRtpParameters=i,this._planB=a,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},n?.iceLite&&(this._sdpObject.icelite="ice-lite"),t){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};let o=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:t.fingerprints[o-1].algorithm,hash:t.fingerprints[o-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}i&&(this._sdpObject.origin.address=i.ip,this._sdpObject.origin.ipVer=i.ipVersion)}updateIceParameters(n){Ts.debug("updateIceParameters() [iceParameters:%o]",n),this._iceParameters=n,this._sdpObject.icelite=n.iceLite?"ice-lite":void 0;for(let e of this._mediaSections)e.setIceParameters(n)}updateDtlsRole(n){Ts.debug("updateDtlsRole() [role:%s]",n),this._dtlsParameters.role=n;for(let e of this._mediaSections)e.setDtlsRole(n)}setSessionExtmapAllowMixed(){Ts.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let n=0;n<this._mediaSections.length;++n){let e=this._mediaSections[n];if(e.closed)return{idx:n,reuseMid:e.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:n,reuseMid:e,offerRtpParameters:t,answerRtpParameters:s,codecOptions:i}){let a=new Cs.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:n,offerRtpParameters:t,answerRtpParameters:s,codecOptions:i});e?this._replaceMediaSection(a,e):this._midToIndex.has(a.mid)?this._replaceMediaSection(a):this._addMediaSection(a)}receive({mid:n,kind:e,offerRtpParameters:t,streamId:s,trackId:i}){let a=this._midToIndex.get(n),o;if(a!==void 0&&(o=this._mediaSections[a]),this.setSessionExtmapAllowMixed(),o)o.planBReceive({offerRtpParameters:t,streamId:s,trackId:i}),this._replaceMediaSection(o);else{o=new Cs.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:n,kind:e,offerRtpParameters:t,streamId:s,trackId:i});let d=this._mediaSections.find(p=>p.closed);d?this._replaceMediaSection(o,d.mid):this._addMediaSection(o)}}pauseMediaSection(n){this._findMediaSection(n).pause()}resumeSendingMediaSection(n){this._findMediaSection(n).resume()}resumeReceivingMediaSection(n){this._findMediaSection(n).resume()}disableMediaSection(n){this._findMediaSection(n).disable()}closeMediaSection(n){let e=this._findMediaSection(n);return n===this._firstMid?(Ts.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",n),this.disableMediaSection(n),!1):(e.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(n,e){let t=this._findMediaSection(n);t.muxSimulcastStreams(e),this._replaceMediaSection(t)}planBStopReceiving({mid:n,offerRtpParameters:e}){let t=this._findMediaSection(n);t.planBStopReceiving({offerRtpParameters:e}),this._replaceMediaSection(t)}sendSctpAssociation({offerMediaObject:n}){let e=new Cs.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:n});this._addMediaSection(e)}receiveSctpAssociation({oldDataChannelSpec:n=!1}={}){let e=new Cs.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:n});this._addMediaSection(e)}getSdp(){return this._sdpObject.origin.sessionVersion++,el.write(this._sdpObject)}_addMediaSection(n){this._firstMid||(this._firstMid=n.mid),this._mediaSections.push(n),this._midToIndex.set(n.mid,this._mediaSections.length-1),this._sdpObject.media.push(n.getObject()),this._regenerateBundleMids()}_replaceMediaSection(n,e){if(typeof e=="string"){let t=this._midToIndex.get(e);if(t===void 0)throw new Error(`no media section found for reuseMid '${e}'`);let s=this._mediaSections[t];this._mediaSections[t]=n,this._midToIndex.delete(s.mid),this._midToIndex.set(n.mid,t),this._sdpObject.media[t]=n.getObject(),this._regenerateBundleMids()}else{let t=this._midToIndex.get(n.mid);if(t===void 0)throw new Error(`no media section found with mid '${n.mid}'`);this._mediaSections[t]=n,this._sdpObject.media[t]=n.getObject()}}_findMediaSection(n){let e=this._midToIndex.get(n);if(e===void 0)throw new Error(`no media section found with mid '${n}'`);return this._mediaSections[e]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(n=>!n.closed).map(n=>n.mid).join(" "))}};Ds.RemoteSdp=rn});var st=C(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});sn.parse=sl;var rl=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function sl(r){let n=rl.exec(r??"");return n?{spatialLayers:Number(n[1]),temporalLayers:Number(n[2])}:{spatialLayers:1,temporalLayers:1}}});var vo=C(ks=>{"use strict";Object.defineProperty(ks,"__esModule",{value:!0});ks.Chrome111=void 0;var mt=Se(),il=ee(),go=ie(),ar=le(),Ps=Pe(),_o=ut(),nl=Ur(),al=de(),ol=be(),cl=ke(),dl=st(),I=new il.Logger("Chrome111"),pl="Chrome111",wo={OS:1024,MIS:1024},nn=class r extends ol.HandlerInterface{constructor(){super();h(this,"_closed",!1);h(this,"_direction");h(this,"_remoteSdp");h(this,"_sendingRtpParametersByKind");h(this,"_sendingRemoteRtpParametersByKind");h(this,"_forcedLocalDtlsRole");h(this,"_pc");h(this,"_mapMidTransceiver",new Map);h(this,"_sendStream",new MediaStream);h(this,"_hasDataChannelMediaSection",!1);h(this,"_nextSendSctpStreamId",0);h(this,"_transportReady",!1)}static createFactory(){return()=>new r}get name(){return pl}close(){if(I.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){I.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch{}let s=mt.parse(t.sdp),i=Ps.extractRtpCapabilities({sdpObject:s});return nl.addNackSupportForOpus(i),i}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return I.debug("getNativeSctpCapabilities()"),{numStreams:wo}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:c}){this.assertNotClosed(),I.debug("run()"),this._direction=e,this._remoteSdp=new cl.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:ar.getSendingRtpParameters("audio",c),video:ar.getSendingRtpParameters("video",c)},this._sendingRemoteRtpParametersByKind={audio:ar.getSendingRemoteRtpParameters("audio",c),video:ar.getSendingRemoteRtpParameters("video",c)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...p},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",u=>{this.emit("@icecandidateerror",u)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(I.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}))}async updateIceServers(e){this.assertNotClosed(),I.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),I.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});I.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};I.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};I.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();I.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:i,onRtpSender:a}){if(this.assertNotClosed(),this.assertSendDirection(),I.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1){let v=1;for(let f of t){let g=f.scalabilityMode?(0,dl.parse)(f.scalabilityMode).temporalLayers:3;g>v&&(v=g)}t.forEach((f,g)=>{f.rid=`r${g}`,f.scalabilityMode=`L1T${v}`})}let o=go.clone(this._sendingRtpParametersByKind[e.kind]);o.codecs=ar.reduceCodecs(o.codecs,i);let d=go.clone(this._sendingRemoteRtpParametersByKind[e.kind]);d.codecs=ar.reduceCodecs(d.codecs,i);let p=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});a&&a(l.sender);let c=await this._pc.createOffer(),u=mt.parse(c.sdp);u.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u}),I.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);let m=l.mid;o.mid=m,u=mt.parse(this._pc.localDescription.sdp);let _=u.media[p.idx];if(o.rtcp.cname=Ps.getCname({offerMediaObject:_}),!t)o.encodings=_o.getRtpEncodings({offerMediaObject:_});else if(t.length===1){let v=_o.getRtpEncodings({offerMediaObject:_});Object.assign(v[0],t[0]),o.encodings=v}else o.encodings=t;this._remoteSdp.send({offerMediaObject:_,reuseMid:p.reuseMid,offerRtpParameters:o,answerRtpParameters:d,codecOptions:s});let b={type:"answer",sdp:this._remoteSdp.getSdp()};return I.debug("send() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setRemoteDescription(b),this._mapMidTransceiver.set(m,l),{localId:m,rtpParameters:o,rtpSender:l.sender}}async stopSending(e){if(this.assertSendDirection(),I.debug("stopSending() [localId:%s]",e),this._closed)return;let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}let i=await this._pc.createOffer();I.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);let a={type:"answer",sdp:this._remoteSdp.getSdp()};I.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),I.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let s=await this._pc.createOffer();I.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};I.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),I.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";let s=await this._pc.createOffer();I.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};I.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?I.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):I.debug("replaceTrack() [localId:%s, no track]",e);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),I.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((d,p)=>{p<=t?d.active=!0:d.active=!1}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let a=await this._pc.createOffer();I.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);let o={type:"answer",sdp:this._remoteSdp.getSdp()};I.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),I.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((d,p)=>{i.encodings[p]={...d,...t}}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let a=await this._pc.createOffer();I.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);let o={type:"answer",sdp:this._remoteSdp.getSdp()};I.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:a}){this.assertNotClosed(),this.assertSendDirection();let o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:a};I.debug("sendDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%wo.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),c=mt.parse(l.sdp),u=c.media.find(_=>_.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),I.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let m={type:"answer",sdp:this._remoteSdp.getSdp()};I.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._hasDataChannelMediaSection=!0}let p={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:d,sctpStreamParameters:p}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],s=new Map;for(let d of e){let{trackId:p,kind:l,rtpParameters:c,streamId:u}=d;I.debug("receive() [trackId:%s, kind:%s]",p,l);let m=c.mid??String(this._mapMidTransceiver.size);s.set(p,m),this._remoteSdp.receive({mid:m,kind:l,offerRtpParameters:c,streamId:u??c.rtcp.cname,trackId:p})}let i={type:"offer",sdp:this._remoteSdp.getSdp()};I.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);for(let d of e){let{trackId:p,onRtpReceiver:l}=d;if(l){let c=s.get(p),u=this._pc.getTransceivers().find(m=>m.mid===c);if(!u)throw new Error("transceiver not found");l(u.receiver)}}let a=await this._pc.createAnswer(),o=mt.parse(a.sdp);for(let d of e){let{trackId:p,rtpParameters:l}=d,c=s.get(p),u=o.media.find(m=>String(m.mid)===c);Ps.applyCodecParameters({offerRtpParameters:l,answerMediaObject:u})}a={type:"answer",sdp:mt.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),I.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(let d of e){let{trackId:p}=d,l=s.get(p),c=this._pc.getTransceivers().find(u=>u.mid===l);if(c)this._mapMidTransceiver.set(l,c),t.push({localId:l,track:c.receiver.track,rtpReceiver:c.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let i of e){I.debug("stopReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};I.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();I.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(let i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){I.debug("pauseReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};I.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();I.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){I.debug("resumeReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};I.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();I.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d}=e,p={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d,protocol:s};I.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let c={type:"offer",sdp:this._remoteSdp.getSdp()};I.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let u=await this._pc.createAnswer();if(!this._transportReady){let m=mt.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:m})}I.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=mt.parse(this._pc.localDescription.sdp));let s=Ps.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,a)=>{this.safeEmit("@connect",{dtlsParameters:s},i,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new al.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};ks.Chrome111=nn});var yo=C(Es=>{"use strict";Object.defineProperty(Es,"__esModule",{value:!0});Es.Chrome74=void 0;var Ue=Se(),ll=ee(),So=ie(),or=le(),xs=Pe(),an=ut(),ul=Ur(),hl=de(),ml=be(),fl=ke(),gl=st(),E=new ll.Logger("Chrome74"),_l="Chrome74",bo={OS:1024,MIS:1024},on=class r extends ml.HandlerInterface{constructor(){super();h(this,"_closed",!1);h(this,"_direction");h(this,"_remoteSdp");h(this,"_sendingRtpParametersByKind");h(this,"_sendingRemoteRtpParametersByKind");h(this,"_forcedLocalDtlsRole");h(this,"_pc");h(this,"_mapMidTransceiver",new Map);h(this,"_sendStream",new MediaStream);h(this,"_hasDataChannelMediaSection",!1);h(this,"_nextSendSctpStreamId",0);h(this,"_transportReady",!1)}static createFactory(){return()=>new r}get name(){return _l}close(){if(E.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){E.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch{}let s=Ue.parse(t.sdp),i=xs.extractRtpCapabilities({sdpObject:s});return ul.addNackSupportForOpus(i),i}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return E.debug("getNativeSctpCapabilities()"),{numStreams:bo}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:c}){E.debug("run()"),this._direction=e,this._remoteSdp=new fl.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:or.getSendingRtpParameters("audio",c),video:or.getSendingRtpParameters("video",c)},this._sendingRemoteRtpParametersByKind={audio:or.getSendingRemoteRtpParameters("audio",c),video:or.getSendingRemoteRtpParameters("video",c)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...p},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",u=>{this.emit("@icecandidateerror",u)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(E.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}))}async updateIceServers(e){this.assertNotClosed(),E.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),E.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});E.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();E.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:i}){this.assertNotClosed(),this.assertSendDirection(),E.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((f,g)=>{f.rid=`r${g}`});let a=So.clone(this._sendingRtpParametersByKind[e.kind]);a.codecs=or.reduceCodecs(a.codecs,i);let o=So.clone(this._sendingRemoteRtpParametersByKind[e.kind]);o.codecs=or.reduceCodecs(o.codecs,i);let d=this._remoteSdp.getNextMediaSectionIdx(),p=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t}),l=await this._pc.createOffer(),c=Ue.parse(l.sdp);c.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let u;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c});let m=!1,_=(0,gl.parse)((t??[{}])[0].scalabilityMode);t&&t.length===1&&_.spatialLayers>1&&a.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(E.debug("send() | enabling legacy simulcast for VP9 SVC"),m=!0,c=Ue.parse(l.sdp),u=c.media[d.idx],an.addLegacySimulcast({offerMediaObject:u,numStreams:_.spatialLayers}),l={type:"offer",sdp:Ue.write(c)}),E.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);let b=p.mid;if(a.mid=b,c=Ue.parse(this._pc.localDescription.sdp),u=c.media[d.idx],a.rtcp.cname=xs.getCname({offerMediaObject:u}),!t)a.encodings=an.getRtpEncodings({offerMediaObject:u});else if(t.length===1){let f=an.getRtpEncodings({offerMediaObject:u});Object.assign(f[0],t[0]),m&&(f=[f[0]]),a.encodings=f}else a.encodings=t;if(a.encodings.length>1&&(a.codecs[0].mimeType.toLowerCase()==="video/vp8"||a.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let f of a.encodings)f.scalabilityMode?f.scalabilityMode=`L1T${_.temporalLayers}`:f.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:u,reuseMid:d.reuseMid,offerRtpParameters:a,answerRtpParameters:o,codecOptions:s});let v={type:"answer",sdp:this._remoteSdp.getSdp()};return E.debug("send() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v),this._mapMidTransceiver.set(b,p),{localId:b,rtpParameters:a,rtpSender:p.sender}}async stopSending(e){if(this.assertSendDirection(),E.debug("stopSending() [localId:%s]",e),this._closed)return;let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}let i=await this._pc.createOffer();E.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);let a={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),E.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let s=await this._pc.createOffer();E.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),E.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";let s=await this._pc.createOffer();E.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?E.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):E.debug("replaceTrack() [localId:%s, no track]",e);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),E.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((d,p)=>{p<=t?d.active=!0:d.active=!1}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let a=await this._pc.createOffer();E.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);let o={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),E.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((d,p)=>{i.encodings[p]={...d,...t}}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let a=await this._pc.createOffer();E.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);let o={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:a}){this.assertNotClosed(),this.assertSendDirection();let o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:a};E.debug("sendDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%bo.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),c=Ue.parse(l.sdp),u=c.media.find(_=>_.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),E.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let m={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._hasDataChannelMediaSection=!0}let p={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:d,sctpStreamParameters:p}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],s=new Map;for(let d of e){let{trackId:p,kind:l,rtpParameters:c,streamId:u}=d;E.debug("receive() [trackId:%s, kind:%s]",p,l);let m=c.mid??String(this._mapMidTransceiver.size);s.set(p,m),this._remoteSdp.receive({mid:m,kind:l,offerRtpParameters:c,streamId:u??c.rtcp.cname,trackId:p})}let i={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let a=await this._pc.createAnswer(),o=Ue.parse(a.sdp);for(let d of e){let{trackId:p,rtpParameters:l}=d,c=s.get(p),u=o.media.find(m=>String(m.mid)===c);xs.applyCodecParameters({offerRtpParameters:l,answerMediaObject:u})}a={type:"answer",sdp:Ue.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),E.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(let d of e){let{trackId:p}=d,l=s.get(p),c=this._pc.getTransceivers().find(u=>u.mid===l);if(c)this._mapMidTransceiver.set(l,c),t.push({localId:l,track:c.receiver.track,rtpReceiver:c.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let i of e){E.debug("stopReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();E.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(let i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){E.debug("pauseReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();E.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){E.debug("resumeReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();E.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d}=e,p={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d,protocol:s};E.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let c={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let u=await this._pc.createAnswer();if(!this._transportReady){let m=Ue.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:m})}E.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Ue.parse(this._pc.localDescription.sdp));let s=xs.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,a)=>{this.safeEmit("@connect",{dtlsParameters:s},i,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new hl.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};Es.Chrome74=on});var To=C(Is=>{"use strict";Object.defineProperty(Is,"__esModule",{value:!0});Is.Chrome70=void 0;var xe=Se(),wl=ee(),Ro=ie(),cr=le(),Ls=Pe(),cn=ut(),vl=be(),Sl=ke(),bl=st(),F=new wl.Logger("Chrome70"),yl="Chrome70",Co={OS:1024,MIS:1024},dn=class r extends vl.HandlerInterface{constructor(){super();h(this,"_direction");h(this,"_remoteSdp");h(this,"_sendingRtpParametersByKind");h(this,"_sendingRemoteRtpParametersByKind");h(this,"_forcedLocalDtlsRole");h(this,"_pc");h(this,"_mapMidTransceiver",new Map);h(this,"_sendStream",new MediaStream);h(this,"_hasDataChannelMediaSection",!1);h(this,"_nextSendSctpStreamId",0);h(this,"_transportReady",!1)}static createFactory(){return()=>new r}get name(){return yl}close(){if(F.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){F.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch{}let s=xe.parse(t.sdp);return Ls.extractRtpCapabilities({sdpObject:s})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return F.debug("getNativeSctpCapabilities()"),{numStreams:Co}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:c}){F.debug("run()"),this._direction=e,this._remoteSdp=new Sl.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:cr.getSendingRtpParameters("audio",c),video:cr.getSendingRtpParameters("video",c)},this._sendingRemoteRtpParametersByKind={audio:cr.getSendingRemoteRtpParameters("audio",c),video:cr.getSendingRemoteRtpParameters("video",c)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...p},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",u=>{this.emit("@icecandidateerror",u)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(F.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(e){F.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(F.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});F.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};F.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};F.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();F.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:i}){this.assertSendDirection(),F.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);let a=Ro.clone(this._sendingRtpParametersByKind[e.kind]);a.codecs=cr.reduceCodecs(a.codecs,i);let o=Ro.clone(this._sendingRemoteRtpParametersByKind[e.kind]);o.codecs=cr.reduceCodecs(o.codecs,i);let d=this._remoteSdp.getNextMediaSectionIdx(),p=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]}),l=await this._pc.createOffer(),c=xe.parse(l.sdp);c.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let u;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),t&&t.length>1&&(F.debug("send() | enabling legacy simulcast"),c=xe.parse(l.sdp),u=c.media[d.idx],cn.addLegacySimulcast({offerMediaObject:u,numStreams:t.length}),l={type:"offer",sdp:xe.write(c)});let m=!1,_=(0,bl.parse)((t??[{}])[0].scalabilityMode);if(t&&t.length===1&&_.spatialLayers>1&&a.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(F.debug("send() | enabling legacy simulcast for VP9 SVC"),m=!0,c=xe.parse(l.sdp),u=c.media[d.idx],cn.addLegacySimulcast({offerMediaObject:u,numStreams:_.spatialLayers}),l={type:"offer",sdp:xe.write(c)}),F.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),t){F.debug("send() | applying given encodings");let f=p.sender.getParameters();for(let g=0;g<(f.encodings??[]).length;++g){let w=f.encodings[g],y=t[g];if(!y)break;f.encodings[g]=Object.assign(w,y)}await p.sender.setParameters(f)}let b=p.mid;if(a.mid=b,c=xe.parse(this._pc.localDescription.sdp),u=c.media[d.idx],a.rtcp.cname=Ls.getCname({offerMediaObject:u}),a.encodings=cn.getRtpEncodings({offerMediaObject:u}),t)for(let f=0;f<a.encodings.length;++f)t[f]&&Object.assign(a.encodings[f],t[f]);if(m&&(a.encodings=[a.encodings[0]]),a.encodings.length>1&&(a.codecs[0].mimeType.toLowerCase()==="video/vp8"||a.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let f of a.encodings)f.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:u,reuseMid:d.reuseMid,offerRtpParameters:a,answerRtpParameters:o,codecOptions:s});let v={type:"answer",sdp:this._remoteSdp.getSdp()};return F.debug("send() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v),this._mapMidTransceiver.set(b,p),{localId:b,rtpParameters:a,rtpSender:p.sender}}async stopSending(e){this.assertSendDirection(),F.debug("stopSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}let i=await this._pc.createOffer();F.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);let a={type:"answer",sdp:this._remoteSdp.getSdp()};F.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(e)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?F.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):F.debug("replaceTrack() [localId:%s, no track]",e);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),F.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((d,p)=>{p<=t?d.active=!0:d.active=!1}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let a=await this._pc.createOffer();F.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);let o={type:"answer",sdp:this._remoteSdp.getSdp()};F.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),F.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((d,p)=>{i.encodings[p]={...d,...t}}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let a=await this._pc.createOffer();F.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);let o={type:"answer",sdp:this._remoteSdp.getSdp()};F.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:a}){this.assertSendDirection();let o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:s,protocol:a};F.debug("sendDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Co.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),c=xe.parse(l.sdp),u=c.media.find(_=>_.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),F.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let m={type:"answer",sdp:this._remoteSdp.getSdp()};F.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._hasDataChannelMediaSection=!0}let p={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:d,sctpStreamParameters:p}}async receive(e){this.assertRecvDirection();let t=[],s=new Map;for(let d of e){let{trackId:p,kind:l,rtpParameters:c,streamId:u}=d;F.debug("receive() [trackId:%s, kind:%s]",p,l);let m=c.mid??String(this._mapMidTransceiver.size);s.set(p,m),this._remoteSdp.receive({mid:m,kind:l,offerRtpParameters:c,streamId:u??c.rtcp.cname,trackId:p})}let i={type:"offer",sdp:this._remoteSdp.getSdp()};F.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let a=await this._pc.createAnswer(),o=xe.parse(a.sdp);for(let d of e){let{trackId:p,rtpParameters:l}=d,c=s.get(p),u=o.media.find(m=>String(m.mid)===c);Ls.applyCodecParameters({offerRtpParameters:l,answerMediaObject:u})}a={type:"answer",sdp:xe.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),F.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(let d of e){let{trackId:p}=d,l=s.get(p),c=this._pc.getTransceivers().find(u=>u.mid===l);if(!c)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(l,c),t.push({localId:l,track:c.receiver.track,rtpReceiver:c.receiver})}return t}async stopReceiving(e){this.assertRecvDirection();for(let i of e){F.debug("stopReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};F.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();F.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(let i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertRecvDirection();let{streamId:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d}=e,p={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:d,protocol:s};F.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let c={type:"offer",sdp:this._remoteSdp.getSdp()};F.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let u=await this._pc.createAnswer();if(!this._transportReady){let m=xe.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:m})}F.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=xe.parse(this._pc.localDescription.sdp));let s=Ls.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,a)=>{this.safeEmit("@connect",{dtlsParameters:s},i,a)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};Is.Chrome70=dn});var $r=C(Ms=>{"use strict";Object.defineProperty(Ms,"__esModule",{value:!0});Ms.getRtpEncodings=Rl;Ms.addLegacySimulcast=Cl;function Rl({offerMediaObject:r,track:n}){let e,t=new Set;for(let a of r.ssrcs??[]){if(a.attribute!=="msid")continue;if(a.value.split(" ")[1]===n.id){let d=a.id;t.add(d),e||(e=d)}}if(t.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${n.id}]`);let s=new Map;for(let a of r.ssrcGroups??[]){if(a.semantics!=="FID")continue;let[o,d]=a.ssrcs.split(/\s+/);o=Number(o),d=Number(d),t.has(o)&&(t.delete(o),t.delete(d),s.set(o,d))}for(let a of t)s.set(a,null);let i=[];for(let[a,o]of s){let d={ssrc:a};o&&(d.rtx={ssrc:o}),i.push(d)}return i}function Cl({offerMediaObject:r,track:n,numStreams:e}){if(e<=1)throw new TypeError("numStreams must be greater than 1");let t,s,i;if(!(r.ssrcs??[]).find(c=>c.attribute!=="msid"?!1:c.value.split(" ")[1]===n.id?(t=c.id,i=c.value.split(" ")[0],!0):!1))throw new Error(`a=ssrc line with msid information not found [track.id:${n.id}]`);(r.ssrcGroups??[]).some(c=>{if(c.semantics!=="FID")return!1;let u=c.ssrcs.split(/\s+/);return Number(u[0])===t?(s=Number(u[1]),!0):!1});let o=r.ssrcs.find(c=>c.attribute==="cname"&&c.id===t);if(!o)throw new Error(`a=ssrc line with cname information not found [track.id:${n.id}]`);let d=o.value,p=[],l=[];for(let c=0;c<e;++c)p.push(t+c),s&&l.push(s+c);r.ssrcGroups=r.ssrcGroups??[],r.ssrcs=r.ssrcs??[],r.ssrcGroups.push({semantics:"SIM",ssrcs:p.join(" ")});for(let c of p)r.ssrcs.push({id:c,attribute:"cname",value:d}),r.ssrcs.push({id:c,attribute:"msid",value:`${i} ${n.id}`});for(let c=0;c<l.length;++c){let u=p[c],m=l[c];r.ssrcs.push({id:m,attribute:"cname",value:d}),r.ssrcs.push({id:m,attribute:"msid",value:`${i} ${n.id}`}),r.ssrcGroups.push({semantics:"FID",ssrcs:`${u} ${m}`})}}});var xo=C(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0});js.Chrome67=void 0;var Be=Se(),Tl=ee(),Do=ie(),dr=le(),Os=Pe(),Po=$r(),Dl=be(),Pl=ke(),U=new Tl.Logger("Chrome67"),kl="Chrome67",ko={OS:1024,MIS:1024},pn=class r extends Dl.HandlerInterface{constructor(){super();h(this,"_direction");h(this,"_remoteSdp");h(this,"_sendingRtpParametersByKind");h(this,"_sendingRemoteRtpParametersByKind");h(this,"_forcedLocalDtlsRole");h(this,"_pc");h(this,"_sendStream",new MediaStream);h(this,"_mapSendLocalIdRtpSender",new Map);h(this,"_nextSendLocalId",0);h(this,"_mapRecvLocalIdInfo",new Map);h(this,"_hasDataChannelMediaSection",!1);h(this,"_nextSendSctpStreamId",0);h(this,"_transportReady",!1)}static createFactory(){return()=>new r}get name(){return kl}close(){if(U.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){U.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{let t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch{}let s=Be.parse(t.sdp);return Os.extractRtpCapabilities({sdpObject:s})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return U.debug("getNativeSctpCapabilities()"),{numStreams:ko}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:c}){U.debug("run()"),this._direction=e,this._remoteSdp=new Pl.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:dr.getSendingRtpParameters("audio",c),video:dr.getSendingRtpParameters("video",c)},this._sendingRemoteRtpParametersByKind={audio:dr.getSendingRemoteRtpParameters("audio",c),video:dr.getSendingRemoteRtpParameters("video",c)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...p},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",u=>{this.emit("@icecandidateerror",u)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(U.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(e){U.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(U.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});U.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};U.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};U.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();U.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:i}){this.assertSendDirection(),U.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&U.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let a=await this._pc.createOffer(),o=Be.parse(a.sdp);o.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let d,p=Do.clone(this._sendingRtpParametersByKind[e.kind]);p.codecs=dr.reduceCodecs(p.codecs);let l=Do.clone(this._sendingRemoteRtpParametersByKind[e.kind]);if(l.codecs=dr.reduceCodecs(l.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),e.kind==="video"&&t&&t.length>1&&(U.debug("send() | enabling simulcast"),o=Be.parse(a.sdp),d=o.media.find(_=>_.type==="video"),Po.addLegacySimulcast({offerMediaObject:d,track:e,numStreams:t.length}),a={type:"offer",sdp:Be.write(o)}),U.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),o=Be.parse(this._pc.localDescription.sdp),d=o.media.find(_=>_.type===e.kind),p.rtcp.cname=Os.getCname({offerMediaObject:d}),p.encodings=Po.getRtpEncodings({offerMediaObject:d,track:e}),t)for(let _=0;_<p.encodings.length;++_)t[_]&&Object.assign(p.encodings[_],t[_]);if(p.encodings.length>1&&p.codecs[0].mimeType.toLowerCase()==="video/vp8")for(let _ of p.encodings)_.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,offerRtpParameters:p,answerRtpParameters:l,codecOptions:s});let c={type:"answer",sdp:this._remoteSdp.getSdp()};U.debug("send() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c);let u=String(this._nextSendLocalId);this._nextSendLocalId++;let m=this._pc.getSenders().find(_=>_.track===e);return this._mapSendLocalIdRtpSender.set(u,m),{localId:u,rtpParameters:p,rtpSender:m}}async stopSending(e){this.assertSendDirection(),U.debug("stopSending() [localId:%s]",e);let t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t),t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);let s=await this._pc.createOffer();U.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s);try{await this._pc.setLocalDescription(s)}catch(a){if(this._sendStream.getTracks().length===0){U.warn("stopSending() | ignoring expected error due no sending tracks: %s",a.toString());return}throw a}if(this._pc.signalingState==="stable")return;let i={type:"answer",sdp:this._remoteSdp.getSdp()};U.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?U.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):U.debug("replaceTrack() [localId:%s, no track]",e);let s=this._mapSendLocalIdRtpSender.get(e);if(!s)throw new Error("associated RTCRtpSender not found");let i=s.track;await s.replaceTrack(t),i&&this._sendStream.removeTrack(i),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),U.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._mapSendLocalIdRtpSender.get(e);if(!s)throw new Error("associated RTCRtpSender not found");let i=s.getParameters();i.encodings.forEach((a,o)=>{o<=t?a.active=!0:a.active=!1}),await s.setParameters(i)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),U.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._mapSendLocalIdRtpSender.get(e);if(!s)throw new Error("associated RTCRtpSender not found");let i=s.getParameters();i.encodings.forEach((a,o)=>{i.encodings[o]={...a,...t}}),await s.setParameters(i)}async getSenderStats(e){this.assertSendDirection();let t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:a}){this.assertSendDirection();let o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:s,protocol:a};U.debug("sendDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%ko.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),c=Be.parse(l.sdp),u=c.media.find(_=>_.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),U.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let m={type:"answer",sdp:this._remoteSdp.getSdp()};U.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._hasDataChannelMediaSection=!0}let p={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:d,sctpStreamParameters:p}}async receive(e){this.assertRecvDirection();let t=[];for(let o of e){let{trackId:d,kind:p,rtpParameters:l,streamId:c}=o;U.debug("receive() [trackId:%s, kind:%s]",d,p);let u=p;this._remoteSdp.receive({mid:u,kind:p,offerRtpParameters:l,streamId:c??l.rtcp.cname,trackId:d})}let s={type:"offer",sdp:this._remoteSdp.getSdp()};U.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let i=await this._pc.createAnswer(),a=Be.parse(i.sdp);for(let o of e){let{kind:d,rtpParameters:p}=o,l=d,c=a.media.find(u=>String(u.mid)===l);Os.applyCodecParameters({offerRtpParameters:p,answerMediaObject:c})}i={type:"answer",sdp:Be.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),U.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(let o of e){let{kind:d,trackId:p,rtpParameters:l}=o,c=p,u=d,m=this._pc.getReceivers().find(_=>_.track&&_.track.id===c);if(!m)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(c,{mid:u,rtpParameters:l,rtpReceiver:m}),t.push({localId:c,track:m.track,rtpReceiver:m})}return t}async stopReceiving(e){this.assertRecvDirection();for(let i of e){U.debug("stopReceiving() [localId:%s]",i);let{mid:a,rtpParameters:o}=this._mapRecvLocalIdInfo.get(i)??{};this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:a,offerRtpParameters:o})}let t={type:"offer",sdp:this._remoteSdp.getSdp()};U.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();U.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();let{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)??{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertRecvDirection();let{streamId:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d}=e,p={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:d,protocol:s};U.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});let c={type:"offer",sdp:this._remoteSdp.getSdp()};U.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let u=await this._pc.createAnswer();if(!this._transportReady){let m=Be.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:m})}U.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Be.parse(this._pc.localDescription.sdp));let s=Os.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,a)=>{this.safeEmit("@connect",{dtlsParameters:s},i,a)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};js.Chrome67=pn});var Mo=C(Ns=>{"use strict";Object.defineProperty(Ns,"__esModule",{value:!0});Ns.Chrome55=void 0;var $e=Se(),xl=ee(),zr=de(),Eo=ie(),pr=le(),As=Pe(),Lo=$r(),El=be(),Ll=ke(),H=new xl.Logger("Chrome55"),Il="Chrome55",Io={OS:1024,MIS:1024},ln=class r extends El.HandlerInterface{constructor(){super();h(this,"_direction");h(this,"_remoteSdp");h(this,"_sendingRtpParametersByKind");h(this,"_sendingRemoteRtpParametersByKind");h(this,"_forcedLocalDtlsRole");h(this,"_pc");h(this,"_sendStream",new MediaStream);h(this,"_mapSendLocalIdTrack",new Map);h(this,"_nextSendLocalId",0);h(this,"_mapRecvLocalIdInfo",new Map);h(this,"_hasDataChannelMediaSection",!1);h(this,"_nextSendSctpStreamId",0);h(this,"_transportReady",!1)}static createFactory(){return()=>new r}get name(){return Il}close(){if(H.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){H.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{let t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch{}let s=$e.parse(t.sdp);return As.extractRtpCapabilities({sdpObject:s})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return H.debug("getNativeSctpCapabilities()"),{numStreams:Io}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:c}){H.debug("run()"),this._direction=e,this._remoteSdp=new Ll.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:pr.getSendingRtpParameters("audio",c),video:pr.getSendingRtpParameters("video",c)},this._sendingRemoteRtpParametersByKind={audio:pr.getSendingRemoteRtpParameters("audio",c),video:pr.getSendingRemoteRtpParameters("video",c)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...p},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",u=>{this.emit("@icecandidateerror",u)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(H.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(e){H.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(H.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});H.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};H.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};H.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();H.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:i}){this.assertSendDirection(),H.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&H.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let a=await this._pc.createOffer(),o=$e.parse(a.sdp);o.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let d,p=Eo.clone(this._sendingRtpParametersByKind[e.kind]);p.codecs=pr.reduceCodecs(p.codecs);let l=Eo.clone(this._sendingRemoteRtpParametersByKind[e.kind]);if(l.codecs=pr.reduceCodecs(l.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),e.kind==="video"&&t&&t.length>1&&(H.debug("send() | enabling simulcast"),o=$e.parse(a.sdp),d=o.media.find(m=>m.type==="video"),Lo.addLegacySimulcast({offerMediaObject:d,track:e,numStreams:t.length}),a={type:"offer",sdp:$e.write(o)}),H.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),o=$e.parse(this._pc.localDescription.sdp),d=o.media.find(m=>m.type===e.kind),p.rtcp.cname=As.getCname({offerMediaObject:d}),p.encodings=Lo.getRtpEncodings({offerMediaObject:d,track:e}),t)for(let m=0;m<p.encodings.length;++m)t[m]&&Object.assign(p.encodings[m],t[m]);if(p.encodings.length>1&&p.codecs[0].mimeType.toLowerCase()==="video/vp8")for(let m of p.encodings)m.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,offerRtpParameters:p,answerRtpParameters:l,codecOptions:s});let c={type:"answer",sdp:this._remoteSdp.getSdp()};H.debug("send() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c);let u=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(u,e),{localId:u,rtpParameters:p}}async stopSending(e){this.assertSendDirection(),H.debug("stopSending() [localId:%s]",e);let t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);let s=await this._pc.createOffer();H.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s);try{await this._pc.setLocalDescription(s)}catch(a){if(this._sendStream.getTracks().length===0){H.warn("stopSending() | ignoring expected error due no sending tracks: %s",a.toString());return}throw a}if(this._pc.signalingState==="stable")return;let i={type:"answer",sdp:this._remoteSdp.getSdp()};H.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new zr.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new zr.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new zr.UnsupportedError("not supported")}async getSenderStats(e){throw new zr.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:a}){this.assertSendDirection();let o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:s,protocol:a};H.debug("sendDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Io.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),c=$e.parse(l.sdp),u=c.media.find(_=>_.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),H.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let m={type:"answer",sdp:this._remoteSdp.getSdp()};H.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._hasDataChannelMediaSection=!0}let p={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:d,sctpStreamParameters:p}}async receive(e){this.assertRecvDirection();let t=[];for(let o of e){let{trackId:d,kind:p,rtpParameters:l,streamId:c}=o;H.debug("receive() [trackId:%s, kind:%s]",d,p);let u=p;this._remoteSdp.receive({mid:u,kind:p,offerRtpParameters:l,streamId:c??l.rtcp.cname,trackId:d})}let s={type:"offer",sdp:this._remoteSdp.getSdp()};H.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let i=await this._pc.createAnswer(),a=$e.parse(i.sdp);for(let o of e){let{kind:d,rtpParameters:p}=o,l=d,c=a.media.find(u=>String(u.mid)===l);As.applyCodecParameters({offerRtpParameters:p,answerMediaObject:c})}i={type:"answer",sdp:$e.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),H.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(let o of e){let{kind:d,trackId:p,rtpParameters:l}=o,c=d,u=p,m=o.streamId??l.rtcp.cname,b=this._pc.getRemoteStreams().find(v=>v.id===m).getTrackById(u);if(!b)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(u,{mid:c,rtpParameters:l}),t.push({localId:u,track:b})}return t}async stopReceiving(e){this.assertRecvDirection();for(let i of e){H.debug("stopReceiving() [localId:%s]",i);let{mid:a,rtpParameters:o}=this._mapRecvLocalIdInfo.get(i)??{};this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:a,offerRtpParameters:o})}let t={type:"offer",sdp:this._remoteSdp.getSdp()};H.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();H.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new zr.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertRecvDirection();let{streamId:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d}=e,p={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:d,protocol:s};H.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});let c={type:"offer",sdp:this._remoteSdp.getSdp()};H.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let u=await this._pc.createAnswer();if(!this._transportReady){let m=$e.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:m})}H.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=$e.parse(this._pc.localDescription.sdp));let s=As.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,a)=>{this.safeEmit("@connect",{dtlsParameters:s},i,a)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};Ns.Chrome55=ln});var Fo=C(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});qs.Firefox120=void 0;var ft=Se(),Ml=ee(),Oo=de(),jo=ie(),lr=le(),Fs=Pe(),Ao=ut(),Ol=be(),jl=ke(),Al=st(),O=new Ml.Logger("Firefox120"),Nl="Firefox120",No={OS:16,MIS:2048},un=class r extends Ol.HandlerInterface{constructor(){super();h(this,"_closed",!1);h(this,"_direction");h(this,"_remoteSdp");h(this,"_sendingRtpParametersByKind");h(this,"_sendingRemoteRtpParametersByKind");h(this,"_pc");h(this,"_mapMidTransceiver",new Map);h(this,"_sendStream",new MediaStream);h(this,"_hasDataChannelMediaSection",!1);h(this,"_nextSendSctpStreamId",0);h(this,"_transportReady",!1)}static createFactory(){return()=>new r}get name(){return Nl}close(){if(O.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){O.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");let i=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"}),e.addTransceiver(i,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});let a=await e.createOffer();try{t.remove()}catch{}try{i.stop()}catch{}try{e.close()}catch{}let o=ft.parse(a.sdp);return Fs.extractRtpCapabilities({sdpObject:o})}catch(a){try{t.remove()}catch{}try{i.stop()}catch{}try{e.close()}catch{}throw a}}async getNativeSctpCapabilities(){return O.debug("getNativeSctpCapabilities()"),{numStreams:No}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:c}){this.assertNotClosed(),O.debug("run()"),this._direction=e,this._remoteSdp=new jl.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:lr.getSendingRtpParameters("audio",c),video:lr.getSendingRtpParameters("video",c)},this._sendingRemoteRtpParametersByKind={audio:lr.getSendingRemoteRtpParameters("audio",c),video:lr.getSendingRemoteRtpParameters("video",c)},this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...p},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",u=>{this.emit("@icecandidateerror",u)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(O.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(e){throw this.assertNotClosed(),new Oo.UnsupportedError("not supported")}async restartIce(e){if(this.assertNotClosed(),O.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});O.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};O.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};O.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();O.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:i,onRtpSender:a}){this.assertNotClosed(),this.assertSendDirection(),O.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((v,f)=>{v.rid=`r${f}`});let o=jo.clone(this._sendingRtpParametersByKind[e.kind]);o.codecs=lr.reduceCodecs(o.codecs,i);let d=jo.clone(this._sendingRemoteRtpParametersByKind[e.kind]);d.codecs=lr.reduceCodecs(d.codecs,i);let p=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});a&&a(p.sender);let l=await this._pc.createOffer(),c=ft.parse(l.sdp);c.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:c});let u=(0,Al.parse)((t??[{}])[0].scalabilityMode);O.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);let m=p.mid;o.mid=m,c=ft.parse(this._pc.localDescription.sdp);let _=c.media[c.media.length-1];if(o.rtcp.cname=Fs.getCname({offerMediaObject:_}),!t)o.encodings=Ao.getRtpEncodings({offerMediaObject:_});else if(t.length===1){let v=Ao.getRtpEncodings({offerMediaObject:_});Object.assign(v[0],t[0]),o.encodings=v}else o.encodings=t;if(o.encodings.length>1&&(o.codecs[0].mimeType.toLowerCase()==="video/vp8"||o.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let v of o.encodings)v.scalabilityMode?v.scalabilityMode=`L1T${u.temporalLayers}`:v.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:_,offerRtpParameters:o,answerRtpParameters:d,codecOptions:s});let b={type:"answer",sdp:this._remoteSdp.getSdp()};return O.debug("send() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setRemoteDescription(b),this._mapMidTransceiver.set(m,p),{localId:m,rtpParameters:o,rtpSender:p.sender}}async stopSending(e){if(this.assertSendDirection(),O.debug("stopSending() [localId:%s]",e),this._closed)return;let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);let s=await this._pc.createOffer();O.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};O.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),O.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let s=await this._pc.createOffer();O.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};O.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),O.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);let s=await this._pc.createOffer();O.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};O.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?O.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):O.debug("replaceTrack() [localId:%s, no track]",e);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),O.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated transceiver not found");let i=s.sender.getParameters();i.encodings.forEach((d,p)=>{p<=t?d.active=!0:d.active=!1}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let a=await this._pc.createOffer();O.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);let o={type:"answer",sdp:this._remoteSdp.getSdp()};O.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),O.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((d,p)=>{i.encodings[p]={...d,...t}}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let a=await this._pc.createOffer();O.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);let o={type:"answer",sdp:this._remoteSdp.getSdp()};O.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:a}){this.assertNotClosed(),this.assertSendDirection();let o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:a};O.debug("sendDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%No.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),c=ft.parse(l.sdp),u=c.media.find(_=>_.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:c}),O.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let m={type:"answer",sdp:this._remoteSdp.getSdp()};O.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._hasDataChannelMediaSection=!0}let p={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:d,sctpStreamParameters:p}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],s=new Map;for(let d of e){let{trackId:p,kind:l,rtpParameters:c,streamId:u}=d;O.debug("receive() [trackId:%s, kind:%s]",p,l);let m=c.mid??String(this._mapMidTransceiver.size);s.set(p,m),this._remoteSdp.receive({mid:m,kind:l,offerRtpParameters:c,streamId:u??c.rtcp.cname,trackId:p})}let i={type:"offer",sdp:this._remoteSdp.getSdp()};O.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);for(let d of e){let{trackId:p,onRtpReceiver:l}=d;if(l){let c=s.get(p),u=this._pc.getTransceivers().find(m=>m.mid===c);if(!u)throw new Error("transceiver not found");l(u.receiver)}}let a=await this._pc.createAnswer(),o=ft.parse(a.sdp);for(let d of e){let{trackId:p,rtpParameters:l}=d,c=s.get(p),u=o.media.find(m=>String(m.mid)===c);Fs.applyCodecParameters({offerRtpParameters:l,answerMediaObject:u}),a={type:"answer",sdp:ft.write(o)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:o}),O.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(let d of e){let{trackId:p}=d,l=s.get(p),c=this._pc.getTransceivers().find(u=>u.mid===l);if(!c)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(l,c),t.push({localId:l,track:c.receiver.track,rtpReceiver:c.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let i of e){O.debug("stopReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};O.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();O.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(let i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){O.debug("pauseReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};O.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();O.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){O.debug("resumeReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};O.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();O.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d}=e,p={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d,protocol:s};O.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let c={type:"offer",sdp:this._remoteSdp.getSdp()};O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let u=await this._pc.createAnswer();if(!this._transportReady){let m=ft.parse(u.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:m})}O.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=ft.parse(this._pc.localDescription.sdp));let s=Fs.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,a)=>{this.safeEmit("@connect",{dtlsParameters:s},i,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Oo.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};qs.Firefox120=un});var $o=C(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0});Bs.Firefox60=void 0;var gt=Se(),Fl=ee(),qo=de(),hn=ie(),ur=le(),Us=Pe(),Uo=ut(),ql=be(),Ul=ke(),Bl=st(),j=new Fl.Logger("Firefox60"),$l="Firefox60",Bo={OS:16,MIS:2048},mn=class r extends ql.HandlerInterface{constructor(){super();h(this,"_closed",!1);h(this,"_direction");h(this,"_remoteSdp");h(this,"_sendingRtpParametersByKind");h(this,"_sendingRemoteRtpParametersByKind");h(this,"_pc");h(this,"_mapMidTransceiver",new Map);h(this,"_sendStream",new MediaStream);h(this,"_hasDataChannelMediaSection",!1);h(this,"_nextSendSctpStreamId",0);h(this,"_transportReady",!1)}static createFactory(){return()=>new r}get name(){return $l}close(){if(j.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){j.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");let i=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});let a=e.addTransceiver(i,{direction:"sendrecv"}),o=a.sender.getParameters(),d=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];o.encodings=d,await a.sender.setParameters(o);let p=await e.createOffer();try{t.remove()}catch{}try{i.stop()}catch{}try{e.close()}catch{}let l=gt.parse(p.sdp);return Us.extractRtpCapabilities({sdpObject:l})}catch(a){try{t.remove()}catch{}try{i.stop()}catch{}try{e.close()}catch{}throw a}}async getNativeSctpCapabilities(){return j.debug("getNativeSctpCapabilities()"),{numStreams:Bo}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:c}){this.assertNotClosed(),j.debug("run()"),this._direction=e,this._remoteSdp=new Ul.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:ur.getSendingRtpParameters("audio",c),video:ur.getSendingRtpParameters("video",c)},this._sendingRemoteRtpParametersByKind={audio:ur.getSendingRemoteRtpParameters("audio",c),video:ur.getSendingRemoteRtpParameters("video",c)},this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...p},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",u=>{this.emit("@icecandidateerror",u)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(j.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(e){throw this.assertNotClosed(),new qo.UnsupportedError("not supported")}async restartIce(e){if(this.assertNotClosed(),j.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});j.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};j.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};j.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();j.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:i}){this.assertNotClosed(),this.assertSendDirection(),j.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&(t=hn.clone(t),t.forEach((b,v)=>{b.rid=`r${v}`}),t.reverse());let a=hn.clone(this._sendingRtpParametersByKind[e.kind]);a.codecs=ur.reduceCodecs(a.codecs,i);let o=hn.clone(this._sendingRemoteRtpParametersByKind[e.kind]);o.codecs=ur.reduceCodecs(o.codecs,i);let d=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(t){let b=d.sender.getParameters();b.encodings=t,await d.sender.setParameters(b)}let p=await this._pc.createOffer(),l=gt.parse(p.sdp);l.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:l});let c=(0,Bl.parse)((t??[{}])[0].scalabilityMode);j.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);let u=d.mid;a.mid=u,l=gt.parse(this._pc.localDescription.sdp);let m=l.media[l.media.length-1];if(a.rtcp.cname=Us.getCname({offerMediaObject:m}),!t)a.encodings=Uo.getRtpEncodings({offerMediaObject:m});else if(t.length===1){let b=Uo.getRtpEncodings({offerMediaObject:m});Object.assign(b[0],t[0]),a.encodings=b}else a.encodings=t.reverse();if(a.encodings.length>1&&(a.codecs[0].mimeType.toLowerCase()==="video/vp8"||a.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let b of a.encodings)b.scalabilityMode?b.scalabilityMode=`L1T${c.temporalLayers}`:b.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:m,offerRtpParameters:a,answerRtpParameters:o,codecOptions:s});let _={type:"answer",sdp:this._remoteSdp.getSdp()};return j.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_),this._mapMidTransceiver.set(u,d),{localId:u,rtpParameters:a,rtpSender:d.sender}}async stopSending(e){if(this.assertSendDirection(),j.debug("stopSending() [localId:%s]",e),this._closed)return;let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);let s=await this._pc.createOffer();j.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};j.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),j.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let s=await this._pc.createOffer();j.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};j.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),j.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);let s=await this._pc.createOffer();j.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};j.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?j.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):j.debug("replaceTrack() [localId:%s, no track]",e);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),j.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated transceiver not found");let i=s.sender.getParameters();t=i.encodings.length-1-t,i.encodings.forEach((d,p)=>{p>=t?d.active=!0:d.active=!1}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let a=await this._pc.createOffer();j.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);let o={type:"answer",sdp:this._remoteSdp.getSdp()};j.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),j.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((d,p)=>{i.encodings[p]={...d,...t}}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let a=await this._pc.createOffer();j.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);let o={type:"answer",sdp:this._remoteSdp.getSdp()};j.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:a}){this.assertNotClosed(),this.assertSendDirection();let o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:a};j.debug("sendDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Bo.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),c=gt.parse(l.sdp),u=c.media.find(_=>_.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:c}),j.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let m={type:"answer",sdp:this._remoteSdp.getSdp()};j.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._hasDataChannelMediaSection=!0}let p={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:d,sctpStreamParameters:p}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],s=new Map;for(let d of e){let{trackId:p,kind:l,rtpParameters:c,streamId:u}=d;j.debug("receive() [trackId:%s, kind:%s]",p,l);let m=c.mid??String(this._mapMidTransceiver.size);s.set(p,m),this._remoteSdp.receive({mid:m,kind:l,offerRtpParameters:c,streamId:u??c.rtcp.cname,trackId:p})}let i={type:"offer",sdp:this._remoteSdp.getSdp()};j.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let a=await this._pc.createAnswer(),o=gt.parse(a.sdp);for(let d of e){let{trackId:p,rtpParameters:l}=d,c=s.get(p),u=o.media.find(m=>String(m.mid)===c);Us.applyCodecParameters({offerRtpParameters:l,answerMediaObject:u}),a={type:"answer",sdp:gt.write(o)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:o}),j.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(let d of e){let{trackId:p}=d,l=s.get(p),c=this._pc.getTransceivers().find(u=>u.mid===l);if(!c)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(l,c),t.push({localId:l,track:c.receiver.track,rtpReceiver:c.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let i of e){j.debug("stopReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};j.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();j.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(let i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){j.debug("pauseReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};j.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();j.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){j.debug("resumeReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};j.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();j.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d}=e,p={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d,protocol:s};j.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let c={type:"offer",sdp:this._remoteSdp.getSdp()};j.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let u=await this._pc.createAnswer();if(!this._transportReady){let m=gt.parse(u.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:m})}j.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=gt.parse(this._pc.localDescription.sdp));let s=Us.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,a)=>{this.safeEmit("@connect",{dtlsParameters:s},i,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new qo.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};Bs.Firefox60=mn});var Vo=C(zs=>{"use strict";Object.defineProperty(zs,"__esModule",{value:!0});zs.Safari12=void 0;var ze=Se(),zl=ee(),zo=ie(),hr=le(),$s=Pe(),Ho=ut(),Hl=Ur(),Kl=de(),Vl=be(),Gl=ke(),Ql=st(),L=new zl.Logger("Safari12"),Wl="Safari12",Ko={OS:1024,MIS:1024},fn=class r extends Vl.HandlerInterface{constructor(){super();h(this,"_closed",!1);h(this,"_direction");h(this,"_remoteSdp");h(this,"_sendingRtpParametersByKind");h(this,"_sendingRemoteRtpParametersByKind");h(this,"_forcedLocalDtlsRole");h(this,"_pc");h(this,"_mapMidTransceiver",new Map);h(this,"_sendStream",new MediaStream);h(this,"_hasDataChannelMediaSection",!1);h(this,"_nextSendSctpStreamId",0);h(this,"_transportReady",!1)}static createFactory(){return()=>new r}get name(){return Wl}close(){if(L.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){L.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch{}let s=ze.parse(t.sdp),i=$s.extractRtpCapabilities({sdpObject:s});return Hl.addNackSupportForOpus(i),i}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return L.debug("getNativeSctpCapabilities()"),{numStreams:Ko}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:c}){this.assertNotClosed(),L.debug("run()"),this._direction=e,this._remoteSdp=new Gl.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:hr.getSendingRtpParameters("audio",c),video:hr.getSendingRtpParameters("video",c)},this._sendingRemoteRtpParametersByKind={audio:hr.getSendingRemoteRtpParameters("audio",c),video:hr.getSendingRemoteRtpParameters("video",c)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...p},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",u=>{this.emit("@icecandidateerror",u)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(L.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(e){this.assertNotClosed(),L.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),L.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});L.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};L.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};L.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();L.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:i,onRtpSender:a}){this.assertNotClosed(),this.assertSendDirection(),L.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);let o=zo.clone(this._sendingRtpParametersByKind[e.kind]);o.codecs=hr.reduceCodecs(o.codecs,i);let d=zo.clone(this._sendingRemoteRtpParametersByKind[e.kind]);d.codecs=hr.reduceCodecs(d.codecs,i);let p=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});a&&a(l.sender);let c=await this._pc.createOffer(),u=ze.parse(c.sdp);u.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let m;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u});let _=(0,Ql.parse)((t??[{}])[0].scalabilityMode);t&&t.length>1&&(L.debug("send() | enabling legacy simulcast"),u=ze.parse(c.sdp),m=u.media[p.idx],Ho.addLegacySimulcast({offerMediaObject:m,numStreams:t.length}),c={type:"offer",sdp:ze.write(u)}),L.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);let b=l.mid;if(o.mid=b,u=ze.parse(this._pc.localDescription.sdp),m=u.media[p.idx],o.rtcp.cname=$s.getCname({offerMediaObject:m}),o.encodings=Ho.getRtpEncodings({offerMediaObject:m}),t)for(let f=0;f<o.encodings.length;++f)t[f]&&Object.assign(o.encodings[f],t[f]);if(o.encodings.length>1&&(o.codecs[0].mimeType.toLowerCase()==="video/vp8"||o.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let f of o.encodings)f.scalabilityMode?f.scalabilityMode=`L1T${_.temporalLayers}`:f.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:m,reuseMid:p.reuseMid,offerRtpParameters:o,answerRtpParameters:d,codecOptions:s});let v={type:"answer",sdp:this._remoteSdp.getSdp()};return L.debug("send() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v),this._mapMidTransceiver.set(b,l),{localId:b,rtpParameters:o,rtpSender:l.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;L.debug("stopSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}let i=await this._pc.createOffer();L.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);let a={type:"answer",sdp:this._remoteSdp.getSdp()};L.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),L.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let s=await this._pc.createOffer();L.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};L.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),L.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);let s=await this._pc.createOffer();L.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};L.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?L.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):L.debug("replaceTrack() [localId:%s, no track]",e);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),L.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((d,p)=>{p<=t?d.active=!0:d.active=!1}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let a=await this._pc.createOffer();L.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);let o={type:"answer",sdp:this._remoteSdp.getSdp()};L.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),L.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((d,p)=>{i.encodings[p]={...d,...t}}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let a=await this._pc.createOffer();L.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);let o={type:"answer",sdp:this._remoteSdp.getSdp()};L.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:a}){this.assertNotClosed(),this.assertSendDirection();let o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:a};L.debug("sendDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Ko.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),c=ze.parse(l.sdp),u=c.media.find(_=>_.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),L.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let m={type:"answer",sdp:this._remoteSdp.getSdp()};L.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._hasDataChannelMediaSection=!0}let p={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:d,sctpStreamParameters:p}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],s=new Map;for(let d of e){let{trackId:p,kind:l,rtpParameters:c,streamId:u}=d;L.debug("receive() [trackId:%s, kind:%s]",p,l);let m=c.mid??String(this._mapMidTransceiver.size);s.set(p,m),this._remoteSdp.receive({mid:m,kind:l,offerRtpParameters:c,streamId:u??c.rtcp.cname,trackId:p})}let i={type:"offer",sdp:this._remoteSdp.getSdp()};L.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);for(let d of e){let{trackId:p,onRtpReceiver:l}=d;if(l){let c=s.get(p),u=this._pc.getTransceivers().find(m=>m.mid===c);if(!u)throw new Error("transceiver not found");l(u.receiver)}}let a=await this._pc.createAnswer(),o=ze.parse(a.sdp);for(let d of e){let{trackId:p,rtpParameters:l}=d,c=s.get(p),u=o.media.find(m=>String(m.mid)===c);$s.applyCodecParameters({offerRtpParameters:l,answerMediaObject:u})}a={type:"answer",sdp:ze.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),L.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(let d of e){let{trackId:p}=d,l=s.get(p),c=this._pc.getTransceivers().find(u=>u.mid===l);if(!c)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(l,c),t.push({localId:l,track:c.receiver.track,rtpReceiver:c.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let i of e){L.debug("stopReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};L.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();L.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(let i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){L.debug("pauseReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};L.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();L.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){L.debug("resumeReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};L.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();L.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d}=e,p={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d,protocol:s};L.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let c={type:"offer",sdp:this._remoteSdp.getSdp()};L.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let u=await this._pc.createAnswer();if(!this._transportReady){let m=ze.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:m})}L.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=ze.parse(this._pc.localDescription.sdp));let s=$s.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,a)=>{this.safeEmit("@connect",{dtlsParameters:s},i,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Kl.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};zs.Safari12=fn});var Yo=C(Ks=>{"use strict";Object.defineProperty(Ks,"__esModule",{value:!0});Ks.Safari11=void 0;var He=Se(),Yl=ee(),Go=ie(),mr=le(),Hs=Pe(),Qo=$r(),Xl=be(),Jl=ke(),$=new Yl.Logger("Safari11"),Zl="Safari11",Wo={OS:1024,MIS:1024},gn=class r extends Xl.HandlerInterface{constructor(){super();h(this,"_direction");h(this,"_remoteSdp");h(this,"_sendingRtpParametersByKind");h(this,"_sendingRemoteRtpParametersByKind");h(this,"_forcedLocalDtlsRole");h(this,"_pc");h(this,"_sendStream",new MediaStream);h(this,"_mapSendLocalIdRtpSender",new Map);h(this,"_nextSendLocalId",0);h(this,"_mapRecvLocalIdInfo",new Map);h(this,"_hasDataChannelMediaSection",!1);h(this,"_nextSendSctpStreamId",0);h(this,"_transportReady",!1)}static createFactory(){return()=>new r}get name(){return Zl}close(){if($.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){$.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{let t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch{}let s=He.parse(t.sdp);return Hs.extractRtpCapabilities({sdpObject:s})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return $.debug("getNativeSctpCapabilities()"),{numStreams:Wo}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:c}){$.debug("run()"),this._direction=e,this._remoteSdp=new Jl.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:mr.getSendingRtpParameters("audio",c),video:mr.getSendingRtpParameters("video",c)},this._sendingRemoteRtpParametersByKind={audio:mr.getSendingRemoteRtpParameters("audio",c),video:mr.getSendingRemoteRtpParameters("video",c)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...p},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",u=>{this.emit("@icecandidateerror",u)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch($.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(e){$.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if($.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});$.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};$.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};$.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();$.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:i}){this.assertSendDirection(),$.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&$.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let a=await this._pc.createOffer(),o=He.parse(a.sdp);o.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let d,p=Go.clone(this._sendingRtpParametersByKind[e.kind]);p.codecs=mr.reduceCodecs(p.codecs);let l=Go.clone(this._sendingRemoteRtpParametersByKind[e.kind]);if(l.codecs=mr.reduceCodecs(l.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),e.kind==="video"&&t&&t.length>1&&($.debug("send() | enabling simulcast"),o=He.parse(a.sdp),d=o.media.find(_=>_.type==="video"),Qo.addLegacySimulcast({offerMediaObject:d,track:e,numStreams:t.length}),a={type:"offer",sdp:He.write(o)}),$.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),o=He.parse(this._pc.localDescription.sdp),d=o.media.find(_=>_.type===e.kind),p.rtcp.cname=Hs.getCname({offerMediaObject:d}),p.encodings=Qo.getRtpEncodings({offerMediaObject:d,track:e}),t)for(let _=0;_<p.encodings.length;++_)t[_]&&Object.assign(p.encodings[_],t[_]);if(p.encodings.length>1&&p.codecs[0].mimeType.toLowerCase()==="video/vp8")for(let _ of p.encodings)_.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,offerRtpParameters:p,answerRtpParameters:l,codecOptions:s});let c={type:"answer",sdp:this._remoteSdp.getSdp()};$.debug("send() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c);let u=String(this._nextSendLocalId);this._nextSendLocalId++;let m=this._pc.getSenders().find(_=>_.track===e);return this._mapSendLocalIdRtpSender.set(u,m),{localId:u,rtpParameters:p,rtpSender:m}}async stopSending(e){this.assertSendDirection();let t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);let s=await this._pc.createOffer();$.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s);try{await this._pc.setLocalDescription(s)}catch(a){if(this._sendStream.getTracks().length===0){$.warn("stopSending() | ignoring expected error due no sending tracks: %s",a.toString());return}throw a}if(this._pc.signalingState==="stable")return;let i={type:"answer",sdp:this._remoteSdp.getSdp()};$.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?$.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):$.debug("replaceTrack() [localId:%s, no track]",e);let s=this._mapSendLocalIdRtpSender.get(e);if(!s)throw new Error("associated RTCRtpSender not found");let i=s.track;await s.replaceTrack(t),i&&this._sendStream.removeTrack(i),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),$.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._mapSendLocalIdRtpSender.get(e);if(!s)throw new Error("associated RTCRtpSender not found");let i=s.getParameters();i.encodings.forEach((a,o)=>{o<=t?a.active=!0:a.active=!1}),await s.setParameters(i)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),$.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._mapSendLocalIdRtpSender.get(e);if(!s)throw new Error("associated RTCRtpSender not found");let i=s.getParameters();i.encodings.forEach((a,o)=>{i.encodings[o]={...a,...t}}),await s.setParameters(i)}async getSenderStats(e){this.assertSendDirection();let t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:a}){this.assertSendDirection();let o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:a};$.debug("sendDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Wo.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),c=He.parse(l.sdp),u=c.media.find(_=>_.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),$.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let m={type:"answer",sdp:this._remoteSdp.getSdp()};$.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._hasDataChannelMediaSection=!0}let p={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:d,sctpStreamParameters:p}}async receive(e){this.assertRecvDirection();let t=[];for(let o of e){let{trackId:d,kind:p,rtpParameters:l,streamId:c}=o;$.debug("receive() [trackId:%s, kind:%s]",d,p);let u=p;this._remoteSdp.receive({mid:u,kind:p,offerRtpParameters:l,streamId:c??l.rtcp.cname,trackId:d})}let s={type:"offer",sdp:this._remoteSdp.getSdp()};$.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let i=await this._pc.createAnswer(),a=He.parse(i.sdp);for(let o of e){let{kind:d,rtpParameters:p}=o,l=d,c=a.media.find(u=>String(u.mid)===l);Hs.applyCodecParameters({offerRtpParameters:p,answerMediaObject:c})}i={type:"answer",sdp:He.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),$.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(let o of e){let{kind:d,trackId:p,rtpParameters:l}=o,c=d,u=p,m=this._pc.getReceivers().find(_=>_.track&&_.track.id===u);if(!m)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(u,{mid:c,rtpParameters:l,rtpReceiver:m}),t.push({localId:u,track:m.track,rtpReceiver:m})}return t}async stopReceiving(e){this.assertRecvDirection();for(let i of e){$.debug("stopReceiving() [localId:%s]",i);let{mid:a,rtpParameters:o}=this._mapRecvLocalIdInfo.get(i)??{};this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:a,offerRtpParameters:o})}let t={type:"offer",sdp:this._remoteSdp.getSdp()};$.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();$.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertRecvDirection();let{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)??{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async pauseReceiving(e){}async resumeReceiving(e){}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertRecvDirection();let{streamId:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d}=e,p={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d,protocol:s};$.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});let c={type:"offer",sdp:this._remoteSdp.getSdp()};$.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let u=await this._pc.createAnswer();if(!this._transportReady){let m=He.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:m})}$.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=He.parse(this._pc.localDescription.sdp));let s=Hs.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,a)=>{this.safeEmit("@connect",{dtlsParameters:s},i,a)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};Ks.Safari11=gn});var Jo=C(Vs=>{"use strict";Object.defineProperty(Vs,"__esModule",{value:!0});Vs.getCapabilities=eu;Vs.mangleRtpParameters=tu;var Xo=ie();function eu(){let r=RTCRtpReceiver.getCapabilities(),n=Xo.clone(r);for(let e of n.codecs??[]){if(e.channels=e.numChannels,delete e.numChannels,e.mimeType=e.mimeType??`${e.kind}/${e.name}`,e.parameters){let t=e.parameters;t.apt&&(t.apt=Number(t.apt)),t["packetization-mode"]&&(t["packetization-mode"]=Number(t["packetization-mode"]))}for(let t of e.rtcpFeedback??[])t.parameter||(t.parameter="")}return n}function tu(r){let n=Xo.clone(r);n.mid&&(n.muxId=n.mid,delete n.mid);for(let e of n.codecs)e.channels&&(e.numChannels=e.channels,delete e.channels),e.mimeType&&!e.name&&(e.name=e.mimeType.split("/")[1]),delete e.mimeType;return n}});var Zo=C(Qs=>{"use strict";Object.defineProperty(Qs,"__esModule",{value:!0});Qs.Edge11=void 0;var ru=ee(),_n=de(),Gs=ie(),wn=le(),vn=Jo(),su=be(),V=new ru.Logger("Edge11"),iu="Edge11",Sn=class r extends su.HandlerInterface{constructor(){super();h(this,"_sendingRtpParametersByKind");h(this,"_remoteIceParameters");h(this,"_remoteIceCandidates");h(this,"_remoteDtlsParameters");h(this,"_iceGatherer");h(this,"_iceTransport");h(this,"_dtlsTransport");h(this,"_rtpSenders",new Map);h(this,"_rtpReceivers",new Map);h(this,"_nextSendLocalId",0);h(this,"_cname");h(this,"_transportReady",!1)}static createFactory(){return()=>new r}get name(){return iu}close(){V.debug("close()");try{this._iceGatherer.close()}catch{}try{this._iceTransport.stop()}catch{}try{this._dtlsTransport.stop()}catch{}for(let e of this._rtpSenders.values())try{e.stop()}catch{}for(let e of this._rtpReceivers.values())try{e.stop()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){return V.debug("getNativeRtpCapabilities()"),vn.getCapabilities()}async getNativeSctpCapabilities(){return V.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:c}){V.debug("run()"),this._sendingRtpParametersByKind={audio:wn.getSendingRtpParameters("audio",c),video:wn.getSendingRtpParameters("video",c)},this._remoteIceParameters=t,this._remoteIceCandidates=s,this._remoteDtlsParameters=i,this._cname=`CNAME-${Gs.generateRandomNumber()}`,this.setIceGatherer({iceServers:o,iceTransportPolicy:d}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(e){throw new _n.UnsupportedError("not supported")}async restartIce(e){if(V.debug("restartIce()"),this._remoteIceParameters=e,!!this._transportReady){V.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(let t of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(t);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:i}){V.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),V.debug("send() | calling new RTCRtpSender()");let a=new RTCRtpSender(e,this._dtlsTransport),o=Gs.clone(this._sendingRtpParametersByKind[e.kind]);o.codecs=wn.reduceCodecs(o.codecs,i);let d=o.codecs.some(c=>/.+\/rtx$/i.test(c.mimeType));t||(t=[{}]);for(let c of t)c.ssrc=Gs.generateRandomNumber(),d&&(c.rtx={ssrc:Gs.generateRandomNumber()});o.encodings=t,o.rtcp={cname:this._cname,reducedSize:!0,mux:!0};let p=vn.mangleRtpParameters(o);V.debug("send() | calling rtpSender.send() [params:%o]",p),await a.send(p);let l=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(l,a),{localId:l,rtpParameters:o,rtpSender:a}}async stopSending(e){V.debug("stopSending() [localId:%s]",e);let t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{V.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(s){throw V.warn("stopSending() | rtpSender.stop() failed:%o",s),s}}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){t?V.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):V.debug("replaceTrack() [localId:%s, no track]",e);let s=this._rtpSenders.get(e);if(!s)throw new Error("RTCRtpSender not found");s.setTrack(t)}async setMaxSpatialLayer(e,t){V.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._rtpSenders.get(e);if(!s)throw new Error("RTCRtpSender not found");let i=s.getParameters();i.encodings.forEach((a,o)=>{o<=t?a.active=!0:a.active=!1}),await s.setParameters(i)}async setRtpEncodingParameters(e,t){V.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._rtpSenders.get(e);if(!s)throw new Error("RTCRtpSender not found");let i=s.getParameters();i.encodings.forEach((a,o)=>{i.encodings[o]={...a,...t}}),await s.setParameters(i)}async getSenderStats(e){let t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(e){throw new _n.UnsupportedError("not implemented")}async receive(e){let t=[];for(let s of e){let{trackId:i,kind:a}=s;V.debug("receive() [trackId:%s, kind:%s]",i,a)}this._transportReady||await this.setupTransport({localDtlsRole:"server"});for(let s of e){let{trackId:i,kind:a,rtpParameters:o}=s;V.debug("receive() | calling new RTCRtpReceiver()");let d=new RTCRtpReceiver(this._dtlsTransport,a);d.addEventListener("error",c=>{V.error('rtpReceiver "error" event [event:%o]',c)});let p=vn.mangleRtpParameters(o);V.debug("receive() | calling rtpReceiver.receive() [params:%o]",p),await d.receive(p);let l=i;this._rtpReceivers.set(l,d),t.push({localId:l,track:d.track,rtpReceiver:d})}return t}async stopReceiving(e){for(let t of e){V.debug("stopReceiving() [localId:%s]",t);let s=this._rtpReceivers.get(t);if(!s)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(t);try{V.debug("stopReceiving() | calling rtpReceiver.stop()"),s.stop()}catch(i){V.warn("stopReceiving() | rtpReceiver.stop() failed:%o",i)}}}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){let t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(e){throw new _n.UnsupportedError("not implemented")}setIceGatherer({iceServers:e,iceTransportPolicy:t}){let s=new RTCIceGatherer({iceServers:e??[],gatherPolicy:t??"all"});s.addEventListener("error",i=>{V.error('iceGatherer "error" event [event:%o]',i)});try{s.gather()}catch(i){V.debug("setIceGatherer() | iceGatherer.gather() failed: %s",i.toString())}this._iceGatherer=s}setIceTransport(){let e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",()=>{switch(e.state){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),e.addEventListener("icestatechange",()=>{switch(e.state){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),e.addEventListener("candidatepairchange",t=>{V.debug('iceTransport "candidatepairchange" event [pair:%o]',t.pair)}),this._iceTransport=e}setDtlsTransport(){let e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",()=>{V.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",()=>{V.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),e.state==="closed"&&this.emit("@connectionstatechange","closed")}),e.addEventListener("error",t=>{V.error('dtlsTransport "error" event [event:%o]',t)}),this._dtlsTransport=e}async setupTransport({localDtlsRole:e}){V.debug("setupTransport()");let t=this._dtlsTransport.getLocalParameters();t.role=e,await new Promise((s,i)=>{this.safeEmit("@connect",{dtlsParameters:t},s,i)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(let s of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(s);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(s=>s.algorithm==="sha-256"||s.algorithm==="sha-384"||s.algorithm==="sha-512"),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}};Qs.Edge11=Sn});var rc=C(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});Ys.ReactNativeUnifiedPlan=void 0;var Ke=Se(),nu=ee(),ec=ie(),fr=le(),Ws=Pe(),bn=ut(),au=Ur(),ou=de(),cu=be(),du=ke(),pu=st(),x=new nu.Logger("ReactNativeUnifiedPlan"),lu="ReactNativeUnifiedPlan",tc={OS:1024,MIS:1024},yn=class r extends cu.HandlerInterface{constructor(){super();h(this,"_closed",!1);h(this,"_direction");h(this,"_remoteSdp");h(this,"_sendingRtpParametersByKind");h(this,"_sendingRemoteRtpParametersByKind");h(this,"_forcedLocalDtlsRole");h(this,"_pc");h(this,"_mapMidTransceiver",new Map);h(this,"_sendStream",new MediaStream);h(this,"_hasDataChannelMediaSection",!1);h(this,"_nextSendSctpStreamId",0);h(this,"_transportReady",!1)}static createFactory(){return()=>new r}get name(){return lu}close(){if(x.debug("close()"),!this._closed){if(this._closed=!0,this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){x.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch{}let s=Ke.parse(t.sdp),i=Ws.extractRtpCapabilities({sdpObject:s});return au.addNackSupportForOpus(i),i}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return x.debug("getNativeSctpCapabilities()"),{numStreams:tc}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:c}){this.assertNotClosed(),x.debug("run()"),this._direction=e,this._remoteSdp=new du.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:fr.getSendingRtpParameters("audio",c),video:fr.getSendingRtpParameters("video",c)},this._sendingRemoteRtpParametersByKind={audio:fr.getSendingRemoteRtpParameters("audio",c),video:fr.getSendingRemoteRtpParameters("video",c)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...p},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",u=>{this.emit("@icecandidateerror",u)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(x.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(e){this.assertNotClosed(),x.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),x.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});x.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();x.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:i,onRtpSender:a}){this.assertNotClosed(),this.assertSendDirection(),x.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((g,w)=>{g.rid=`r${w}`});let o=ec.clone(this._sendingRtpParametersByKind[e.kind]);o.codecs=fr.reduceCodecs(o.codecs,i);let d=ec.clone(this._sendingRemoteRtpParametersByKind[e.kind]);d.codecs=fr.reduceCodecs(d.codecs,i);let p=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});a&&a(l.sender);let c=await this._pc.createOffer(),u=Ke.parse(c.sdp);u.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let m;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u});let _=!1,b=(0,pu.parse)((t??[{}])[0].scalabilityMode);t&&t.length===1&&b.spatialLayers>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(x.debug("send() | enabling legacy simulcast for VP9 SVC"),_=!0,u=Ke.parse(c.sdp),m=u.media[p.idx],bn.addLegacySimulcast({offerMediaObject:m,numStreams:b.spatialLayers}),c={type:"offer",sdp:Ke.write(u)}),x.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);let v=l.mid??void 0;if(v||x.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),o.mid=v,u=Ke.parse(this._pc.localDescription.sdp),m=u.media[p.idx],o.rtcp.cname=Ws.getCname({offerMediaObject:m}),!t)o.encodings=bn.getRtpEncodings({offerMediaObject:m});else if(t.length===1){let g=bn.getRtpEncodings({offerMediaObject:m});Object.assign(g[0],t[0]),_&&(g=[g[0]]),o.encodings=g}else o.encodings=t;if(o.encodings.length>1&&(o.codecs[0].mimeType.toLowerCase()==="video/vp8"||o.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let g of o.encodings)g.scalabilityMode?g.scalabilityMode=`L1T${b.temporalLayers}`:g.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:m,reuseMid:p.reuseMid,offerRtpParameters:o,answerRtpParameters:d,codecOptions:s});let f={type:"answer",sdp:this._remoteSdp.getSdp()};return x.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),v||(v=l.mid,o.mid=v),this._mapMidTransceiver.set(v,l),{localId:v,rtpParameters:o,rtpSender:l.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;x.debug("stopSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}let i=await this._pc.createOffer();x.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);let a={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),x.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let s=await this._pc.createOffer();x.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),x.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";let s=await this._pc.createOffer();x.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?x.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):x.debug("replaceTrack() [localId:%s, no track]",e);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),x.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((d,p)=>{p<=t?d.active=!0:d.active=!1}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let a=await this._pc.createOffer();x.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);let o={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),x.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((d,p)=>{i.encodings[p]={...d,...t}}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let a=await this._pc.createOffer();x.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);let o={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:a}){this.assertNotClosed(),this.assertSendDirection();let o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:a};x.debug("sendDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%tc.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),c=Ke.parse(l.sdp),u=c.media.find(_=>_.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),x.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let m={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._hasDataChannelMediaSection=!0}let p={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:d,sctpStreamParameters:p}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],s=new Map;for(let d of e){let{trackId:p,kind:l,rtpParameters:c,streamId:u}=d;x.debug("receive() [trackId:%s, kind:%s]",p,l);let m=c.mid??String(this._mapMidTransceiver.size);s.set(p,m),this._remoteSdp.receive({mid:m,kind:l,offerRtpParameters:c,streamId:u??c.rtcp.cname,trackId:p})}let i={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);for(let d of e){let{trackId:p,onRtpReceiver:l}=d;if(l){let c=s.get(p),u=this._pc.getTransceivers().find(m=>m.mid===c);if(!u)throw new Error("transceiver not found");l(u.receiver)}}let a=await this._pc.createAnswer(),o=Ke.parse(a.sdp);for(let d of e){let{trackId:p,rtpParameters:l}=d,c=s.get(p),u=o.media.find(m=>String(m.mid)===c);Ws.applyCodecParameters({offerRtpParameters:l,answerMediaObject:u})}a={type:"answer",sdp:Ke.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),x.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(let d of e){let{trackId:p}=d,l=s.get(p),c=this._pc.getTransceivers().find(u=>u.mid===l);if(c)this._mapMidTransceiver.set(l,c),t.push({localId:l,track:c.receiver.track,rtpReceiver:c.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let i of e){x.debug("stopReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();x.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(let i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){x.debug("pauseReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();x.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){x.debug("resumeReceiving() [localId:%s]",i);let a=this._mapMidTransceiver.get(i);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();x.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d}=e,p={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d,protocol:s};x.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let c={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let u=await this._pc.createAnswer();if(!this._transportReady){let m=Ke.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:m})}x.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Ke.parse(this._pc.localDescription.sdp));let s=Ws.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,a)=>{this.safeEmit("@connect",{dtlsParameters:s},i,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new ou.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};Ys.ReactNativeUnifiedPlan=yn});var nc=C(Js=>{"use strict";Object.defineProperty(Js,"__esModule",{value:!0});Js.ReactNative=void 0;var Ve=Se(),uu=ee(),Hr=de(),Rn=ie(),gr=le(),Xs=Pe(),sc=$r(),hu=be(),mu=ke(),z=new uu.Logger("ReactNative"),fu="ReactNative",ic={OS:1024,MIS:1024},Cn=class r extends hu.HandlerInterface{constructor(){super();h(this,"_direction");h(this,"_remoteSdp");h(this,"_sendingRtpParametersByKind");h(this,"_sendingRemoteRtpParametersByKind");h(this,"_forcedLocalDtlsRole");h(this,"_pc");h(this,"_sendStream",new MediaStream);h(this,"_mapSendLocalIdTrack",new Map);h(this,"_nextSendLocalId",0);h(this,"_mapRecvLocalIdInfo",new Map);h(this,"_hasDataChannelMediaSection",!1);h(this,"_nextSendSctpStreamId",0);h(this,"_transportReady",!1)}static createFactory(){return()=>new r}get name(){return fu}close(){if(z.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){z.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{let t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch{}let s=Ve.parse(t.sdp);return Xs.extractRtpCapabilities({sdpObject:s})}catch(t){try{e.close()}catch{}throw t}}async getNativeSctpCapabilities(){return z.debug("getNativeSctpCapabilities()"),{numStreams:ic}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,extendedRtpCapabilities:c}){z.debug("run()"),this._direction=e,this._remoteSdp=new mu.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:gr.getSendingRtpParameters("audio",c),video:gr.getSendingRtpParameters("video",c)},this._sendingRemoteRtpParametersByKind={audio:gr.getSendingRemoteRtpParameters("audio",c),video:gr.getSendingRemoteRtpParameters("video",c)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...p},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",u=>{this.emit("@icecandidateerror",u)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(z.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(e){z.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(z.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});z.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};z.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};z.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();z.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:i}){this.assertSendDirection(),z.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&z.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let a=await this._pc.createOffer(),o=Ve.parse(a.sdp);o.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let d,p=Rn.clone(this._sendingRtpParametersByKind[e.kind]);p.codecs=gr.reduceCodecs(p.codecs);let l=Rn.clone(this._sendingRemoteRtpParametersByKind[e.kind]);if(l.codecs=gr.reduceCodecs(l.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),e.kind==="video"&&t&&t.length>1&&(z.debug("send() | enabling simulcast"),o=Ve.parse(a.sdp),d=o.media.find(m=>m.type==="video"),sc.addLegacySimulcast({offerMediaObject:d,track:e,numStreams:t.length}),a={type:"offer",sdp:Ve.write(o)}),z.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),o=Ve.parse(this._pc.localDescription.sdp),d=o.media.find(m=>m.type===e.kind),p.rtcp.cname=Xs.getCname({offerMediaObject:d}),p.encodings=sc.getRtpEncodings({offerMediaObject:d,track:e}),t)for(let m=0;m<p.encodings.length;++m)t[m]&&Object.assign(p.encodings[m],t[m]);if(p.encodings.length>1&&(p.codecs[0].mimeType.toLowerCase()==="video/vp8"||p.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let m of p.encodings)m.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,offerRtpParameters:p,answerRtpParameters:l,codecOptions:s});let c={type:"answer",sdp:this._remoteSdp.getSdp()};z.debug("send() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c);let u=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(u,e),{localId:u,rtpParameters:p}}async stopSending(e){this.assertSendDirection(),z.debug("stopSending() [localId:%s]",e);let t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);let s=await this._pc.createOffer();z.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s);try{await this._pc.setLocalDescription(s)}catch(a){if(this._sendStream.getTracks().length===0){z.warn("stopSending() | ignoring expected error due no sending tracks: %s",a.toString());return}throw a}if(this._pc.signalingState==="stable")return;let i={type:"answer",sdp:this._remoteSdp.getSdp()};z.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new Hr.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new Hr.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new Hr.UnsupportedError("not implemented")}async getSenderStats(e){throw new Hr.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:a}){this.assertSendDirection();let o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:s,protocol:a};z.debug("sendDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(i,o);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%ic.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),c=Ve.parse(l.sdp),u=c.media.find(_=>_.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),z.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let m={type:"answer",sdp:this._remoteSdp.getSdp()};z.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._hasDataChannelMediaSection=!0}let p={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits};return{dataChannel:d,sctpStreamParameters:p}}async receive(e){this.assertRecvDirection();let t=[],s=new Map;for(let d of e){let{trackId:p,kind:l,rtpParameters:c}=d;z.debug("receive() [trackId:%s, kind:%s]",p,l);let u=l,m=d.streamId??c.rtcp.cname;z.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),m+=`-hack-${Rn.generateRandomNumber()}`,s.set(p,m),this._remoteSdp.receive({mid:u,kind:l,offerRtpParameters:c,streamId:m,trackId:p})}let i={type:"offer",sdp:this._remoteSdp.getSdp()};z.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let a=await this._pc.createAnswer(),o=Ve.parse(a.sdp);for(let d of e){let{kind:p,rtpParameters:l}=d,c=p,u=o.media.find(m=>String(m.mid)===c);Xs.applyCodecParameters({offerRtpParameters:l,answerMediaObject:u})}a={type:"answer",sdp:Ve.write(o)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),z.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(let d of e){let{kind:p,trackId:l,rtpParameters:c}=d,u=l,m=p,_=s.get(l),v=this._pc.getRemoteStreams().find(f=>f.id===_).getTrackById(u);if(!v)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(u,{mid:m,rtpParameters:c}),t.push({localId:u,track:v})}return t}async stopReceiving(e){this.assertRecvDirection();for(let i of e){z.debug("stopReceiving() [localId:%s]",i);let{mid:a,rtpParameters:o}=this._mapRecvLocalIdInfo.get(i)??{};this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:a,offerRtpParameters:o})}let t={type:"offer",sdp:this._remoteSdp.getSdp()};z.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();z.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new Hr.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertRecvDirection();let{streamId:i,ordered:a,maxPacketLifeTime:o,maxRetransmits:d}=e,p={negotiated:!0,id:i,ordered:a,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:d,protocol:s};z.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});let c={type:"offer",sdp:this._remoteSdp.getSdp()};z.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let u=await this._pc.createAnswer();if(!this._transportReady){let m=Ve.parse(u.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:m})}z.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setLocalDescription(u),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Ve.parse(this._pc.localDescription.sdp));let s=Xs.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,a)=>{this.safeEmit("@connect",{dtlsParameters:s},i,a)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};Js.ReactNative=Cn});var Dn=C(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.Device=void 0;_r.detectDeviceAsync=cc;_r.detectDevice=dc;var oc=Da(),gu=ee(),_u=Ze(),Dt=de(),ac=ie(),_t=le(),wu=Wi(),vu=vo(),Su=yo(),bu=To(),yu=xo(),Ru=Mo(),Cu=Fo(),Tu=$o(),Du=Vo(),Pu=Yo(),ku=Zo(),xu=rc(),Eu=nc(),ne=new gu.Logger("Device");async function cc(r){ne.debug("detectDeviceAsync() [userAgent:%s]",r),!r&&typeof navigator=="object"&&(r=navigator.userAgent);let n=await(0,oc.UAParser)(r).withFeatureCheck();return pc(n)}function dc(r){ne.debug("detectDevice() [userAgent:%s]",r),!r&&typeof navigator=="object"&&(r=navigator.userAgent);let n=(0,oc.UAParser)(r);return pc(n)}var Tn=class r{constructor({handlerName:n,handlerFactory:e}={}){h(this,"_handlerFactory");h(this,"_handlerName");h(this,"_loaded",!1);h(this,"_extendedRtpCapabilities");h(this,"_recvRtpCapabilities");h(this,"_canProduceByKind");h(this,"_sctpCapabilities");h(this,"_observer",new _u.EnhancedEventEmitter);if(ne.debug("constructor()"),n&&e)throw new TypeError("just one of handlerName or handlerInterface can be given");if(e)this._handlerFactory=e;else{if(n)ne.debug("constructor() | handler given: %s",n);else if(n=dc(),n)ne.debug("constructor() | detected handler: %s",n);else throw new Dt.UnsupportedError("device not supported");switch(n){case"Chrome111":{this._handlerFactory=vu.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=Su.Chrome74.createFactory();break}case"Chrome70":{this._handlerFactory=bu.Chrome70.createFactory();break}case"Chrome67":{this._handlerFactory=yu.Chrome67.createFactory();break}case"Chrome55":{this._handlerFactory=Ru.Chrome55.createFactory();break}case"Firefox120":{this._handlerFactory=Cu.Firefox120.createFactory();break}case"Firefox60":{this._handlerFactory=Tu.Firefox60.createFactory();break}case"Safari12":{this._handlerFactory=Du.Safari12.createFactory();break}case"Safari11":{this._handlerFactory=Pu.Safari11.createFactory();break}case"Edge11":{this._handlerFactory=ku.Edge11.createFactory();break}case"ReactNativeUnifiedPlan":{this._handlerFactory=xu.ReactNativeUnifiedPlan.createFactory();break}case"ReactNative":{this._handlerFactory=Eu.ReactNative.createFactory();break}default:throw new TypeError(`unknown handlerName "${n}"`)}}let t=this._handlerFactory();this._handlerName=t.name,t.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}static async factory({handlerName:n,handlerFactory:e}={}){if(ne.debug("factory()"),n&&e)throw new TypeError("just one of handlerName or handlerInterface can be given");if(!n&&!e&&(n=await cc(),!n))throw new Dt.UnsupportedError("device not supported");return new r({handlerName:n,handlerFactory:e})}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new Dt.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new Dt.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:n}){ne.debug("load() [routerRtpCapabilities:%o]",n);let e;try{if(this._loaded)throw new Dt.InvalidStateError("already loaded");let t=ac.clone(n);_t.validateRtpCapabilities(t),e=this._handlerFactory();let s=await e.getNativeRtpCapabilities();ne.debug("load() | got native RTP capabilities:%o",s);let i=ac.clone(s);_t.validateRtpCapabilities(i),this._extendedRtpCapabilities=_t.getExtendedRtpCapabilities(i,t),ne.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=_t.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=_t.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=_t.getRecvRtpCapabilities(this._extendedRtpCapabilities),_t.validateRtpCapabilities(this._recvRtpCapabilities),ne.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await e.getNativeSctpCapabilities(),ne.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),_t.validateSctpCapabilities(this._sctpCapabilities),ne.debug("load() succeeded"),this._loaded=!0,e.close()}catch(t){throw e&&e.close(),t}}canProduce(n){if(this._loaded){if(n!=="audio"&&n!=="video")throw new TypeError(`invalid kind "${n}"`)}else throw new Dt.InvalidStateError("not loaded");return this._canProduceByKind[n]}createSendTransport({id:n,iceParameters:e,iceCandidates:t,dtlsParameters:s,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:p,appData:l}){return ne.debug("createSendTransport()"),this.createTransport({direction:"send",id:n,iceParameters:e,iceCandidates:t,dtlsParameters:s,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:p,appData:l})}createRecvTransport({id:n,iceParameters:e,iceCandidates:t,dtlsParameters:s,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:p,appData:l}){return ne.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:n,iceParameters:e,iceCandidates:t,dtlsParameters:s,sctpParameters:i,iceServers:a,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:p,appData:l})}createTransport({direction:n,id:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,appData:c}){if(this._loaded){if(typeof e!="string")throw new TypeError("missing id");if(typeof t!="object")throw new TypeError("missing iceParameters");if(Array.isArray(s)){if(typeof i!="object")throw new TypeError("missing dtlsParameters");if(a&&typeof a!="object")throw new TypeError("wrong sctpParameters");if(c&&typeof c!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new Dt.InvalidStateError("not loaded");let u=new wu.Transport({direction:n,id:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:l,appData:c,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",u),u}};_r.Device=Tn;function pc(r){if(typeof navigator=="object"&&navigator.product==="ReactNative"){if(ne.debug("detectDeviceImpl() | React-Native detected"),typeof RTCPeerConnection>"u"){ne.warn("detectDeviceImpl() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?");return}return typeof RTCRtpTransceiver<"u"?(ne.debug("detectDeviceImpl() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(ne.debug("detectDeviceImpl() | ReactNative PlanB handler chosen"),"ReactNative")}else{ne.debug("detectDeviceImpl() | browser detected [userAgent:%s, parsed:%o]",r.ua,r);let n=r.browser,e=n.name?.toLowerCase(),t=parseInt(n.major??"0"),i=r.engine.name?.toLowerCase(),a=r.os,o=a.name?.toLowerCase(),d=parseFloat(a.version??"0"),l=r.device.model?.toLowerCase(),c=o==="ios"||l==="ipad",u=e&&["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(e),m=e&&["firefox","mobile firefox","mobile focus"].includes(e),_=e&&["safari","mobile safari"].includes(e),b=e&&["edge"].includes(e);if((u||b)&&!c&&t>=111)return"Chrome111";if(u&&!c&&t>=74||b&&!c&&t>=88)return"Chrome74";if(u&&!c&&t>=70)return"Chrome70";if(u&&!c&&t>=67)return"Chrome67";if(u&&!c&&t>=55)return"Chrome55";if(m&&!c&&t>=120)return"Firefox120";if(m&&!c&&t>=60)return"Firefox60";if(m&&c&&d>=14.3)return"Safari12";if(_&&t>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(_&&t>=11)return"Safari11";if(b&&!c&&t>=11&&t<=18)return"Edge11";if(i==="webkit"&&c&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(i==="blink"){let v=r.ua.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(v){let f=Number(v[1]);return f>=111?"Chrome111":f>=74?"Chrome74":f>=70?"Chrome70":f>=67?"Chrome67":"Chrome55"}else return"Chrome111"}else{ne.warn("detectDeviceImpl() | browser not supported [name:%s, version:%s]",e,t);return}}}});var uc=C(lc=>{"use strict";Object.defineProperty(lc,"__esModule",{value:!0})});var mc=C(hc=>{"use strict";Object.defineProperty(hc,"__esModule",{value:!0})});var fc=C(he=>{"use strict";var Lu=he&&he.__createBinding||(Object.create?function(r,n,e,t){t===void 0&&(t=e);var s=Object.getOwnPropertyDescriptor(n,e);(!s||("get"in s?!n.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return n[e]}}),Object.defineProperty(r,t,s)}:function(r,n,e,t){t===void 0&&(t=e),r[t]=n[e]}),Ge=he&&he.__exportStar||function(r,n){for(var e in r)e!=="default"&&!Object.prototype.hasOwnProperty.call(n,e)&&Lu(n,r,e)};Object.defineProperty(he,"__esModule",{value:!0});Ge(Dn(),he);Ge(Wi(),he);Ge(qi(),he);Ge(Bi(),he);Ge(zi(),he);Ge(Ki(),he);Ge(uc(),he);Ge(mc(),he);Ge(be(),he);Ge(de(),he)});var gc=C(Pn=>{"use strict";Object.defineProperty(Pn,"__esModule",{value:!0});Pn.default="ffffffff-ffff-ffff-ffff-ffffffffffff"});var _c=C(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.default="00000000-0000-0000-0000-000000000000"});var wc=C(xn=>{"use strict";Object.defineProperty(xn,"__esModule",{value:!0});xn.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});var Kr=C(En=>{"use strict";Object.defineProperty(En,"__esModule",{value:!0});var Iu=wc();function Mu(r){return typeof r=="string"&&Iu.default.test(r)}En.default=Mu});var Vr=C(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});var Ou=Kr();function ju(r){if(!(0,Ou.default)(r))throw TypeError("Invalid UUID");let n;return Uint8Array.of((n=parseInt(r.slice(0,8),16))>>>24,n>>>16&255,n>>>8&255,n&255,(n=parseInt(r.slice(9,13),16))>>>8,n&255,(n=parseInt(r.slice(14,18),16))>>>8,n&255,(n=parseInt(r.slice(19,23),16))>>>8,n&255,(n=parseInt(r.slice(24,36),16))/1099511627776&255,n/4294967296&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255)}Ln.default=ju});var it=C(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.unsafeStringify=void 0;var Au=Kr(),ue=[];for(let r=0;r<256;++r)ue.push((r+256).toString(16).slice(1));function vc(r,n=0){return(ue[r[n+0]]+ue[r[n+1]]+ue[r[n+2]]+ue[r[n+3]]+"-"+ue[r[n+4]]+ue[r[n+5]]+"-"+ue[r[n+6]]+ue[r[n+7]]+"-"+ue[r[n+8]]+ue[r[n+9]]+"-"+ue[r[n+10]]+ue[r[n+11]]+ue[r[n+12]]+ue[r[n+13]]+ue[r[n+14]]+ue[r[n+15]]).toLowerCase()}Gr.unsafeStringify=vc;function Nu(r,n=0){let e=vc(r,n);if(!(0,Au.default)(e))throw TypeError("Stringified UUID is invalid");return e}Gr.default=Nu});var Zs=C(Mn=>{"use strict";Object.defineProperty(Mn,"__esModule",{value:!0});var In,Fu=new Uint8Array(16);function qu(){if(!In){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");In=crypto.getRandomValues.bind(crypto)}return In(Fu)}Mn.default=qu});var On=C(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.updateV1State=void 0;var Sc=Zs(),Uu=it(),Qr={};function Bu(r,n,e){let t,s=r?._v6??!1;if(r){let i=Object.keys(r);i.length===1&&i[0]==="_v6"&&(r=void 0)}if(r)t=bc(r.random??r.rng?.()??(0,Sc.default)(),r.msecs,r.nsecs,r.clockseq,r.node,n,e);else{let i=Date.now(),a=(0,Sc.default)();yc(Qr,i,a),t=bc(a,Qr.msecs,Qr.nsecs,s?void 0:Qr.clockseq,s?void 0:Qr.node,n,e)}return n??(0,Uu.unsafeStringify)(t)}function yc(r,n,e){return r.msecs??(r.msecs=-1/0),r.nsecs??(r.nsecs=0),n===r.msecs?(r.nsecs++,r.nsecs>=1e4&&(r.node=void 0,r.nsecs=0)):n>r.msecs?r.nsecs=0:n<r.msecs&&(r.node=void 0),r.node||(r.node=e.slice(10,16),r.node[0]|=1,r.clockseq=(e[8]<<8|e[9])&16383),r.msecs=n,r}Wr.updateV1State=yc;function bc(r,n,e,t,s,i,a=0){if(r.length<16)throw new Error("Random bytes length must be >= 16");if(!i)i=new Uint8Array(16),a=0;else if(a<0||a+16>i.length)throw new RangeError(`UUID byte range ${a}:${a+15} is out of buffer bounds`);n??(n=Date.now()),e??(e=0),t??(t=(r[8]<<8|r[9])&16383),s??(s=r.slice(10,16)),n+=122192928e5;let o=((n&268435455)*1e4+e)%4294967296;i[a++]=o>>>24&255,i[a++]=o>>>16&255,i[a++]=o>>>8&255,i[a++]=o&255;let d=n/4294967296*1e4&268435455;i[a++]=d>>>8&255,i[a++]=d&255,i[a++]=d>>>24&15|16,i[a++]=d>>>16&255,i[a++]=t>>>8|128,i[a++]=t&255;for(let p=0;p<6;++p)i[a++]=s[p];return i}Wr.default=Bu});var An=C(jn=>{"use strict";Object.defineProperty(jn,"__esModule",{value:!0});var $u=Vr(),zu=it();function Hu(r){let n=typeof r=="string"?(0,$u.default)(r):r,e=Ku(n);return typeof r=="string"?(0,zu.unsafeStringify)(e):e}jn.default=Hu;function Ku(r){return Uint8Array.of((r[6]&15)<<4|r[7]>>4&15,(r[7]&15)<<4|(r[4]&240)>>4,(r[4]&15)<<4|(r[5]&240)>>4,(r[5]&15)<<4|(r[0]&240)>>4,(r[0]&15)<<4|(r[1]&240)>>4,(r[1]&15)<<4|(r[2]&240)>>4,96|r[2]&15,r[3],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}});var Cc=C(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});function Vu(r){let n=Wu(r),e=Qu(n,r.length*8);return Gu(e)}function Gu(r){let n=new Uint8Array(r.length*4);for(let e=0;e<r.length*4;e++)n[e]=r[e>>2]>>>e%4*8&255;return n}function Rc(r){return(r+64>>>9<<4)+14+1}function Qu(r,n){let e=new Uint32Array(Rc(n)).fill(0);e.set(r),e[n>>5]|=128<<n%32,e[e.length-1]=n,r=e;let t=1732584193,s=-271733879,i=-1732584194,a=271733878;for(let o=0;o<r.length;o+=16){let d=t,p=s,l=i,c=a;t=me(t,s,i,a,r[o],7,-680876936),a=me(a,t,s,i,r[o+1],12,-389564586),i=me(i,a,t,s,r[o+2],17,606105819),s=me(s,i,a,t,r[o+3],22,-1044525330),t=me(t,s,i,a,r[o+4],7,-176418897),a=me(a,t,s,i,r[o+5],12,1200080426),i=me(i,a,t,s,r[o+6],17,-1473231341),s=me(s,i,a,t,r[o+7],22,-45705983),t=me(t,s,i,a,r[o+8],7,1770035416),a=me(a,t,s,i,r[o+9],12,-1958414417),i=me(i,a,t,s,r[o+10],17,-42063),s=me(s,i,a,t,r[o+11],22,-1990404162),t=me(t,s,i,a,r[o+12],7,1804603682),a=me(a,t,s,i,r[o+13],12,-40341101),i=me(i,a,t,s,r[o+14],17,-1502002290),s=me(s,i,a,t,r[o+15],22,1236535329),t=fe(t,s,i,a,r[o+1],5,-165796510),a=fe(a,t,s,i,r[o+6],9,-1069501632),i=fe(i,a,t,s,r[o+11],14,643717713),s=fe(s,i,a,t,r[o],20,-373897302),t=fe(t,s,i,a,r[o+5],5,-701558691),a=fe(a,t,s,i,r[o+10],9,38016083),i=fe(i,a,t,s,r[o+15],14,-660478335),s=fe(s,i,a,t,r[o+4],20,-405537848),t=fe(t,s,i,a,r[o+9],5,568446438),a=fe(a,t,s,i,r[o+14],9,-1019803690),i=fe(i,a,t,s,r[o+3],14,-187363961),s=fe(s,i,a,t,r[o+8],20,1163531501),t=fe(t,s,i,a,r[o+13],5,-1444681467),a=fe(a,t,s,i,r[o+2],9,-51403784),i=fe(i,a,t,s,r[o+7],14,1735328473),s=fe(s,i,a,t,r[o+12],20,-1926607734),t=ge(t,s,i,a,r[o+5],4,-378558),a=ge(a,t,s,i,r[o+8],11,-2022574463),i=ge(i,a,t,s,r[o+11],16,1839030562),s=ge(s,i,a,t,r[o+14],23,-35309556),t=ge(t,s,i,a,r[o+1],4,-1530992060),a=ge(a,t,s,i,r[o+4],11,1272893353),i=ge(i,a,t,s,r[o+7],16,-155497632),s=ge(s,i,a,t,r[o+10],23,-1094730640),t=ge(t,s,i,a,r[o+13],4,681279174),a=ge(a,t,s,i,r[o],11,-358537222),i=ge(i,a,t,s,r[o+3],16,-722521979),s=ge(s,i,a,t,r[o+6],23,76029189),t=ge(t,s,i,a,r[o+9],4,-640364487),a=ge(a,t,s,i,r[o+12],11,-421815835),i=ge(i,a,t,s,r[o+15],16,530742520),s=ge(s,i,a,t,r[o+2],23,-995338651),t=_e(t,s,i,a,r[o],6,-198630844),a=_e(a,t,s,i,r[o+7],10,1126891415),i=_e(i,a,t,s,r[o+14],15,-1416354905),s=_e(s,i,a,t,r[o+5],21,-57434055),t=_e(t,s,i,a,r[o+12],6,1700485571),a=_e(a,t,s,i,r[o+3],10,-1894986606),i=_e(i,a,t,s,r[o+10],15,-1051523),s=_e(s,i,a,t,r[o+1],21,-2054922799),t=_e(t,s,i,a,r[o+8],6,1873313359),a=_e(a,t,s,i,r[o+15],10,-30611744),i=_e(i,a,t,s,r[o+6],15,-1560198380),s=_e(s,i,a,t,r[o+13],21,1309151649),t=_e(t,s,i,a,r[o+4],6,-145523070),a=_e(a,t,s,i,r[o+11],10,-1120210379),i=_e(i,a,t,s,r[o+2],15,718787259),s=_e(s,i,a,t,r[o+9],21,-343485551),t=wt(t,d),s=wt(s,p),i=wt(i,l),a=wt(a,c)}return Uint32Array.of(t,s,i,a)}function Wu(r){if(r.length===0)return new Uint32Array;let n=new Uint32Array(Rc(r.length*8)).fill(0);for(let e=0;e<r.length;e++)n[e>>2]|=(r[e]&255)<<e%4*8;return n}function wt(r,n){let e=(r&65535)+(n&65535);return(r>>16)+(n>>16)+(e>>16)<<16|e&65535}function Yu(r,n){return r<<n|r>>>32-n}function ei(r,n,e,t,s,i){return wt(Yu(wt(wt(n,r),wt(t,i)),s),e)}function me(r,n,e,t,s,i,a){return ei(n&e|~n&t,r,n,s,i,a)}function fe(r,n,e,t,s,i,a){return ei(n&t|e&~t,r,n,s,i,a)}function ge(r,n,e,t,s,i,a){return ei(n^e^t,r,n,s,i,a)}function _e(r,n,e,t,s,i,a){return ei(e^(n|~t),r,n,s,i,a)}Nn.default=Vu});var Yr=C(nt=>{"use strict";Object.defineProperty(nt,"__esModule",{value:!0});nt.URL=nt.DNS=nt.stringToBytes=void 0;var Tc=Vr(),Xu=it();function Dc(r){r=unescape(encodeURIComponent(r));let n=new Uint8Array(r.length);for(let e=0;e<r.length;++e)n[e]=r.charCodeAt(e);return n}nt.stringToBytes=Dc;nt.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8";nt.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Ju(r,n,e,t,s,i){let a=typeof e=="string"?Dc(e):e,o=typeof t=="string"?(0,Tc.default)(t):t;if(typeof t=="string"&&(t=(0,Tc.default)(t)),t?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let d=new Uint8Array(16+a.length);if(d.set(o),d.set(a,o.length),d=n(d),d[6]=d[6]&15|r,d[8]=d[8]&63|128,s){i=i||0;for(let p=0;p<16;++p)s[i+p]=d[p];return s}return(0,Xu.unsafeStringify)(d)}nt.default=Ju});var kc=C(Pt=>{"use strict";Object.defineProperty(Pt,"__esModule",{value:!0});Pt.URL=Pt.DNS=void 0;var Zu=Cc(),Fn=Yr(),Pc=Yr();Object.defineProperty(Pt,"DNS",{enumerable:!0,get:function(){return Pc.DNS}});Object.defineProperty(Pt,"URL",{enumerable:!0,get:function(){return Pc.URL}});function qn(r,n,e,t){return(0,Fn.default)(48,Zu.default,r,n,e,t)}qn.DNS=Fn.DNS;qn.URL=Fn.URL;Pt.default=qn});var xc=C(Un=>{"use strict";Object.defineProperty(Un,"__esModule",{value:!0});var eh=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);Un.default={randomUUID:eh}});var Lc=C(Bn=>{"use strict";Object.defineProperty(Bn,"__esModule",{value:!0});var Ec=xc(),th=Zs(),rh=it();function sh(r,n,e){if(Ec.default.randomUUID&&!n&&!r)return Ec.default.randomUUID();r=r||{};let t=r.random??r.rng?.()??(0,th.default)();if(t.length<16)throw new Error("Random bytes length must be >= 16");if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,n){if(e=e||0,e<0||e+16>n.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let s=0;s<16;++s)n[e+s]=t[s];return n}return(0,rh.unsafeStringify)(t)}Bn.default=sh});var Ic=C(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});function ih(r,n,e,t){switch(r){case 0:return n&e^~n&t;case 1:return n^e^t;case 2:return n&e^n&t^e&t;case 3:return n^e^t}}function $n(r,n){return r<<n|r>>>32-n}function nh(r){let n=[1518500249,1859775393,2400959708,3395469782],e=[1732584193,4023233417,2562383102,271733878,3285377520],t=new Uint8Array(r.length+1);t.set(r),t[r.length]=128,r=t;let s=r.length/4+2,i=Math.ceil(s/16),a=new Array(i);for(let o=0;o<i;++o){let d=new Uint32Array(16);for(let p=0;p<16;++p)d[p]=r[o*64+p*4]<<24|r[o*64+p*4+1]<<16|r[o*64+p*4+2]<<8|r[o*64+p*4+3];a[o]=d}a[i-1][14]=(r.length-1)*8/Math.pow(2,32),a[i-1][14]=Math.floor(a[i-1][14]),a[i-1][15]=(r.length-1)*8&4294967295;for(let o=0;o<i;++o){let d=new Uint32Array(80);for(let _=0;_<16;++_)d[_]=a[o][_];for(let _=16;_<80;++_)d[_]=$n(d[_-3]^d[_-8]^d[_-14]^d[_-16],1);let p=e[0],l=e[1],c=e[2],u=e[3],m=e[4];for(let _=0;_<80;++_){let b=Math.floor(_/20),v=$n(p,5)+ih(b,l,c,u)+m+n[b]+d[_]>>>0;m=u,u=c,c=$n(l,30)>>>0,l=p,p=v}e[0]=e[0]+p>>>0,e[1]=e[1]+l>>>0,e[2]=e[2]+c>>>0,e[3]=e[3]+u>>>0,e[4]=e[4]+m>>>0}return Uint8Array.of(e[0]>>24,e[0]>>16,e[0]>>8,e[0],e[1]>>24,e[1]>>16,e[1]>>8,e[1],e[2]>>24,e[2]>>16,e[2]>>8,e[2],e[3]>>24,e[3]>>16,e[3]>>8,e[3],e[4]>>24,e[4]>>16,e[4]>>8,e[4])}zn.default=nh});var Oc=C(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});kt.URL=kt.DNS=void 0;var ah=Ic(),Hn=Yr(),Mc=Yr();Object.defineProperty(kt,"DNS",{enumerable:!0,get:function(){return Mc.DNS}});Object.defineProperty(kt,"URL",{enumerable:!0,get:function(){return Mc.URL}});function Kn(r,n,e,t){return(0,Hn.default)(80,ah.default,r,n,e,t)}Kn.DNS=Hn.DNS;Kn.URL=Hn.URL;kt.default=Kn});var jc=C(Vn=>{"use strict";Object.defineProperty(Vn,"__esModule",{value:!0});var oh=it(),ch=On(),dh=An();function ph(r,n,e){r??(r={}),e??(e=0);let t=(0,ch.default)({...r,_v6:!0},new Uint8Array(16));if(t=(0,dh.default)(t),n){for(let s=0;s<16;s++)n[e+s]=t[s];return n}return(0,oh.unsafeStringify)(t)}Vn.default=ph});var Ac=C(Gn=>{"use strict";Object.defineProperty(Gn,"__esModule",{value:!0});var lh=Vr(),uh=it();function hh(r){let n=typeof r=="string"?(0,lh.default)(r):r,e=mh(n);return typeof r=="string"?(0,uh.unsafeStringify)(e):e}Gn.default=hh;function mh(r){return Uint8Array.of((r[3]&15)<<4|r[4]>>4&15,(r[4]&15)<<4|(r[5]&240)>>4,(r[5]&15)<<4|r[6]&15,r[7],(r[1]&15)<<4|(r[2]&240)>>4,(r[2]&15)<<4|(r[3]&240)>>4,16|(r[0]&240)>>4,(r[0]&15)<<4|(r[1]&240)>>4,r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}});var Uc=C(Xr=>{"use strict";Object.defineProperty(Xr,"__esModule",{value:!0});Xr.updateV7State=void 0;var Nc=Zs(),fh=it(),Qn={};function gh(r,n,e){let t;if(r)t=Fc(r.random??r.rng?.()??(0,Nc.default)(),r.msecs,r.seq,n,e);else{let s=Date.now(),i=(0,Nc.default)();qc(Qn,s,i),t=Fc(i,Qn.msecs,Qn.seq,n,e)}return n??(0,fh.unsafeStringify)(t)}function qc(r,n,e){return r.msecs??(r.msecs=-1/0),r.seq??(r.seq=0),n>r.msecs?(r.seq=e[6]<<23|e[7]<<16|e[8]<<8|e[9],r.msecs=n):(r.seq=r.seq+1|0,r.seq===0&&r.msecs++),r}Xr.updateV7State=qc;function Fc(r,n,e,t,s=0){if(r.length<16)throw new Error("Random bytes length must be >= 16");if(!t)t=new Uint8Array(16),s=0;else if(s<0||s+16>t.length)throw new RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`);return n??(n=Date.now()),e??(e=r[6]*127<<24|r[7]<<16|r[8]<<8|r[9]),t[s++]=n/1099511627776&255,t[s++]=n/4294967296&255,t[s++]=n/16777216&255,t[s++]=n/65536&255,t[s++]=n/256&255,t[s++]=n&255,t[s++]=112|e>>>28&15,t[s++]=e>>>20&255,t[s++]=128|e>>>14&63,t[s++]=e>>>6&255,t[s++]=e<<2&255|r[10]&3,t[s++]=r[11],t[s++]=r[12],t[s++]=r[13],t[s++]=r[14],t[s++]=r[15],t}Xr.default=gh});var Bc=C(Wn=>{"use strict";Object.defineProperty(Wn,"__esModule",{value:!0});var _h=Kr();function wh(r){if(!(0,_h.default)(r))throw TypeError("Invalid UUID");return parseInt(r.slice(14,15),16)}Wn.default=wh});var $c=C(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.version=G.validate=G.v7=G.v6ToV1=G.v6=G.v5=G.v4=G.v3=G.v1ToV6=G.v1=G.stringify=G.parse=G.NIL=G.MAX=void 0;var vh=gc();Object.defineProperty(G,"MAX",{enumerable:!0,get:function(){return vh.default}});var Sh=_c();Object.defineProperty(G,"NIL",{enumerable:!0,get:function(){return Sh.default}});var bh=Vr();Object.defineProperty(G,"parse",{enumerable:!0,get:function(){return bh.default}});var yh=it();Object.defineProperty(G,"stringify",{enumerable:!0,get:function(){return yh.default}});var Rh=On();Object.defineProperty(G,"v1",{enumerable:!0,get:function(){return Rh.default}});var Ch=An();Object.defineProperty(G,"v1ToV6",{enumerable:!0,get:function(){return Ch.default}});var Th=kc();Object.defineProperty(G,"v3",{enumerable:!0,get:function(){return Th.default}});var Dh=Lc();Object.defineProperty(G,"v4",{enumerable:!0,get:function(){return Dh.default}});var Ph=Oc();Object.defineProperty(G,"v5",{enumerable:!0,get:function(){return Ph.default}});var kh=jc();Object.defineProperty(G,"v6",{enumerable:!0,get:function(){return kh.default}});var xh=Ac();Object.defineProperty(G,"v6ToV1",{enumerable:!0,get:function(){return xh.default}});var Eh=Uc();Object.defineProperty(G,"v7",{enumerable:!0,get:function(){return Eh.default}});var Lh=Kr();Object.defineProperty(G,"validate",{enumerable:!0,get:function(){return Lh.default}});var Ih=Bc();Object.defineProperty(G,"version",{enumerable:!0,get:function(){return Ih.default}})});var zc=C(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.FakeEventTarget=void 0;var Yn=class{constructor(){h(this,"listeners",{})}addEventListener(n,e,t={}){var s;e&&((s=this.listeners)[n]??(s[n]=[]),this.listeners[n].push({callback:e,once:t.once===!0}))}removeEventListener(n,e){this.listeners[n]&&(this.listeners[n]=this.listeners[n].filter(t=>t.callback!==e))}dispatchEvent(n){if(!n||typeof n.type!="string")throw new Error("invalid event object");let e=this.listeners[n.type];if(!e)return!0;for(let t of[...e]){try{t.callback.call(this,n)}catch(s){setTimeout(()=>{throw s},0)}t.once&&this.removeEventListener(n.type,t.callback)}return!n.defaultPrevented}};ti.FakeEventTarget=Yn});var Hc=C(Xn=>{"use strict";Object.defineProperty(Xn,"__esModule",{value:!0});Xn.clone=Mh;function Mh(r){if(r!==void 0)return Number.isNaN(r)?NaN:typeof structuredClone=="function"?structuredClone(r):JSON.parse(JSON.stringify(r))}});var Vc=C(si=>{"use strict";Object.defineProperty(si,"__esModule",{value:!0});si.FakeMediaStreamTrack=void 0;var Kc=$c(),Oh=zc(),ri=Hc(),Jr,wr,vr,Qe,vt,We,xt,Sr,Et,br,Lt,It,Mt,Ot,jt,At,Zn=class Zn extends Oh.FakeEventTarget{constructor({kind:e,id:t,label:s,contentHint:i,enabled:a,muted:o,readyState:d,capabilities:p,constraints:l,settings:c,data:u}){super();ce(this,Jr);ce(this,wr);ce(this,vr);ce(this,Qe);ce(this,vt);ce(this,We);ce(this,xt);ce(this,Sr);ce(this,Et);ce(this,br);ce(this,Lt);ce(this,It,null);ce(this,Mt,null);ce(this,Ot,null);ce(this,jt,null);ce(this,At,null);Z(this,Jr,t??(0,Kc.v4)()),Z(this,wr,e),Z(this,vr,s??""),Z(this,xt,i??""),Z(this,vt,a??!0),Z(this,We,o??!1),Z(this,Qe,d??"live"),Z(this,Sr,p??{}),Z(this,Et,l??{}),Z(this,br,c??{}),Z(this,Lt,u??{})}get id(){return N(this,Jr)}get kind(){return N(this,wr)}get label(){return N(this,vr)}get contentHint(){return N(this,xt)}set contentHint(e){Z(this,xt,e)}get enabled(){return N(this,vt)}set enabled(e){let t=N(this,vt)!==e;Z(this,vt,e),t&&this.dispatchEvent(new Event("enabledchange"))}get muted(){return N(this,We)}get readyState(){return N(this,Qe)}get data(){return N(this,Lt)}set data(e){Z(this,Lt,e)}get onmute(){return N(this,It)}set onmute(e){N(this,It)&&this.removeEventListener("mute",N(this,It)),Z(this,It,e),e&&this.addEventListener("mute",e)}get onunmute(){return N(this,Mt)}set onunmute(e){N(this,Mt)&&this.removeEventListener("unmute",N(this,Mt)),Z(this,Mt,e),e&&this.addEventListener("unmute",e)}get onended(){return N(this,Ot)}set onended(e){N(this,Ot)&&this.removeEventListener("ended",N(this,Ot)),Z(this,Ot,e),e&&this.addEventListener("ended",e)}get onenabledchange(){return N(this,jt)}set onenabledchange(e){N(this,jt)&&this.removeEventListener("enabledchange",N(this,jt)),Z(this,jt,e),e&&this.addEventListener("enabledchange",e)}get onstopped(){return N(this,At)}set onstopped(e){N(this,At)&&this.removeEventListener("stopped",N(this,At)),Z(this,At,e),e&&this.addEventListener("stopped",e)}addEventListener(e,t,s){super.addEventListener(e,t,s)}removeEventListener(e,t){super.removeEventListener(e,t)}stop(){N(this,Qe)!=="ended"&&(Z(this,Qe,"ended"),this.dispatchEvent(new Event("stopped")))}clone({id:e,data:t}={}){return new Zn({id:e??(0,Kc.v4)(),kind:N(this,wr),label:N(this,vr),contentHint:N(this,xt),enabled:N(this,vt),muted:N(this,We),readyState:N(this,Qe),capabilities:(0,ri.clone)(N(this,Sr)),constraints:(0,ri.clone)(N(this,Et)),settings:(0,ri.clone)(N(this,br)),data:t??(0,ri.clone)(N(this,Lt))})}getCapabilities(){return N(this,Sr)}getConstraints(){return N(this,Et)}async applyConstraints(e={}){return Z(this,Et,e),Promise.resolve()}getSettings(){return N(this,br)}remoteStop(){N(this,Qe)!=="ended"&&(Z(this,Qe,"ended"),this.dispatchEvent(new Event("stopped")),this.dispatchEvent(new Event("ended")))}remoteMute(){N(this,We)||(Z(this,We,!0),this.dispatchEvent(new Event("mute")))}remoteUnmute(){N(this,We)&&(Z(this,We,!1),this.dispatchEvent(new Event("unmute")))}};Jr=new WeakMap,wr=new WeakMap,vr=new WeakMap,Qe=new WeakMap,vt=new WeakMap,We=new WeakMap,xt=new WeakMap,Sr=new WeakMap,Et=new WeakMap,br=new WeakMap,Lt=new WeakMap,It=new WeakMap,Mt=new WeakMap,Ot=new WeakMap,jt=new WeakMap,At=new WeakMap;var Jn=Zn;si.FakeMediaStreamTrack=Jn});var Qc=C(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.FakeHandler=void 0;var jh=Vc(),Ah=Ze(),Nh=ee(),yr=ie(),Gc=le(),Fh=de(),qh=be(),we=new Nh.Logger("FakeHandler"),Uh="FakeHandler",ii=class extends Ah.EnhancedEventEmitter{constructor({id:e,ordered:t,maxPacketLifeTime:s,maxRetransmits:i,label:a,protocol:o}){super();h(this,"id");h(this,"ordered");h(this,"maxPacketLifeTime");h(this,"maxRetransmits");h(this,"label");h(this,"protocol");this.id=e,this.ordered=t,this.maxPacketLifeTime=s,this.maxRetransmits=i,this.label=a,this.protocol=o}close(){this.safeEmit("close"),this.emit("@close")}send(e){this.safeEmit("message",e)}addEventListener(e,t){this.on(e,t)}},ea=class r extends qh.HandlerInterface{constructor(e){super();h(this,"_closed",!1);h(this,"fakeParameters");h(this,"_rtpParametersByKind");h(this,"_cname",`CNAME-${yr.generateRandomNumber()}`);h(this,"_transportReady",!1);h(this,"_nextLocalId",1);h(this,"_tracks",new Map);h(this,"_nextSctpStreamId",0);this.fakeParameters=e}static createFactory(e){return()=>new r(e)}get name(){return Uh}close(){we.debug("close()"),!this._closed&&(this._closed=!0)}setIceGatheringState(e){this.emit("@icegatheringstatechange",e)}setConnectionState(e){this.emit("@connectionstatechange",e)}async getNativeRtpCapabilities(){return we.debug("getNativeRtpCapabilities()"),this.fakeParameters.generateNativeRtpCapabilities()}async getNativeSctpCapabilities(){return we.debug("getNativeSctpCapabilities()"),this.fakeParameters.generateNativeSctpCapabilities()}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:d,proprietaryConstraints:p,extendedRtpCapabilities:l}){this.assertNotClosed(),we.debug("run()"),this._rtpParametersByKind={audio:Gc.getSendingRtpParameters("audio",l),video:Gc.getSendingRtpParameters("video",l)}}async updateIceServers(e){this.assertNotClosed(),we.debug("updateIceServers()")}async restartIce(e){this.assertNotClosed(),we.debug("restartIce()")}async getTransportStats(){return this.assertNotClosed(),new Map}async send({track:e,encodings:t,codecOptions:s,codec:i}){this.assertNotClosed(),we.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"});let a=yr.clone(this._rtpParametersByKind[e.kind]),o=a.codecs.some(p=>/.+\/rtx$/i.test(p.mimeType));a.mid=`mid-${yr.generateRandomNumber()}`,t||(t=[{}]);for(let p of t)p.ssrc=yr.generateRandomNumber(),o&&(p.rtx={ssrc:yr.generateRandomNumber()});a.encodings=t,a.rtcp={cname:this._cname,reducedSize:!0,mux:!0};let d=this._nextLocalId++;return this._tracks.set(d,e),{localId:String(d),rtpParameters:a}}async stopSending(e){if(we.debug("stopSending() [localId:%s]",e),!this._closed){if(!this._tracks.has(Number(e)))throw new Error("local track not found");this._tracks.delete(Number(e))}}async pauseSending(e){this.assertNotClosed()}async resumeSending(e){this.assertNotClosed()}async replaceTrack(e,t){this.assertNotClosed(),t?we.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):we.debug("replaceTrack() [localId:%s, no track]",e),this._tracks.delete(Number(e)),this._tracks.set(Number(e),t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),we.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),we.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t)}async getSenderStats(e){return this.assertNotClosed(),new Map}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:a}){this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),we.debug("sendDataChannel()");let o=new ii({id:this._nextSctpStreamId++,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:a}),d={streamId:this._nextSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s};return{dataChannel:o,sctpStreamParameters:d}}async receive(e){this.assertNotClosed();let t=[];for(let s of e){let{trackId:i,kind:a}=s;this._transportReady||await this.setupTransport({localDtlsRole:"client"}),we.debug("receive() [trackId:%s, kind:%s]",i,a);let o=this._nextLocalId++,d=new jh.FakeMediaStreamTrack({kind:a});this._tracks.set(o,d),t.push({localId:String(o),track:d})}return t}async stopReceiving(e){if(!this._closed)for(let t of e)we.debug("stopReceiving() [localId:%s]",t),this._tracks.delete(Number(t))}async pauseReceiving(e){this.assertNotClosed()}async resumeReceiving(e){this.assertNotClosed()}async getReceiverStats(e){return this.assertNotClosed(),new Map}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"client"}),we.debug("receiveDataChannel()"),{dataChannel:new ii({id:e.streamId,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits,label:t,protocol:s})}}async setupTransport({localDtlsRole:e,localSdpObject:t}){let s=yr.clone(this.fakeParameters.generateLocalDtlsParameters());e&&(s.role=e),this.emit("@connectionstatechange","connecting"),await new Promise((i,a)=>this.emit("@connect",{dtlsParameters:s},i,a)),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Fh.InvalidStateError("method called in a closed handler")}};ni.FakeHandler=ea});var Wc=C(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.generateRouterRtpCapabilities=Bh;je.generateNativeRtpCapabilities=$h;je.generateNativeSctpCapabilities=zh;je.generateLocalDtlsParameters=Hh;je.generateTransportRemoteParameters=Kh;je.generateProducerRemoteParameters=Vh;je.generateConsumerRemoteParameters=Gh;je.generateDataProducerRemoteParameters=Qh;je.generateDataConsumerRemoteParameters=Wh;var ve=ie();function De(){return String(ve.generateRandomNumber())}function Bh(){return ve.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:105,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"profile-id":0,"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:106,clockRate:9e4,rtcpFeedback:[],parameters:{apt:105}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://tools.ietf.org/html/draft-ietf-avtext-framemarking-07",preferredId:6,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:framemarking",preferredId:7,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function $h(){return ve.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:98,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{"profile-id":0}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:99,clockRate:9e4,rtcpFeedback:[],parameters:{apt:98}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]})}function zh(){return ve.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function Hh(){return ve.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function Kh(){return{id:De(),iceParameters:ve.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:ve.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:ve.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:ve.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function Vh(){return ve.deepFreeze({id:De()})}function Gh({id:r,codecMimeType:n}={}){switch(n){case"audio/opus":return{id:r??De(),producerId:De(),kind:"audio",rtpParameters:ve.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:r??De(),producerId:De(),kind:"audio",rtpParameters:ve.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:r??De(),producerId:De(),kind:"video",rtpParameters:ve.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:r??De(),producerId:De(),kind:"video",rtpParameters:ve.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${n}'`)}}function Qh(){return ve.deepFreeze({id:De()})}function Wh({id:r}={}){return{id:r??De(),dataProducerId:De(),sctpStreamParameters:ve.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}});var Yc=C(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.debug=te.testFakeParameters=te.FakeHandler=te.ortc=te.parseScalabilityMode=te.detectDeviceAsync=te.detectDevice=te.Device=te.version=te.types=void 0;var Yh=Or();te.debug=Yh.default;te.types=fc();te.version="3.10.1";var ta=Dn();Object.defineProperty(te,"Device",{enumerable:!0,get:function(){return ta.Device}});Object.defineProperty(te,"detectDevice",{enumerable:!0,get:function(){return ta.detectDevice}});Object.defineProperty(te,"detectDeviceAsync",{enumerable:!0,get:function(){return ta.detectDeviceAsync}});var Xh=st();Object.defineProperty(te,"parseScalabilityMode",{enumerable:!0,get:function(){return Xh.parse}});te.ortc=le();var Jh=Qc();Object.defineProperty(te,"FakeHandler",{enumerable:!0,get:function(){return Jh.FakeHandler}});te.testFakeParameters=Wc()});var Zh=gd(Yc(),1);window.mediasoupClient=Zh;
