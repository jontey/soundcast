version: '3.8'

services:
  soundcast:
    image: jtey1/soundcast:latest
    platform: linux/amd64
    # ports:
    #   - "3000:3000"
    #   - "40000-40100:40000-40100/tcp"
    #   - "40000-40100:40000-40100/udp"
    environment:
      - NODE_ENV=production
      - SINGLE_TENANT=true
      - ADMIN_KEY=admin
      # IMPORTANT: Set this to your server's LAN IP address
      - ANNOUNCED_IP=${HOST_IP:-127.0.0.1}
      - DB_PATH=/app/data/soundcast.db
      - RTC_MIN_PORT=40000
      - RTC_MAX_PORT=40100
      # TLS settings (certificates are auto-generated in the container)
      - HTTPS_PORT=3001
      - TLS_KEY_PATH=/app/certs/server.key
      - TLS_CERT_PATH=/app/certs/server.crt
      # Recording settings
      - RECORDING_DIR=/app/recordings
      # Transcription settings (NEW)
      - TRANSCRIPTION_ENABLED=true
      - TRANSCRIPTION_USE_NATIVE=true
      - WHISPER_MODEL_DIR=/app/models
      - WHISPER_MODEL_SIZE=base
      - TRANSCRIPTION_RTP_PORT_MIN=51000
      - TRANSCRIPTION_RTP_PORT_MAX=51999
      # Embedding settings (NEW)
      - EMBEDDING_ENABLED=true
      # SQLite-vec extension path (NEW)
      - SQLITE_VEC_PATH=/app/lib/vec0.so
    volumes:
      - soundcast-data:/app/data
      - soundcast-recordings:/app/recordings
      - soundcast-models:/app/models  # NEW: persistent models storage
    restart: unless-stopped
    # For air-gapped deployments, network_mode: host may work better
    network_mode: host

volumes:
  soundcast-data:
  soundcast-recordings:
  soundcast-models:  # NEW: volume for Whisper models
